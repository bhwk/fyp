<!-- prettier-ignore -->

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ray.rllib.algorithms.algorithm_config &#8212; Ray 3.0.0.dev0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="https://docs.ray.io/en/master/_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="https://docs.ray.io/en/master/_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="https://docs.ray.io/en/master/_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="https://docs.ray.io/en/master/_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="https://docs.ray.io/en/master/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="https://docs.ray.io/en/master/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="https://docs.ray.io/en/master/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/css/termynal.css?v=2fc3cb5e" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/css/csat.css?v=c8f39c76" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/css/assistant.css?v=d345c55e" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/css/custom.css?v=2df59da5" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/docsearch.css?v=45fb5152" />
    <link rel="stylesheet" type="text/css" href="https://docs.ray.io/en/master/_static/pydata-docsearch-custom.css?v=7fb92720" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="https://docs.ray.io/en/master/_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="https://docs.ray.io/en/master/_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="https://docs.ray.io/en/master/_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script src="https://docs.ray.io/en/master/_static/documentation_options.js?v=d1493c90"></script>
    <script src="https://docs.ray.io/en/master/_static/doctools.js?v=9a2dae69"></script>
    <script src="https://docs.ray.io/en/master/_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://docs.ray.io/en/master/_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="https://docs.ray.io/en/master/_static/copybutton.js?v=9a29e97e"></script>
    <script defer="defer" src="https://docs.ray.io/en/master/_static/js/termynal.js?v=67cfcf08"></script>
    <script defer="defer" src="https://docs.ray.io/en/master/_static/js/custom.js?v=9e3b357f"></script>
    <script src="https://docs.ray.io/en/master/_static/js/csat.js?v=8e649b1c"></script>
    <script defer="defer" src="https://docs.ray.io/en/master/_static/js/assistant.js?v=73fdc522"></script>
    <script defer="defer" src="https://docs.ray.io/en/master/_static/docsearch.js?v=77274085"></script>
    <script defer="defer" src="https://docs.ray.io/en/master/_static/docsearch_config.js?v=d25523ed"></script>
    <script src="https://docs.ray.io/en/master/_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/ray/rllib/algorithms/algorithm_config';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.ray.io/en/master/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'master';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/_modules/ray/rllib/algorithms/algorithm_config.html" />
    <link rel="icon" href="https://docs.ray.io/en/master/_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" /><!-- Extra header to include at the top of each template.
Kept separately so that it can easily be included in any templates
that need to be overridden for individual pages; e.g. included
both in the usual template (layout.html) as well as (index.html). -->

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;900&family=Roboto:wght@400;500;700&display=swap"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  title="light"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
  disabled="disabled"
/>
<link
  rel="stylesheet"
  title="dark"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
  disabled="disabled"
/>
<link
  href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css"
  rel="stylesheet"
/>

<!-- Used for text embedded in html on the index page  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- Parser used to call hljs on responses from Ray Assistant -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- Sanitizer for Ray Assistant AI -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      'gtm.start': new Date().getTime(),
      event: 'gtm.js',
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, 'script', 'dataLayer', 'GTM-P8H6KQG');
</script>
<!-- End Google Tag Manager -->
<!-- Data to be shared with JS on every page -->
<script>
  window.data = {
      copyIconSrc: "../../../../_static/copy-button.svg"
  };
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

  <script async type="text/javascript" src="https://docs.ray.io/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="anyscale-ray" /><meta name="readthedocs-version-slug" content="master" /><meta name="readthedocs-resolver-filename" content="/_modules/ray/rllib/algorithms/algorithm_config.html" /><meta name="readthedocs-http-status" content="200" /></head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="algorithm_config.html#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="https://docs.ray.io/en/master/search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../../index.html">
  <svg
   id="svg"
   version="1.1"
   viewBox="0, 0, 400,200.13540961408262"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <g id="g1">
    <path id="ray-text" d="m 102.875,36.782 c 0.16,0.041 0.423,0.041 0.583,0 0.161,-0.042 0.029,-0.077 -0.291,-0.077 -0.321,0 -0.452,0.035 -0.292,0.077 m 89.958,63.206 v 30.345 h 3.584 3.583 v -9.487 -9.487 l 9.958,-0.059 c 10.822,-0.064 10.056,-0.121 10.664,0.804 0.113,0.172 0.394,0.597 0.625,0.945 0.231,0.348 0.42,0.693 0.42,0.766 0,0.073 0.15,0.269 0.333,0.435 0.183,0.166 0.333,0.358 0.333,0.427 0,0.069 0.366,0.676 0.814,1.349 0.925,1.393 2.687,4.088 2.936,4.493 0.092,0.149 0.312,0.486 0.489,0.751 1.348,2.013 2.261,3.416 2.261,3.474 0,0.038 0.338,0.561 0.75,1.164 0.413,0.602 0.755,1.151 0.761,1.219 0.006,0.067 0.267,0.46 0.58,0.873 0.313,0.412 0.692,0.975 0.843,1.25 0.622,1.138 0.378,1.083 4.846,1.083 h 4.062 l -0.254,-0.458 c -0.139,-0.252 -0.677,-1.058 -1.196,-1.792 -1.001,-1.416 -1.194,-1.694 -5.308,-7.666 -1.452,-2.109 -2.684,-3.871 -2.737,-3.917 -0.053,-0.046 -0.172,-0.213 -0.263,-0.372 -0.326,-0.563 -2.842,-4.226 -3.541,-5.154 -0.969,-1.287 -1.025,-1.162 0.832,-1.838 0.726,-0.263 2.976,-1.446 3.305,-1.737 0.145,-0.128 0.319,-0.232 0.388,-0.232 0.287,0 2.659,-2.095 3.515,-3.105 3.686,-4.345 5.22,-10.506 4.352,-17.484 -0.442,-3.559 -1.381,-5.956 -3.555,-9.078 -0.491,-0.706 -3.235,-3.333 -3.481,-3.333 -0.128,0 -0.232,-0.062 -0.232,-0.136 0,-0.075 -0.319,-0.313 -0.708,-0.53 -0.39,-0.216 -0.746,-0.439 -0.792,-0.496 -0.077,-0.096 -1.012,-0.546 -2.532,-1.218 -1.038,-0.459 -3.173,-1.141 -4.051,-1.293 -0.459,-0.08 -1.359,-0.273 -2,-0.429 -1.04,-0.253 -2.711,-0.292 -15.375,-0.353 l -14.209,-0.07 v 30.346 m 80.935,-28.446 c -0.448,1.031 -1.004,2.287 -1.235,2.791 -0.396,0.861 -0.579,1.27 -1.363,3.038 -0.403,0.911 -1.14,2.528 -1.903,4.177 -0.33,0.714 -0.6,1.373 -0.6,1.464 0,0.092 -0.107,0.333 -0.238,0.536 -0.13,0.203 -0.661,1.344 -1.179,2.535 -0.519,1.192 -1.085,2.467 -1.258,2.834 -0.464,0.979 -1.328,2.9 -2.324,5.166 -1.025,2.334 -1.477,3.34 -1.759,3.917 -0.113,0.229 -1.423,3.154 -2.913,6.5 -1.49,3.346 -2.951,6.608 -3.248,7.25 -1.302,2.818 -8.248,18.378 -8.248,18.475 0,0.06 1.714,0.108 3.808,0.108 h 3.809 l 1.04,-2.375 c 0.573,-1.306 1.191,-2.712 1.374,-3.125 0.183,-0.412 0.483,-1.087 0.665,-1.5 0.183,-0.412 0.467,-1.05 0.63,-1.416 0.164,-0.367 0.656,-1.492 1.093,-2.5 0.437,-1.009 0.93,-2.134 1.097,-2.5 0.166,-0.367 0.399,-0.911 0.517,-1.209 l 0.215,-0.541 h 16.448 16.447 l 0.369,0.791 c 0.203,0.436 0.464,1.017 0.581,1.292 0.209,0.494 1.042,2.363 1.485,3.333 0.21,0.46 2.5,5.679 2.998,6.834 0.118,0.275 0.406,0.912 0.638,1.416 0.232,0.504 0.465,1.048 0.516,1.209 0.085,0.267 0.426,0.291 4.003,0.291 h 3.91 l -0.137,-0.458 c -0.122,-0.41 -1.026,-2.462 -2.331,-5.292 -0.254,-0.55 -1.531,-3.4 -2.838,-6.333 -1.307,-2.933 -2.618,-5.858 -2.913,-6.5 -0.412,-0.894 -5.399,-12.071 -8.292,-18.583 -0.183,-0.413 -0.473,-1.05 -0.644,-1.417 -0.324,-0.694 -1.063,-2.353 -1.56,-3.5 -0.159,-0.367 -0.427,-0.967 -0.595,-1.333 -0.867,-1.885 -2.251,-4.97 -2.916,-6.5 -0.195,-0.45 -0.423,-0.958 -1.421,-3.167 -0.166,-0.367 -0.502,-1.117 -0.747,-1.667 -0.63,-1.413 -1.07,-2.395 -1.419,-3.166 -0.652,-1.443 -0.97,-2.18 -1.059,-2.459 -0.086,-0.266 -0.421,-0.291 -3.891,-0.291 h -3.798 l -0.814,1.875 M 306.5,69.745 c 0,0.096 0.45,0.894 1.132,2.005 0.281,0.458 0.75,1.283 1.042,1.833 0.293,0.55 0.625,1.113 0.738,1.25 0.114,0.138 0.649,1.029 1.189,1.982 0.54,0.952 1.147,2.002 1.348,2.333 0.201,0.331 0.669,1.127 1.04,1.769 0.372,0.641 0.874,1.504 1.117,1.916 0.452,0.769 0.799,1.371 1.408,2.446 0.19,0.337 0.586,0.993 0.878,1.458 0.293,0.466 0.625,1.034 0.738,1.263 0.113,0.229 0.393,0.717 0.622,1.083 0.229,0.367 0.735,1.218 1.124,1.891 0.389,0.673 0.857,1.477 1.041,1.787 0.183,0.31 0.775,1.334 1.316,2.276 0.541,0.942 1.066,1.817 1.167,1.944 0.101,0.127 0.446,0.704 0.767,1.282 0.32,0.579 0.948,1.675 1.393,2.436 0.446,0.762 0.963,1.647 1.149,1.968 0.186,0.32 0.476,0.808 0.644,1.083 0.168,0.275 0.497,0.837 0.73,1.25 0.234,0.412 0.563,0.975 0.731,1.25 0.168,0.275 0.456,0.763 0.64,1.083 0.183,0.321 0.607,1.046 0.94,1.612 l 0.606,1.028 v 10.18 10.18 h 3.583 3.584 v -10.55 c 0,-6.074 0.064,-10.617 0.151,-10.708 0.083,-0.087 0.32,-0.458 0.528,-0.825 0.869,-1.535 1.109,-1.954 1.881,-3.277 1.098,-1.882 1.383,-2.373 1.773,-3.056 0.183,-0.321 0.473,-0.827 0.644,-1.125 0.171,-0.298 0.587,-1.029 0.926,-1.625 0.338,-0.596 0.683,-1.196 0.765,-1.334 0.428,-0.714 1.259,-2.124 1.424,-2.416 0.186,-0.329 0.612,-1.07 1.22,-2.125 0.172,-0.298 0.634,-1.104 1.027,-1.792 0.393,-0.687 0.815,-1.368 0.938,-1.513 0.122,-0.145 0.223,-0.389 0.223,-0.542 0,-0.153 0.061,-0.278 0.137,-0.278 0.075,0 0.302,-0.319 0.503,-0.709 0.202,-0.389 0.551,-1.008 0.775,-1.375 0.225,-0.366 0.551,-0.929 0.724,-1.25 0.63,-1.167 2.234,-3.927 2.52,-4.336 0.161,-0.23 0.547,-0.889 0.858,-1.462 0.312,-0.574 0.732,-1.323 0.935,-1.664 0.203,-0.342 0.561,-0.959 0.796,-1.371 0.234,-0.413 0.585,-1.013 0.779,-1.333 0.325,-0.538 0.934,-1.61 1.374,-2.417 0.1,-0.183 0.267,-0.446 0.371,-0.583 0.103,-0.138 0.425,-0.7 0.715,-1.25 0.29,-0.55 0.647,-1.171 0.793,-1.379 l 0.265,-0.378 -3.801,0.045 -3.801,0.045 -0.3,0.5 c -0.165,0.275 -0.455,0.762 -0.644,1.083 -0.189,0.321 -0.565,0.921 -0.835,1.334 -0.27,0.412 -0.569,0.9 -0.664,1.083 -0.096,0.183 -0.395,0.671 -0.665,1.083 -0.27,0.413 -0.645,1.013 -0.834,1.334 -0.189,0.32 -0.49,0.808 -0.668,1.083 -0.178,0.275 -0.479,0.762 -0.669,1.083 -0.19,0.321 -0.712,1.184 -1.159,1.917 -0.448,0.733 -1.086,1.783 -1.417,2.333 -0.332,0.55 -0.824,1.338 -1.093,1.75 -0.27,0.413 -0.542,0.863 -0.605,1 -0.064,0.138 -0.427,0.738 -0.807,1.334 -0.38,0.596 -0.834,1.308 -1.009,1.583 -0.175,0.275 -0.402,0.65 -0.503,0.833 -0.102,0.184 -0.696,1.159 -1.321,2.167 -0.625,1.008 -1.316,2.133 -1.536,2.5 -0.219,0.367 -0.584,0.967 -0.81,1.333 -0.226,0.367 -0.461,0.777 -0.523,0.911 -0.061,0.134 -0.42,0.696 -0.797,1.25 -0.378,0.553 -0.737,1.118 -0.799,1.256 -0.061,0.138 -0.3,0.55 -0.531,0.917 -0.23,0.366 -0.507,0.837 -0.615,1.046 -0.292,0.563 -0.932,-0.03 -1.58,-1.463 -0.063,-0.138 -0.27,-0.473 -0.461,-0.747 -0.39,-0.556 -0.504,-0.738 -1.098,-1.753 -0.559,-0.954 -0.693,-1.171 -1.084,-1.754 -0.183,-0.274 -0.422,-0.647 -0.531,-0.83 -0.109,-0.183 -0.695,-1.12 -1.302,-2.083 -0.607,-0.962 -1.193,-1.897 -1.302,-2.077 -0.534,-0.884 -1.693,-2.723 -1.97,-3.124 -0.171,-0.249 -0.311,-0.495 -0.311,-0.549 0,-0.053 -0.141,-0.3 -0.312,-0.548 C 323.21,84.6 322,82.674 322,82.582 c 0,-0.053 -0.139,-0.299 -0.309,-0.547 -0.761,-1.11 -1.663,-2.54 -1.81,-2.868 -0.061,-0.138 -0.435,-0.724 -0.83,-1.303 -0.395,-0.578 -0.718,-1.088 -0.718,-1.133 0,-0.044 -0.3,-0.532 -0.666,-1.084 C 317.3,75.095 317,74.611 317,74.571 c 0,-0.039 -0.356,-0.628 -0.792,-1.308 -0.435,-0.681 -1.12,-1.768 -1.522,-2.417 l -0.731,-1.179 h -3.727 c -2.051,0 -3.728,0.035 -3.728,0.078 m -86.75,7.023 c 3.486,0.433 8.055,2.022 8.389,2.917 0.03,0.081 0.138,0.148 0.239,0.148 0.278,0 2.413,2.27 2.792,2.969 0.184,0.338 0.399,0.727 0.48,0.865 2.258,3.865 1.774,11.495 -0.942,14.836 -0.206,0.254 -0.375,0.504 -0.375,0.556 0,0.13 -1.451,1.504 -2.196,2.079 -1.372,1.059 -4.274,2.252 -6.804,2.797 -1.265,0.272 -2.482,0.311 -11.375,0.359 L 200,104.348 V 90.424 76.5 l 8.792,-0.001 c 7.089,0 9.211,0.052 10.958,0.269 m 58.745,1.979 c 0.003,0.09 0.235,0.653 0.516,1.25 0.281,0.598 0.662,1.424 0.846,1.836 0.185,0.413 0.48,1.05 0.656,1.417 0.177,0.367 0.321,0.719 0.321,0.783 -10e-4,0.101 0.437,1.075 1.82,4.05 0.17,0.367 1.189,2.654 2.263,5.084 1.075,2.429 2.18,4.904 2.456,5.5 0.276,0.596 0.76,1.683 1.075,2.416 0.581,1.349 0.792,1.826 1.478,3.334 0.209,0.458 0.542,1.208 0.74,1.666 0.198,0.459 0.498,1.115 0.666,1.459 l 0.307,0.625 h -13.32 c -8.524,0 -13.319,-0.059 -13.319,-0.163 0,-0.089 0.164,-0.52 0.365,-0.958 0.622,-1.356 1.332,-2.938 1.572,-3.504 0.126,-0.298 0.337,-0.786 0.469,-1.084 0.131,-0.298 0.814,-1.854 1.517,-3.458 0.704,-1.604 1.411,-3.217 1.573,-3.583 0.161,-0.367 0.406,-0.93 0.544,-1.25 0.137,-0.321 0.794,-1.821 1.459,-3.334 1.615,-3.672 1.781,-4.049 2.154,-4.875 0.175,-0.389 0.674,-1.533 1.108,-2.541 0.937,-2.177 1.685,-3.833 2.006,-4.443 0.128,-0.243 0.233,-0.576 0.233,-0.74 0,-0.333 0.484,0.168 0.495,0.513" />
    <path id="ray-logo" d="m 101.476,36.871 c -1.303,0.145 -3.55,0.666 -4.332,1.004 -2.044,0.884 -2.472,1.092 -3.144,1.529 -7.177,4.661 -9.961,13.497 -6.746,21.409 0.465,1.144 0.582,1.352 1.707,3.057 0.986,1.494 3.928,4.463 4.424,4.463 0.054,0 0.429,0.223 0.832,0.496 4.639,3.13 12.64,3.283 17.395,0.332 0.457,-0.284 22.892,21.99 22.486,22.327 -0.218,0.181 -0.803,1.491 -1.437,3.22 l -0.352,0.959 h -6.238 c -5.795,0 -6.238,-0.021 -6.238,-0.288 0,-0.977 -1.759,-4.418 -3.151,-6.165 -4.027,-5.051 -11.482,-7.68 -17.226,-6.075 -0.711,0.198 -1.405,0.361 -1.542,0.361 -0.745,0 -4.681,2.22 -5.914,3.336 -0.321,0.291 -0.792,0.706 -1.046,0.923 -0.855,0.728 -2.606,3.23 -3.29,4.701 -0.372,0.801 -0.749,1.587 -0.837,1.746 -0.088,0.159 -0.16,0.434 -0.16,0.611 0,0.888 0.287,0.85 -6.415,0.85 H 74.04 l -0.198,-0.542 c -0.108,-0.298 -0.347,-0.917 -0.531,-1.375 -0.183,-0.458 -0.358,-0.946 -0.389,-1.083 -0.087,-0.39 -1.399,-2.503 -2.064,-3.324 -2.725,-3.366 -5.769,-5.225 -10.441,-6.377 -3.309,-0.816 -10.96,0.695 -12.419,2.453 -0.113,0.136 -0.278,0.248 -0.367,0.248 -0.392,0 -4.298,3.657 -4.298,4.024 0,0.086 -0.131,0.297 -0.291,0.469 -2.793,2.998 -3.936,11.297 -2.141,15.549 0.844,1.999 1.072,2.472 1.583,3.291 0.314,0.504 0.634,0.942 0.711,0.972 0.076,0.031 0.138,0.154 0.138,0.274 0,0.246 2.689,3.043 3.334,3.468 0.229,0.151 0.716,0.486 1.083,0.744 6.843,4.811 18.162,3.018 23.001,-3.643 0.093,-0.128 0.412,-0.542 0.709,-0.922 0.297,-0.38 0.54,-0.747 0.54,-0.815 0,-0.069 0.224,-0.489 0.498,-0.935 0.275,-0.445 0.461,-0.81 0.414,-0.81 -0.046,0 0.104,-0.372 0.335,-0.827 0.231,-0.456 0.42,-0.94 0.42,-1.076 0,-0.136 0.087,-0.439 0.193,-0.672 l 0.194,-0.425 h 6.22 6.22 l 0.101,0.459 c 1.063,4.828 6.623,10.565 11.322,11.682 0.366,0.087 1.154,0.288 1.75,0.446 7.975,2.118 18.533,-4.211 20.101,-12.05 l 0.107,-0.537 h 6.217 6.217 l 0.352,0.959 c 0.642,1.751 1.22,3.04 1.447,3.228 0.178,0.148 -2.094,2.503 -10.941,11.344 l -11.165,11.158 -0.793,-0.404 c -1.29,-0.658 -1.561,-0.769 -2.959,-1.21 -5.239,-1.651 -12.178,-0.296 -16.032,3.131 -1.412,1.256 -2.907,2.908 -3.508,3.878 -4.539,7.323 -3.445,16.326 2.69,22.138 0.992,0.939 3.39,2.578 4.35,2.972 1.875,0.771 2.482,1.005 2.729,1.053 0.149,0.03 0.849,0.174 1.556,0.32 10.388,2.155 20.37,-6.164 20.38,-16.983 0.002,-3.118 -0.379,-4.767 -1.788,-7.728 l -0.505,-1.061 11.107,-11.106 11.107,-11.105 0.873,0.447 c 1.444,0.739 3.341,1.372 5.068,1.691 1.606,0.297 5.042,0.225 6.39,-0.134 0.595,-0.159 1.37,-0.358 1.72,-0.442 1.198,-0.288 4.129,-1.822 5.32,-2.786 9.711,-7.857 8.716,-22.425 -1.957,-28.665 -3.504,-2.048 -8.663,-2.872 -12.167,-1.942 -0.55,0.146 -1.262,0.327 -1.583,0.403 -0.614,0.144 -1.774,0.627 -2.958,1.232 l -0.709,0.362 -11.105,-11.105 -11.105,-11.106 0.289,-0.561 c 3.009,-5.83 2.687,-12.491 -0.861,-17.825 -0.257,-0.386 -0.543,-0.821 -0.634,-0.965 -1.398,-2.203 -6.344,-5.524 -9.084,-6.099 -3.096,-0.651 -4.424,-0.766 -6.357,-0.551 m 4.095,8.912 c 6.101,1.712 8.316,9.521 3.993,14.078 -6.028,6.355 -16.205,1.325 -14.858,-7.345 0.559,-3.597 3.168,-6.047 7.544,-7.084 0.546,-0.13 2.249,0.05 3.321,0.351 M 59.946,91.812 c 2.314,0.806 4.061,2.37 5.152,4.615 l 0.644,1.323 v 2.25 2.25 l -0.648,1.332 c -3.748,7.711 -14.726,6.286 -16.362,-2.124 -1.223,-6.284 5.142,-11.76 11.214,-9.646 M 105,91.512 c 7.468,1.695 9.27,11.549 2.87,15.694 -7.325,4.746 -16.184,-3.082 -12.434,-10.986 0.56,-1.179 2.473,-3.387 2.935,-3.387 0.102,0 0.312,-0.113 0.465,-0.252 1.043,-0.944 4.259,-1.502 6.164,-1.069 m 46.441,0.171 c 4.417,1.35 7.025,5.54 6.148,9.877 -0.306,1.514 -0.863,2.879 -1.336,3.271 -0.139,0.116 -0.253,0.306 -0.253,0.424 0,0.307 -1.541,1.65 -2.554,2.224 -7.406,4.199 -15.743,-3.631 -12.051,-11.318 0.752,-1.565 3.286,-3.994 4.167,-3.994 0.112,0 0.276,-0.069 0.363,-0.153 0.713,-0.687 3.754,-0.87 5.516,-0.331 m -44.774,46.358 c 8.432,4.162 5.806,16.556 -3.5,16.523 C 100.595,154.555 96,152.103 96,150.74 c 0,-0.11 -0.106,-0.287 -0.236,-0.395 -1.065,-0.884 -1.517,-5.232 -0.754,-7.262 1.796,-4.781 7.334,-7.176 11.657,-5.042" />
  </g>
</svg>

</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <div class="navbar-content docutils container">
<ul class="navbar-toplevel">
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/getting-started.html" title="Get Started"><span class="navbar-link-title">Get Started</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/use-cases.html" title="Use Cases"><span class="navbar-link-title">Use Cases</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/examples.html" title="Example Gallery"><span class="navbar-link-title">Example Gallery</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-more-libs/installation.html" title="Library"><span class="navbar-link-title">Library</span></a></p>
<i class="fa-solid fa-chevron-down"></i></div>
<div class="navbar-dropdown docutils container">
<ul class="navbar-sublevel">
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-core/walkthrough.html" title="Ray Core"><span class="navbar-link-title">Ray Core</span>Scale general Python applications</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../data/data.html" title="Ray Data"><span class="navbar-link-title">Ray Data</span>Scale data ingest and preprocessing</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../train/train.html" title="Ray Train"><span class="navbar-link-title">Ray Train</span>Scale machine learning training</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../tune.html" title="Ray Tune"><span class="navbar-link-title">Ray Tune</span>Scale hyperparameter tuning</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../serve/index.html" title="Ray Serve"><span class="navbar-link-title">Ray Serve</span>Scale model serving</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../rllib/index.html" title="Ray RLlib"><span class="navbar-link-title">Ray RLlib</span>Scale reinforcement learning</a></p>
</div>
</li>
</ul>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../index.html" title="Docs"><span class="navbar-link-title">Docs</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://discuss.ray.io" title="Resources"><span class="navbar-link-title">Resources</span></a></p>
<i class="fa-solid fa-chevron-down"></i></div>
<div class="navbar-dropdown docutils container">
<ul class="navbar-sublevel">
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://discuss.ray.io" title="Discussion Forum"><span class="navbar-link-title">Discussion Forum</span>Get your Ray questions answered</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://github.com/ray-project/ray-educational-materials" title="Training"><span class="navbar-link-title">Training</span>Hands-on learning</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.anyscale.com/blog" title="Blog"><span class="navbar-link-title">Blog</span>Updates, best practices, user-stories</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.anyscale.com/events" title="Events"><span class="navbar-link-title">Events</span>Webinars, meetups, office hours</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.anyscale.com/blog/how-ray-and-anyscale-make-it-easy-to-do-massive-scale-machine-learning-on" title="Success Stories"><span class="navbar-link-title">Success Stories</span>Real-world workload examples</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/ray-libraries.html" title="Ecosystem"><span class="navbar-link-title">Ecosystem</span>Libraries integrated with Ray</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.ray.io/community" title="Community"><span class="navbar-link-title">Community</span>Connect with us</a></p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>

</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          <div id="docsearch"></div>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="versionswitcherbutton" type="button" role="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="listbox" aria-controls="versionswitcherlist" aria-label="Version switcher list">
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="versionswitcherlist" class="version-switcher__menu dropdown-menu list-group-flush py-0" role="listbox" aria-labelledby="versionswitcherbutton">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><a id="try-anyscale-href" href="https://console.anyscale.com/?utm_source=ray_docs&utm_medium=docs&utm_campaign=navbar">
  <div id="try-anyscale-text">
    <span>Try Ray on Anyscale</span>
  </div>
</a></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile"><div id="docsearch"></div>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <div class="navbar-content docutils container">
<ul class="navbar-toplevel">
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/getting-started.html" title="Get Started"><span class="navbar-link-title">Get Started</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/use-cases.html" title="Use Cases"><span class="navbar-link-title">Use Cases</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/examples.html" title="Example Gallery"><span class="navbar-link-title">Example Gallery</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-more-libs/installation.html" title="Library"><span class="navbar-link-title">Library</span></a></p>
<i class="fa-solid fa-chevron-down"></i></div>
<div class="navbar-dropdown docutils container">
<ul class="navbar-sublevel">
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-core/walkthrough.html" title="Ray Core"><span class="navbar-link-title">Ray Core</span>Scale general Python applications</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../data/data.html" title="Ray Data"><span class="navbar-link-title">Ray Data</span>Scale data ingest and preprocessing</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../train/train.html" title="Ray Train"><span class="navbar-link-title">Ray Train</span>Scale machine learning training</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../tune.html" title="Ray Tune"><span class="navbar-link-title">Ray Tune</span>Scale hyperparameter tuning</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../serve/index.html" title="Ray Serve"><span class="navbar-link-title">Ray Serve</span>Scale model serving</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../rllib/index.html" title="Ray RLlib"><span class="navbar-link-title">Ray RLlib</span>Scale reinforcement learning</a></p>
</div>
</li>
</ul>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../index.html" title="Docs"><span class="navbar-link-title">Docs</span></a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://discuss.ray.io" title="Resources"><span class="navbar-link-title">Resources</span></a></p>
<i class="fa-solid fa-chevron-down"></i></div>
<div class="navbar-dropdown docutils container">
<ul class="navbar-sublevel">
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://discuss.ray.io" title="Discussion Forum"><span class="navbar-link-title">Discussion Forum</span>Get your Ray questions answered</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://github.com/ray-project/ray-educational-materials" title="Training"><span class="navbar-link-title">Training</span>Hands-on learning</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.anyscale.com/blog" title="Blog"><span class="navbar-link-title">Blog</span>Updates, best practices, user-stories</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.anyscale.com/events" title="Events"><span class="navbar-link-title">Events</span>Webinars, meetups, office hours</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.anyscale.com/blog/how-ray-and-anyscale-make-it-easy-to-do-massive-scale-machine-learning-on" title="Success Stories"><span class="navbar-link-title">Success Stories</span>Real-world workload examples</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference internal" href="../../../../ray-overview/ray-libraries.html" title="Ecosystem"><span class="navbar-link-title">Ecosystem</span>Libraries integrated with Ray</a></p>
</div>
</li>
<li><div class="ref-container docutils container">
<p><a class="reference external" href="https://www.ray.io/community" title="Community"><span class="navbar-link-title">Community</span>Connect with us</a></p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>

</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="versionswitcherbutton" type="button" role="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="listbox" aria-controls="versionswitcherlist" aria-label="Version switcher list">
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="versionswitcherlist" class="version-switcher__menu dropdown-menu list-group-flush py-0" role="listbox" aria-labelledby="versionswitcherbutton">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><a id="try-anyscale-href" href="https://console.anyscale.com/?utm_source=ray_docs&utm_medium=docs&utm_campaign=navbar">
  <div id="try-anyscale-text">
    <span>Try Ray on Anyscale</span>
  </div>
</a></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav id="main-sidebar" class="bd-docs-nav bd-links" aria-label="Section Navigation">
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-overview/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-more-libs/installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../ray-overview/use-cases.html">Use Cases</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-air/getting-started.html">Ray for ML Infrastructure</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-overview/examples.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-overview/ray-libraries.html">Ecosystem</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../ray-core/walkthrough.html">Ray Core</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-core/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-core/user-guide.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-core/tasks.html">Tasks</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/tasks/nested-tasks.html">Nested Remote Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/tasks/generators.html">Dynamic generators</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-more-libs/actors.html">Actors</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/named-actors.html">Named Actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/terminating-actors.html">Terminating Actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/async_api.html">AsyncIO / Concurrency for Actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/concurrency_group_api.html">Limiting Concurrency Per-Method with Concurrency Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/actor-utils.html">Utility Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/out-of-band-communication.html">Out-of-band Communication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/actors/task-orders.html">Actor Task Execution Order</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-core/objects.html">Objects</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/objects/serialization.html">Serialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/objects/object-spilling.html">Object Spilling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/handling-dependencies.html">Environment Dependencies</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-core/scheduling/index.html">Scheduling</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/scheduling/resources.html">Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/scheduling/accelerators.html">Accelerator Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/scheduling/placement-group.html">Placement Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/scheduling/memory-management.html">Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/scheduling/ray-oom-prevention.html">Out-Of-Memory Prevention</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-core/fault-tolerance.html">Fault Tolerance</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/fault_tolerance/tasks.html">Task Fault Tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/fault_tolerance/actors.html">Actor Fault Tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/fault_tolerance/objects.html">Object Fault Tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/fault_tolerance/nodes.html">Node Fault Tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/fault_tolerance/gcs.html">GCS Fault Tolerance</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-core/patterns/index.html">Design Patterns &amp; Anti-patterns</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/nested-tasks.html">Pattern: Using nested tasks to achieve nested parallelism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/generators.html">Pattern: Using generators to reduce heap memory usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/limit-pending-tasks.html">Pattern: Using ray.wait to limit the number of pending tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/limit-running-tasks.html">Pattern: Using resources to limit the number of concurrently running tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/concurrent-operations-async-actor.html">Pattern: Using asyncio to run actor methods concurrently</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/actor-sync.html">Pattern: Using an actor to synchronize other tasks and actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/tree-of-actors.html">Pattern: Using a supervisor actor to manage a tree of actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/pipelining.html">Pattern: Using pipelining to increase throughput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/return-ray-put.html">Anti-pattern: Returning ray.put() ObjectRefs from a task harms performance and fault tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/ray-get-loop.html">Anti-pattern: Calling ray.get in a loop harms parallelism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/unnecessary-ray-get.html">Anti-pattern: Calling ray.get unnecessarily harms performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/ray-get-submission-order.html">Anti-pattern: Processing results in submission order using ray.get increases runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/ray-get-too-many-objects.html">Anti-pattern: Fetching too many objects at once with ray.get causes failure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/too-fine-grained-tasks.html">Anti-pattern: Over-parallelizing with too fine-grained tasks harms speedup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/redefine-task-actor-loop.html">Anti-pattern: Redefining the same remote function or class harms performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/pass-large-arg-by-value.html">Anti-pattern: Passing the same large argument by value repeatedly harms performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/closure-capture-large-objects.html">Anti-pattern: Closure capturing large objects harms performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/global-variables.html">Anti-pattern: Using global variables to share state between tasks and actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/patterns/out-of-band-object-ref-serialization.html">Anti-pattern: Serialize ray.ObjectRef out of band</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-core/advanced-topics.html">Advanced Topics</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/tips-for-first-time.html">Tips for first-time users</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/starting-ray.html">Starting Ray</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/ray-generator.html">Ray Generators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/namespaces.html">Using Namespaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/cross-language.html">Cross-Language Programming</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/using-ray-with-jupyter.html">Working with Jupyter Notebooks &amp; JupyterLab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/ray-dag.html">Lazy Computation Graphs with the Ray DAG API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/miscellaneous.html">Miscellaneous Topics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/runtime_env_auth.html">Authenticating Remote URIs in runtime_env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-core/user-spawn-processes.html">Lifetimes of a User-Spawn Process</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-core/examples/overview.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/automl_for_time_series.html">Simple AutoML for time series with Ray Core</a></li>

<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/batch_prediction.html">Batch Prediction with Ray Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/gentle_walkthrough.html">A Gentle Introduction to Ray Core by Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/highly_parallel.html">Using Ray for Highly Parallelizable Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/map_reduce.html">A Simple MapReduce Example with Ray Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/monte_carlo_pi.html">Monte Carlo Estimation of Ï€</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/plot_hyperparameter.html">Simple Parallel Model Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/plot_parameter_server.html">Parameter Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/plot_pong_example.html">Learning to Play Pong</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/examples/web-crawler.html">Speed up your web crawler by parallelizing it with Ray</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-core/api/index.html">Ray Core API</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/api/core.html">Core API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/api/scheduling.html">Scheduling API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/api/runtime-env.html">Runtime Env API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/api/utility.html">Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/api/exceptions.html">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-core/api/cli.html">Ray Core CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/reference/cli.html">State CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/reference/api.html">State API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../data/data.html">Ray Data</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../data/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data/quickstart.html">Quickstart</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../data/user-guide.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/loading-data.html">Loading Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/inspecting-data.html">Inspecting Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/transforming-data.html">Transforming Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/iterating-over-data.html">Iterating over Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/shuffling-data.html">Shuffling Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/saving-data.html">Saving Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/working-with-images.html">Working with Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/working-with-text.html">Working with Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/working-with-tensors.html">Working with Tensors / NumPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/working-with-pytorch.html">Working with PyTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/monitoring-your-workload.html">Monitoring Your Workload</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/execution-configurations.html">Execution Configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/batch_inference.html">End-to-end: Offline Batch Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/performance-tips.html">Advanced: Performance Tips and Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/custom-datasource-example.html">Advanced: Read and Write Custom File Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data/examples.html">Examples</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../data/api/api.html">Ray Data API</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/input_output.html">Input/Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/dataset.html">Dataset API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/data_iterator.html">DataIterator API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/execution_options.html">ExecutionOptions API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/grouped_data.html">GroupedData API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/data_context.html">Global configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/utility.html">Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/preprocessor.html">Preprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data/api/from_other_data_libs.html">API Guide for Users from Other Data Libraries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data/data-internals.html">Ray Data Internals</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../train/train.html">Ray Train</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/getting-started-pytorch.html">PyTorch Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/getting-started-pytorch-lightning.html">PyTorch Lightning Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/getting-started-transformers.html">Hugging Face Transformers Guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../train/more-frameworks.html">More Frameworks</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/huggingface-accelerate.html">Hugging Face Accelerate Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/deepspeed.html">DeepSpeed Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/distributed-tensorflow-keras.html">TensorFlow and Keras Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/distributed-xgboost-lightgbm.html">XGBoost and LightGBM Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/horovod.html">Horovod Guide</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../train/user-guides.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/data-loading-preprocessing.html">Data Loading and Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/using-gpus.html">Configuring Scale and GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/persistent-storage.html">Configuring Persistent Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/monitoring-logging.html">Monitoring and Logging Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/checkpoints.html">Saving and Loading Checkpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/experiment-tracking.html">Experiment Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/results.html">Inspecting Training Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/fault-tolerance.html">Handling Failures and Node Preemption</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/reproducibility.html">Reproducibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../train/user-guides/hyperparameter-optimization.html">Hyperparameter Optimization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../train/api/api.html">Ray Train API</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../tune.html">Ray Tune</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tune/getting-started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tune/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../tune/tutorials/overview.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-run.html">Running Basic Experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-output.html">Logging and Outputs in Tune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-resources.html">Setting Trial Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-search-spaces.html">Using Search Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-stopping.html">How to Define Stopping Criteria for a Ray Tune Experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-trial-checkpoints.html">How to Save and Load Trial Checkpoints</a></li>

<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-storage.html">How to Configure Persistent Storage in Ray Tune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-fault-tolerance.html">How to Enable Fault Tolerance in Ray Tune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-metrics.html">Using Callbacks and Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune_get_data_in_and_out.html">Getting Data in and out of Tune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/examples/tune_analyze_results.html">Analyzing Tune Experiment Results</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../tune/examples/pbt_guide.html">A Guide to Population Based Training with Tune</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/pbt_visualization/pbt_visualization.html">Visualizing and Understanding PBT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-distributed.html">Deploying Tune in the Cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-lifecycle.html">Tune Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/tutorials/tune-scalability.html">Scalability Benchmarks</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../tune/examples/index.html">Ray Tune Examples</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../tune/examples/ml-frameworks.html">Examples using Ray Tune with ML Frameworks</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune_mnist_keras.html">Keras Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-pytorch-cifar.html">PyTorch Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-pytorch-lightning.html">PyTorch Lightning Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/pbt_ppo_example.html">Ray RLlib Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-xgboost.html">XGBoost Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/lightgbm_example.html">LightGBM Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/horovod_simple.html">Horovod Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/pbt_transformers.html">Hugging Face Transformers Example</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../tune/examples/experiment-tracking.html">Tune Experiment Tracking Examples</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-wandb.html">Weights &amp; Biases Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-mlflow.html">MLflow Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-aim.html">Aim Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/tune-comet.html">Comet Example</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../tune/examples/hpo-frameworks.html">Tune Hyperparameter Optimization Framework Examples</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-25"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/ax_example.html">Ax Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/hyperopt_example.html">HyperOpt Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/bayesopt_example.html">Bayesopt Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/bohb_example.html">BOHB Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/nevergrad_example.html">Nevergrad Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tune/examples/optuna_example.html">Optuna Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/examples/other-examples.html">Other Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/examples/exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tune/faq.html">Ray Tune FAQ</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../tune/api/api.html">Ray Tune API</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-26"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/execution.html">Tune Execution (tune.Tuner)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/result_grid.html">Tune Experiment Results (tune.ResultGrid)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/trainable.html">Training in Tune (tune.Trainable, train.report)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/search_space.html">Tune Search Space API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/suggestion.html">Tune Search Algorithms (tune.search)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/schedulers.html">Tune Trial Schedulers (tune.schedulers)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/stoppers.html">Tune Stopping Mechanisms (tune.stopper)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/reporters.html">Tune Console Output (Reporters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/syncing.html">Syncing in Tune (train.SyncConfig)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/logging.html">Tune Loggers (tune.logger)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/callbacks.html">Tune Callbacks (tune.Callback)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/env.html">Environment variables used by Ray Tune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/integration.html">External library integrations for Ray Tune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/internals.html">Tune Internals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tune/api/cli.html">Tune CLI (Experimental)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../serve/index.html">Ray Serve</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-27"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/develop-and-deploy.html">Develop and Deploy an ML Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/model_composition.html">Deploy Compositions of Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/multi-app.html">Deploy Multiple Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/model-multiplexing.html">Model Multiplexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/configure-serve-deployment.html">Configure Ray Serve deployments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/http-guide.html">Set Up FastAPI and HTTP</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../serve/production-guide/index.html">Production Guide</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-28"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/production-guide/config.html">Serve Config Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/production-guide/kubernetes.html">Deploy on Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/production-guide/docker.html">Custom Docker Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/production-guide/fault-tolerance.html">Add End-to-End Fault Tolerance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/production-guide/handling-dependencies.html">Handle Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/production-guide/best-practices.html">Best practices in production</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/monitoring.html">Monitor Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/resource-allocation.html">Resource Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/autoscaling-guide.html">Ray Serve Autoscaling</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../serve/advanced-guides/index.html">Advanced Guides</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-29"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/app-builder-guide.html">Pass Arguments to Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/advanced-autoscaling.html">Advanced Ray Serve Autoscaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/performance.html">Performance Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/dyn-req-batch.html">Dynamic Request Batching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/inplace-updates.html">Updating Applications In-Place</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/dev-workflow.html">Development Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/grpc-guide.html">Set Up a gRPC Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/managing-java-deployments.html">Experimental Java API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/deploy-vm.html">Deploy on VM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../serve/advanced-guides/multi-app-container.html">Run Multiple Applications in Different Containers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/architecture.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../serve/api/index.html">Ray Serve API</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../rllib/index.html">Ray RLlib</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-30"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/rllib-training.html">Getting Started with RLlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/rllib-env.html">Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/rllib-algorithms.html">Algorithms</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../rllib/user-guides.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-31"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-advanced-api.html">Advanced Python APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-models.html">Models, Preprocessors, and Action Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-saving-and-loading-algos-and-policies.html">Saving and Loading your RL Algorithms and Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-concepts.html">How To Customize Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/single-agent-episode.html">Episodes</a></li>

<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-replay-buffers.html">Replay Buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-offline.html">Working With Offline Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-catalogs.html">Catalog (Alpha)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-rlmodule.html">RL Modules (Alpha)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-learner.html">Learner (Alpha)</a></li>



<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-torch2x.html">Using RLlib with torch 2.x compile</a></li>

<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-fault-tolerance.html">Fault Tolerance And Elastic Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/rllib-dev.html">Install RLlib for Development</a></li>




</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/rllib-examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/rllib-new-api-stack.html">RLlibâ€™s new API stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../rllib/new-api-stack-migration-guide.html">New API stack migration guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../rllib/package_ref/index.html">Ray RLlib API</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-32"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/algorithm.html">Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-33"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.copy.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.copy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.freeze.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.freeze</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner_group.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner_group</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.callbacks.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.debugging.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.environment.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.evaluation.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.experimental.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.experimental</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.fault_tolerance.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.fault_tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.framework.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.multi_agent.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.multi_agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.offline_data.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.offline_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.python_environment.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.python_environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.reporting.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.reporting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.resources.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rl_module.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rl_module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rollouts.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rollouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.training.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_learner_class.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_learner_class</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_rl_module_spec.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_rl_module_spec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_evaluation_config_object.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_evaluation_config_object</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_rl_module_spec.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_rl_module_spec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_agent_setup.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_agent_setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_rollout_fragment_length.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_rollout_fragment_length</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate_train_batch_size_vs_rollout_fragment_length.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate_train_batch_size_vs_rollout_fragment_length</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.html">ray.rllib.algorithms.algorithm.Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.setup.html">ray.rllib.algorithms.algorithm.Algorithm.setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.get_default_config.html">ray.rllib.algorithms.algorithm.Algorithm.get_default_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.compute_actions.html">ray.rllib.algorithms.algorithm.Algorithm.compute_actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.compute_single_action.html">ray.rllib.algorithms.algorithm.Algorithm.compute_single_action</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.evaluate.html">ray.rllib.algorithms.algorithm.Algorithm.evaluate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.from_checkpoint.html">ray.rllib.algorithms.algorithm.Algorithm.from_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.from_state.html">ray.rllib.algorithms.algorithm.Algorithm.from_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.get_weights.html">ray.rllib.algorithms.algorithm.Algorithm.get_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.set_weights.html">ray.rllib.algorithms.algorithm.Algorithm.set_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.export_model.html">ray.rllib.algorithms.algorithm.Algorithm.export_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.export_policy_checkpoint.html">ray.rllib.algorithms.algorithm.Algorithm.export_policy_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.export_policy_model.html">ray.rllib.algorithms.algorithm.Algorithm.export_policy_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.restore.html">ray.rllib.algorithms.algorithm.Algorithm.restore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.restore_workers.html">ray.rllib.algorithms.algorithm.Algorithm.restore_workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.save.html">ray.rllib.algorithms.algorithm.Algorithm.save</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.save_checkpoint.html">ray.rllib.algorithms.algorithm.Algorithm.save_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.train.html">ray.rllib.algorithms.algorithm.Algorithm.train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.training_step.html">ray.rllib.algorithms.algorithm.Algorithm.training_step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.add_policy.html">ray.rllib.algorithms.algorithm.Algorithm.add_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm.Algorithm.remove_policy.html">ray.rllib.algorithms.algorithm.Algorithm.remove_policy</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/env.html">Environments</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-34"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/env/base_env.html">BaseEnv API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/env/multi_agent_env.html">MultiAgentEnv API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/env/vector_env.html">VectorEnv API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/env/external_env.html">ExternalEnv API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/env/single_agent_episode.html">SingleAgentEpisode API</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/policy.html">Policy API</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-35"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy.Policy.html">ray.rllib.policy.policy.Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.make_model.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.make_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.make_model_and_action_dist.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.make_model_and_action_dist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.make_model.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.make_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy.Policy.compute_actions.html">ray.rllib.policy.policy.Policy.compute_actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy.Policy.compute_actions_from_input_dict.html">ray.rllib.policy.policy.Policy.compute_actions_from_input_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy.Policy.compute_single_action.html">ray.rllib.policy.policy.Policy.compute_single_action</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.action_sampler_fn.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.action_sampler_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.action_distribution_fn.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.action_distribution_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.extra_action_out.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.extra_action_out</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.action_sampler_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.action_sampler_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.action_distribution_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.action_distribution_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.extra_action_out_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.extra_action_out_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.compute_gradients.html">ray.rllib.policy.Policy.compute_gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.apply_gradients.html">ray.rllib.policy.Policy.apply_gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.extra_compute_grad_fetches.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.extra_compute_grad_fetches</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.extra_grad_process.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.extra_grad_process</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.grad_stats_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.grad_stats_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.compute_gradients_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.compute_gradients_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.apply_gradients_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.apply_gradients_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.extra_learn_fetches_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.extra_learn_fetches_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.learn_on_batch.html">ray.rllib.policy.Policy.learn_on_batch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.load_batch_into_buffer.html">ray.rllib.policy.Policy.load_batch_into_buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.learn_on_loaded_batch.html">ray.rllib.policy.Policy.learn_on_loaded_batch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.learn_on_batch_from_replay_buffer.html">ray.rllib.policy.Policy.learn_on_batch_from_replay_buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.get_num_samples_loaded_into_buffer.html">ray.rllib.policy.Policy.get_num_samples_loaded_into_buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.loss.html">ray.rllib.policy.Policy.loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.compute_log_likelihoods.html">ray.rllib.policy.Policy.compute_log_likelihoods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.on_global_var_update.html">ray.rllib.policy.Policy.on_global_var_update</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.postprocess_trajectory.html">ray.rllib.policy.Policy.postprocess_trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.optimizer.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.get_tower_stats.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.get_tower_stats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.optimizer.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.stats_fn.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.stats_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.from_checkpoint.html">ray.rllib.policy.Policy.from_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.export_checkpoint.html">ray.rllib.policy.Policy.export_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.export_model.html">ray.rllib.policy.Policy.export_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.from_state.html">ray.rllib.policy.Policy.from_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.get_weights.html">ray.rllib.policy.Policy.get_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.set_weights.html">ray.rllib.policy.Policy.set_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.get_state.html">ray.rllib.policy.Policy.get_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.set_state.html">ray.rllib.policy.Policy.set_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.import_model_from_h5.html">ray.rllib.policy.Policy.import_model_from_h5</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.Policy.get_initial_state.html">ray.rllib.Policy.get_initial_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.Policy.num_state_tensors.html">ray.rllib.Policy.num_state_tensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.Policy.is_recurrent.html">ray.rllib.Policy.is_recurrent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.apply.html">ray.rllib.policy.Policy.apply</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.get_session.html">ray.rllib.policy.Policy.get_session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.init_view_requirements.html">ray.rllib.policy.Policy.init_view_requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.get_host.html">ray.rllib.policy.Policy.get_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.Policy.get_exploration_state.html">ray.rllib.policy.Policy.get_exploration_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.torch_policy_v2.TorchPolicyV2.get_batch_divisibility_req.html">ray.rllib.policy.torch_policy_v2.TorchPolicyV2.get_batch_divisibility_req</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.variables.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.get_batch_divisibility_req.html">ray.rllib.policy.eager_tf_policy_v2.EagerTFPolicyV2.get_batch_divisibility_req</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/models.html">Model APIs</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-36"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.html">ray.rllib.models.modelv2.ModelV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.torch.torch_modelv2.TorchModelV2.html">ray.rllib.models.torch.torch_modelv2.TorchModelV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.tf.tf_modelv2.TFModelV2.html">ray.rllib.models.tf.tf_modelv2.TFModelV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.forward.html">ray.rllib.models.modelv2.ModelV2.forward</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.value_function.html">ray.rllib.models.modelv2.ModelV2.value_function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.last_output.html">ray.rllib.models.modelv2.ModelV2.last_output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.get_initial_state.html">ray.rllib.models.modelv2.ModelV2.get_initial_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.is_time_major.html">ray.rllib.models.modelv2.ModelV2.is_time_major</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.variables.html">ray.rllib.models.modelv2.ModelV2.variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.trainable_variables.html">ray.rllib.models.modelv2.ModelV2.trainable_variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.distributions.Distribution.html">ray.rllib.models.distributions.Distribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.custom_loss.html">ray.rllib.models.modelv2.ModelV2.custom_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.models.modelv2.ModelV2.metrics.html">ray.rllib.models.modelv2.ModelV2.metrics</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/catalogs.html">Catalog API</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-37"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog.html">ray.rllib.core.models.catalog.Catalog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog.build_encoder.html">ray.rllib.core.models.catalog.Catalog.build_encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog.get_action_dist_cls.html">ray.rllib.core.models.catalog.Catalog.get_action_dist_cls</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog.get_tokenizer_config.html">ray.rllib.core.models.catalog.Catalog.get_tokenizer_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog.latent_dims.html">ray.rllib.core.models.catalog.Catalog.latent_dims</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog._determine_components_hook.html">ray.rllib.core.models.catalog.Catalog._determine_components_hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog._get_encoder_config.html">ray.rllib.core.models.catalog.Catalog._get_encoder_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.models.catalog.Catalog._get_dist_cls_from_action_space.html">ray.rllib.core.models.catalog.Catalog._get_dist_cls_from_action_space</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/rl_modules.html">RLModule API</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-38"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleSpec.html">ray.rllib.core.rl_module.rl_module.RLModuleSpec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleSpec.build.html">ray.rllib.core.rl_module.rl_module.RLModuleSpec.build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleSpec.get_rl_module_config.html">ray.rllib.core.rl_module.rl_module.RLModuleSpec.get_rl_module_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleConfig.html">ray.rllib.core.rl_module.rl_module.RLModuleConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleConfig.to_dict.html">ray.rllib.core.rl_module.rl_module.RLModuleConfig.to_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleConfig.from_dict.html">ray.rllib.core.rl_module.rl_module.RLModuleConfig.from_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModuleConfig.get_catalog.html">ray.rllib.core.rl_module.rl_module.RLModuleConfig.get_catalog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModuleSpec.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModuleSpec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModuleSpec.build.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModuleSpec.build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModuleSpec.get_multi_rl_module_config.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModuleSpec.get_multi_rl_module_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.html">ray.rllib.core.rl_module.rl_module.RLModule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.as_multi_rl_module.html">ray.rllib.core.rl_module.rl_module.RLModule.as_multi_rl_module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.forward_train.html">ray.rllib.core.rl_module.rl_module.RLModule.forward_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.forward_exploration.html">ray.rllib.core.rl_module.rl_module.RLModule.forward_exploration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.forward_inference.html">ray.rllib.core.rl_module.rl_module.RLModule.forward_inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule._forward_train.html">ray.rllib.core.rl_module.rl_module.RLModule._forward_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule._forward_exploration.html">ray.rllib.core.rl_module.rl_module.RLModule._forward_exploration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule._forward_inference.html">ray.rllib.core.rl_module.rl_module.RLModule._forward_inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.input_specs_inference.html">ray.rllib.core.rl_module.rl_module.RLModule.input_specs_inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.input_specs_exploration.html">ray.rllib.core.rl_module.rl_module.RLModule.input_specs_exploration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.input_specs_train.html">ray.rllib.core.rl_module.rl_module.RLModule.input_specs_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.output_specs_inference.html">ray.rllib.core.rl_module.rl_module.RLModule.output_specs_inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.output_specs_exploration.html">ray.rllib.core.rl_module.rl_module.RLModule.output_specs_exploration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.output_specs_train.html">ray.rllib.core.rl_module.rl_module.RLModule.output_specs_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.get_state.html">ray.rllib.core.rl_module.rl_module.RLModule.get_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.set_state.html">ray.rllib.core.rl_module.rl_module.RLModule.set_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.save_to_path.html">ray.rllib.core.rl_module.rl_module.RLModule.save_to_path</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.restore_from_path.html">ray.rllib.core.rl_module.rl_module.RLModule.restore_from_path</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.rl_module.RLModule.from_checkpoint.html">ray.rllib.core.rl_module.rl_module.RLModule.from_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.setup.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.as_multi_rl_module.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.as_multi_rl_module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.add_module.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.add_module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.remove_module.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.remove_module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.save_to_path.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.save_to_path</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.restore_from_path.html">ray.rllib.core.rl_module.multi_rl_module.MultiRLModule.restore_from_path</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/learner.html">LearnerGroup API</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-39"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.resources.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rl_module.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rl_module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.training.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner_group.html">ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner_group</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.learner.learner_group.LearnerGroup.html">ray.rllib.core.learner.learner_group.LearnerGroup</a></li>
</ul>
</li>

<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/evaluation.html">Sampling the Environment or offline data</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-40"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.html">ray.rllib.evaluation.rollout_worker.RolloutWorker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.add_policy.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.add_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.remove_policy.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.remove_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_policy.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.set_is_policy_to_train.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.set_is_policy_to_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.set_policy_mapping_fn.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.set_policy_mapping_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.for_policy.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.for_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_policy.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_policy_to_train.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_policy_to_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_filters.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_global_vars.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_global_vars</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.set_global_vars.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.set_global_vars</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_host.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_metrics.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_node_ip.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_node_ip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_weights.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.set_weights.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.set_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.get_state.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.get_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.set_state.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.set_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.lock.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.lock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.unlock.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.unlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.sample.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.sample_with_count.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.sample_with_count</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.sample_and_learn.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.sample_and_learn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.learn_on_batch.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.learn_on_batch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.setup_torch_data_parallel.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.setup_torch_data_parallel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.compute_gradients.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.compute_gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.apply_gradients.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.apply_gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_env.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_env_with_context.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.foreach_env_with_context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.stop.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.apply.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.apply</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.sync_filters.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.sync_filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.find_free_port.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.find_free_port</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.creation_args.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.creation_args</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.rollout_worker.RolloutWorker.assert_healthy.html">ray.rllib.evaluation.rollout_worker.RolloutWorker.assert_healthy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner.EnvRunner.html">ray.rllib.env.env_runner.EnvRunner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.html">ray.rllib.env.env_runner_group.EnvRunnerGroup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.stop.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.reset.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.add_workers.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.add_workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_worker.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_worker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_worker_with_id.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_worker_with_id</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_worker_async.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_worker_async</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.fetch_ready_async_reqs.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.fetch_ready_async_reqs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.num_in_flight_async_reqs.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.num_in_flight_async_reqs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.local_worker.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.local_worker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.remote_workers.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.remote_workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.num_healthy_remote_workers.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.num_healthy_remote_workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.num_healthy_workers.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.num_healthy_workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.num_remote_worker_restarts.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.num_remote_worker_restarts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.probe_unhealthy_workers.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.probe_unhealthy_workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.add_policy.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.add_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_env.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_env_with_context.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_env_with_context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_policy.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_policy_to_train.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.foreach_policy_to_train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.env.env_runner_group.EnvRunnerGroup.sync_weights.html">ray.rllib.env.env_runner_group.EnvRunnerGroup.sync_weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.input_reader.InputReader.html">ray.rllib.offline.input_reader.InputReader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.input_reader.InputReader.next.html">ray.rllib.offline.input_reader.InputReader.next</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.sampler.SamplerInput.html">ray.rllib.evaluation.sampler.SamplerInput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.sampler.SamplerInput.get_data.html">ray.rllib.evaluation.sampler.SamplerInput.get_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.sampler.SamplerInput.get_extra_batches.html">ray.rllib.evaluation.sampler.SamplerInput.get_extra_batches</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.sampler.SamplerInput.get_metrics.html">ray.rllib.evaluation.sampler.SamplerInput.get_metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.evaluation.sampler.SyncSampler.html">ray.rllib.evaluation.sampler.SyncSampler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.json_reader.JsonReader.html">ray.rllib.offline.json_reader.JsonReader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.json_reader.JsonReader.read_all_files.html">ray.rllib.offline.json_reader.JsonReader.read_all_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.mixed_input.MixedInput.html">ray.rllib.offline.mixed_input.MixedInput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.d4rl_reader.D4RLReader.html">ray.rllib.offline.d4rl_reader.D4RLReader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.io_context.IOContext.html">ray.rllib.offline.io_context.IOContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.offline.io_context.IOContext.default_sampler_input.html">ray.rllib.offline.io_context.IOContext.default_sampler_input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy_map.PolicyMap.html">ray.rllib.policy.policy_map.PolicyMap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy_map.PolicyMap.items.html">ray.rllib.policy.policy_map.PolicyMap.items</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy_map.PolicyMap.keys.html">ray.rllib.policy.policy_map.PolicyMap.keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.policy_map.PolicyMap.values.html">ray.rllib.policy.policy_map.PolicyMap.values</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.html">ray.rllib.policy.sample_batch.SampleBatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.set_get_interceptor.html">ray.rllib.policy.sample_batch.SampleBatch.set_get_interceptor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.is_training.html">ray.rllib.policy.sample_batch.SampleBatch.is_training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.set_training.html">ray.rllib.policy.sample_batch.SampleBatch.set_training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.as_multi_agent.html">ray.rllib.policy.sample_batch.SampleBatch.as_multi_agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.get.html">ray.rllib.policy.sample_batch.SampleBatch.get</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.to_device.html">ray.rllib.policy.sample_batch.SampleBatch.to_device</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.right_zero_pad.html">ray.rllib.policy.sample_batch.SampleBatch.right_zero_pad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.slice.html">ray.rllib.policy.sample_batch.SampleBatch.slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.split_by_episode.html">ray.rllib.policy.sample_batch.SampleBatch.split_by_episode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.shuffle.html">ray.rllib.policy.sample_batch.SampleBatch.shuffle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.columns.html">ray.rllib.policy.sample_batch.SampleBatch.columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.rows.html">ray.rllib.policy.sample_batch.SampleBatch.rows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.copy.html">ray.rllib.policy.sample_batch.SampleBatch.copy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.is_single_trajectory.html">ray.rllib.policy.sample_batch.SampleBatch.is_single_trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.is_terminated_or_truncated.html">ray.rllib.policy.sample_batch.SampleBatch.is_terminated_or_truncated</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.env_steps.html">ray.rllib.policy.sample_batch.SampleBatch.env_steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.SampleBatch.agent_steps.html">ray.rllib.policy.sample_batch.SampleBatch.agent_steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.MultiAgentBatch.html">ray.rllib.policy.sample_batch.MultiAgentBatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.MultiAgentBatch.env_steps.html">ray.rllib.policy.sample_batch.MultiAgentBatch.env_steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.policy.sample_batch.MultiAgentBatch.agent_steps.html">ray.rllib.policy.sample_batch.MultiAgentBatch.agent_steps</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/replay-buffers.html">Replay Buffer API</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-41"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.replay_buffer.StorageUnit.html">ray.rllib.utils.replay_buffers.replay_buffer.StorageUnit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.html">ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.prioritized_replay_buffer.PrioritizedReplayBuffer.html">ray.rllib.utils.replay_buffers.prioritized_replay_buffer.PrioritizedReplayBuffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.reservoir_replay_buffer.ReservoirReplayBuffer.html">ray.rllib.utils.replay_buffers.reservoir_replay_buffer.ReservoirReplayBuffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.sample.html">ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.add.html">ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.add</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.get_state.html">ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.get_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.set_state.html">ray.rllib.utils.replay_buffers.replay_buffer.ReplayBuffer.set_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.multi_agent_replay_buffer.MultiAgentReplayBuffer.html">ray.rllib.utils.replay_buffers.multi_agent_replay_buffer.MultiAgentReplayBuffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.multi_agent_prioritized_replay_buffer.MultiAgentPrioritizedReplayBuffer.html">ray.rllib.utils.replay_buffers.multi_agent_prioritized_replay_buffer.MultiAgentPrioritizedReplayBuffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.utils.update_priorities_in_replay_buffer.html">ray.rllib.utils.replay_buffers.utils.update_priorities_in_replay_buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.replay_buffers.utils.sample_min_n_steps_from_buffer.html">ray.rllib.utils.replay_buffers.utils.sample_min_n_steps_from_buffer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../rllib/package_ref/utils.html">RLlib Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-42"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.html">ray.rllib.utils.exploration.exploration.Exploration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.random.Random.html">ray.rllib.utils.exploration.random.Random</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.stochastic_sampling.StochasticSampling.html">ray.rllib.utils.exploration.stochastic_sampling.StochasticSampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.epsilon_greedy.EpsilonGreedy.html">ray.rllib.utils.exploration.epsilon_greedy.EpsilonGreedy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.gaussian_noise.GaussianNoise.html">ray.rllib.utils.exploration.gaussian_noise.GaussianNoise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.ornstein_uhlenbeck_noise.OrnsteinUhlenbeckNoise.html">ray.rllib.utils.exploration.ornstein_uhlenbeck_noise.OrnsteinUhlenbeckNoise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.random_encoder.RE3.html">ray.rllib.utils.exploration.random_encoder.RE3</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.curiosity.Curiosity.html">ray.rllib.utils.exploration.curiosity.Curiosity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.parameter_noise.ParameterNoise.html">ray.rllib.utils.exploration.parameter_noise.ParameterNoise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.get_exploration_action.html">ray.rllib.utils.exploration.exploration.Exploration.get_exploration_action</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.before_compute_actions.html">ray.rllib.utils.exploration.exploration.Exploration.before_compute_actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.on_episode_start.html">ray.rllib.utils.exploration.exploration.Exploration.on_episode_start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.on_episode_end.html">ray.rllib.utils.exploration.exploration.Exploration.on_episode_end</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.postprocess_trajectory.html">ray.rllib.utils.exploration.exploration.Exploration.postprocess_trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.get_state.html">ray.rllib.utils.exploration.exploration.Exploration.get_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.exploration.exploration.Exploration.set_state.html">ray.rllib.utils.exploration.exploration.Exploration.set_state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.schedule.Schedule.html">ray.rllib.utils.schedules.schedule.Schedule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.constant_schedule.ConstantSchedule.html">ray.rllib.utils.schedules.constant_schedule.ConstantSchedule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.linear_schedule.LinearSchedule.html">ray.rllib.utils.schedules.linear_schedule.LinearSchedule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.piecewise_schedule.PiecewiseSchedule.html">ray.rllib.utils.schedules.piecewise_schedule.PiecewiseSchedule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.exponential_schedule.ExponentialSchedule.html">ray.rllib.utils.schedules.exponential_schedule.ExponentialSchedule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.polynomial_schedule.PolynomialSchedule.html">ray.rllib.utils.schedules.polynomial_schedule.PolynomialSchedule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.schedule.Schedule.value.html">ray.rllib.utils.schedules.schedule.Schedule.value</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.schedules.schedule.Schedule.__call__.html">ray.rllib.utils.schedules.schedule.Schedule.__call__</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.execution.train_ops.multi_gpu_train_one_step.html">ray.rllib.execution.train_ops.multi_gpu_train_one_step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.execution.train_ops.train_one_step.html">ray.rllib.execution.train_ops.train_one_step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.framework.try_import_torch.html">ray.rllib.utils.framework.try_import_torch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.framework.try_import_tf.html">ray.rllib.utils.framework.try_import_tf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.framework.try_import_tfp.html">ray.rllib.utils.framework.try_import_tfp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.explained_variance.html">ray.rllib.utils.tf_utils.explained_variance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.flatten_inputs_to_1d_tensor.html">ray.rllib.utils.tf_utils.flatten_inputs_to_1d_tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.get_gpu_devices.html">ray.rllib.utils.tf_utils.get_gpu_devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.get_placeholder.html">ray.rllib.utils.tf_utils.get_placeholder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.huber_loss.html">ray.rllib.utils.tf_utils.huber_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.l2_loss.html">ray.rllib.utils.tf_utils.l2_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.make_tf_callable.html">ray.rllib.utils.tf_utils.make_tf_callable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.minimize_and_clip.html">ray.rllib.utils.tf_utils.minimize_and_clip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.one_hot.html">ray.rllib.utils.tf_utils.one_hot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.reduce_mean_ignore_inf.html">ray.rllib.utils.tf_utils.reduce_mean_ignore_inf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.scope_vars.html">ray.rllib.utils.tf_utils.scope_vars</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.warn_if_infinite_kl_divergence.html">ray.rllib.utils.tf_utils.warn_if_infinite_kl_divergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tf_utils.zero_logps_from_actions.html">ray.rllib.utils.tf_utils.zero_logps_from_actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.apply_grad_clipping.html">ray.rllib.utils.torch_utils.apply_grad_clipping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.concat_multi_gpu_td_errors.html">ray.rllib.utils.torch_utils.concat_multi_gpu_td_errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.convert_to_torch_tensor.html">ray.rllib.utils.torch_utils.convert_to_torch_tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.explained_variance.html">ray.rllib.utils.torch_utils.explained_variance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.flatten_inputs_to_1d_tensor.html">ray.rllib.utils.torch_utils.flatten_inputs_to_1d_tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.global_norm.html">ray.rllib.utils.torch_utils.global_norm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.huber_loss.html">ray.rllib.utils.torch_utils.huber_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.l2_loss.html">ray.rllib.utils.torch_utils.l2_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.minimize_and_clip.html">ray.rllib.utils.torch_utils.minimize_and_clip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.one_hot.html">ray.rllib.utils.torch_utils.one_hot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.reduce_mean_ignore_inf.html">ray.rllib.utils.torch_utils.reduce_mean_ignore_inf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.sequence_mask.html">ray.rllib.utils.torch_utils.sequence_mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.warn_if_infinite_kl_divergence.html">ray.rllib.utils.torch_utils.warn_if_infinite_kl_divergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.set_torch_seed.html">ray.rllib.utils.torch_utils.set_torch_seed</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.torch_utils.softmax_cross_entropy_with_logits.html">ray.rllib.utils.torch_utils.softmax_cross_entropy_with_logits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.aligned_array.html">ray.rllib.utils.numpy.aligned_array</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.concat_aligned.html">ray.rllib.utils.numpy.concat_aligned</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.convert_to_numpy.html">ray.rllib.utils.numpy.convert_to_numpy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.fc.html">ray.rllib.utils.numpy.fc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.flatten_inputs_to_1d_tensor.html">ray.rllib.utils.numpy.flatten_inputs_to_1d_tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.make_action_immutable.html">ray.rllib.utils.numpy.make_action_immutable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.huber_loss.html">ray.rllib.utils.numpy.huber_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.l2_loss.html">ray.rllib.utils.numpy.l2_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.lstm.html">ray.rllib.utils.numpy.lstm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.one_hot.html">ray.rllib.utils.numpy.one_hot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.relu.html">ray.rllib.utils.numpy.relu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.sigmoid.html">ray.rllib.utils.numpy.sigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.numpy.softmax.html">ray.rllib.utils.numpy.softmax</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.checkpoints.Checkpointable.html">ray.rllib.utils.checkpoints.Checkpointable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.checkpoints.convert_to_msgpack_checkpoint.html">ray.rllib.utils.checkpoints.convert_to_msgpack_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.checkpoints.convert_to_msgpack_policy_checkpoint.html">ray.rllib.utils.checkpoints.convert_to_msgpack_policy_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.checkpoints.get_checkpoint_info.html">ray.rllib.utils.checkpoints.get_checkpoint_info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.checkpoints.try_import_msgpack.html">ray.rllib.utils.checkpoints.try_import_msgpack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.policy.compute_log_likelihoods_from_input_dict.html">ray.rllib.utils.policy.compute_log_likelihoods_from_input_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.policy.create_policy_for_framework.html">ray.rllib.utils.policy.create_policy_for_framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.policy.local_policy_inference.html">ray.rllib.utils.policy.local_policy_inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.policy.parse_policy_specs_from_checkpoint.html">ray.rllib.utils.policy.parse_policy_specs_from_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.utils.tensor_dtype.get_np_dtype.html">ray.rllib.utils.tensor_dtype.get_np_dtype</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.common.CLIArguments.html">ray.rllib.common.CLIArguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.common.FrameworkEnum.html">ray.rllib.common.FrameworkEnum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.common.SupportedFileType.html">ray.rllib.common.SupportedFileType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.core.rl_module.validate_module_id.html">ray.rllib.core.rl_module.validate_module_id</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rllib/package_ref/doc/ray.rllib.train.load_experiments_from_file.html">ray.rllib.train.load_experiments_from_file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rllib/package_ref/external-app.html">External Application API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../ray-more-libs/index.html">More Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-43"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../joblib.html">Distributed Scikit-learn / Joblib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-more-libs/multiprocessing.html">Distributed multiprocessing.Pool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-more-libs/ray-collective.html">Ray Collective Communication Lib</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-more-libs/dask-on-ray.html">Using Dask on Ray</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-44"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.RayDaskCallback.html">ray.util.dask.RayDaskCallback</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-45"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.RayDaskCallback.ray_active.html">ray.util.dask.RayDaskCallback.ray_active</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.callbacks.RayDaskCallback._ray_presubmit.html">ray.util.dask.callbacks.RayDaskCallback._ray_presubmit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.callbacks.RayDaskCallback._ray_postsubmit.html">ray.util.dask.callbacks.RayDaskCallback._ray_postsubmit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.callbacks.RayDaskCallback._ray_pretask.html">ray.util.dask.callbacks.RayDaskCallback._ray_pretask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.callbacks.RayDaskCallback._ray_posttask.html">ray.util.dask.callbacks.RayDaskCallback._ray_posttask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.callbacks.RayDaskCallback._ray_postsubmit_all.html">ray.util.dask.callbacks.RayDaskCallback._ray_postsubmit_all</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-more-libs/doc/ray.util.dask.callbacks.RayDaskCallback._ray_finish.html">ray.util.dask.callbacks.RayDaskCallback._ray_finish</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-more-libs/raydp.html">Using Spark on Ray (RayDP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-more-libs/mars-on-ray.html">Using Mars on Ray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-more-libs/modin/index.html">Using Pandas on Ray (Modin)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../workflows/index.html">Ray Workflows (Alpha)</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-46"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/basics.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/management.html">Workflow Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/metadata.html">Workflow Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/events.html">Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/comparison.html">API Comparisons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../workflows/advanced.html">Advanced Topics</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../workflows/api/api.html">Ray Workflows API</a><input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-47"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../workflows/api/execution.html">Workflow Execution API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../workflows/api/management.html">Workflow Management API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../ray-more-libs/cluster/index.html">Ray Clusters</a><input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-48"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../cluster/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/index.html">Deploying on Kubernetes</a><input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-49"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/getting-started.html">Getting Started with KubeRay</a><input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-50"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/getting-started/raycluster-quick-start.html">RayCluster Quickstart</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/getting-started/rayjob-quick-start.html">RayJob Quickstart</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/getting-started/rayservice-quick-start.html">RayService Quickstart</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-51"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/rayservice.html">Deploy Ray Serve Apps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/rayservice-high-availability.html">RayService high availability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/observability.html">KubeRay Observability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/upgrade-guide.html">KubeRay upgrade guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/k8s-cluster-setup.html">Managed Kubernetes services</a></li>



<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/storage.html">Best Practices for Storage and Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/config.html">RayCluster Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/configuring-autoscaling.html">KubeRay Autoscaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/kuberay-gcs-ft.html">GCS fault tolerance in KubeRay</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/gke-gcs-bucket.html">Configuring KubeRay to use Google Cloud Storage Buckets in GKE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/logging.html">Log Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/gpu.html">Using GPUs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/tpu.html">Use TPUs with KubeRay</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/rayserve-dev-doc.html">Developing Ray Serve Python scripts on a RayCluster</a></li>









<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/pod-command.html">Specify container commands for Ray head/worker Pods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/pod-security.html">Pod Security</a></li>






<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/helm-chart-rbac.html">Helm Chart RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/tls.html">TLS Authentication</a></li>






<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/k8s-autoscaler.html">(Advanced) Understanding the Ray Autoscaler in the Context of Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/user-guides/static-ray-cluster-without-kuberay.html">(Advanced) Deploying a static Ray cluster without KubeRay</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-52"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/ml-example.html">Ray Train XGBoostTrainer on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/gpu-training-example.html">Train PyTorch ResNet model with GPUs on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/mnist-training-example.html">Train a PyTorch model on Fashion MNIST with CPUs on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/stable-diffusion-rayservice.html">Serve a StableDiffusion text-to-image model on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/tpu-serve-stable-diffusion.html">Serve a Stable Diffusion model on GKE with TPUs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/mobilenet-rayservice.html">Serve a MobileNet image classifier on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/text-summarizer-rayservice.html">Serve a text summarizer on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/rayjob-batch-inference-example.html">RayJob Batch Inference Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/rayjob-kueue-priority-scheduling.html">Priority Scheduling with RayJob and Kueue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/rayjob-kueue-gang-scheduling.html">Gang Scheduling with RayJob and Kueue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/distributed-checkpointing-with-gcsfuse.html">Distributed checkpointing with KubeRay and GCSFuse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/modin-example.html">Use Modin with Ray on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/examples/vllm-rayservice.html">Serve a Large Language Model with vLLM on Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem.html">KubeRay Ecosystem</a><input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-53"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/ingress.html">Ingress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/prometheus-grafana.html">Using Prometheus and Grafana</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/pyspy.html">Profiling with py-spy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/volcano.html">KubeRay integration with Volcano</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/kubeflow.html">Kubeflow: an interactive development solution</a></li>


<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/kueue.html">Gang scheduling and priority scheduling for RayJob with Kueue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/k8s-ecosystem/istio.html">mTLS and L7 observability with Istio</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/benchmarks.html">KubeRay Benchmarks</a><input class="toctree-checkbox" id="toctree-checkbox-54" name="toctree-checkbox-54" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-54"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/benchmarks/memory-scalability-benchmark.html">KubeRay memory and scalability benchmark</a></li>

</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/kubernetes/troubleshooting.html">KubeRay Troubleshooting</a><input class="toctree-checkbox" id="toctree-checkbox-55" name="toctree-checkbox-55" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-55"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/troubleshooting/troubleshooting.html">Troubleshooting guide</a></li>

<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/kubernetes/troubleshooting/rayservice-troubleshooting.html">RayService troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/kubernetes/references.html">API Reference</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../cluster/vms/index.html">Deploying on VMs</a><input class="toctree-checkbox" id="toctree-checkbox-56" name="toctree-checkbox-56" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-56"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/vms/getting-started.html">Getting Started</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/vms/user-guides/index.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-57" name="toctree-checkbox-57" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-57"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/user-guides/launching-clusters/index.html">Launching Ray Clusters on AWS, GCP, Azure, vSphere, On-Prem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/user-guides/large-cluster-best-practices.html">Best practices for deploying large clusters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/user-guides/configuring-autoscaling.html">Configuring Autoscaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/user-guides/logging.html">Log Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/user-guides/community/index.html">Community Supported Cluster Managers</a></li>

</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/vms/examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-58" name="toctree-checkbox-58" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-58"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/examples/ml-example.html">Ray Train XGBoostTrainer on VMs</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/vms/references/index.html">API References</a><input class="toctree-checkbox" id="toctree-checkbox-59" name="toctree-checkbox-59" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-59"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/references/ray-cluster-cli.html">Cluster Launcher Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/vms/references/ray-cluster-configuration.html">Cluster YAML Configuration Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../cluster/metrics.html">Collecting and monitoring metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../cluster/configure-manage-dashboard.html">Configuring and Managing Ray Dashboard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../cluster/running-applications/index.html">Applications Guide</a><input class="toctree-checkbox" id="toctree-checkbox-60" name="toctree-checkbox-60" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-60"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/index.html">Ray Jobs Overview</a><input class="toctree-checkbox" id="toctree-checkbox-61" name="toctree-checkbox-61" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-61"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/quickstart.html">Quickstart using the Ray Jobs CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/sdk.html">Python SDK Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/jobs-package-ref.html">Python SDK API Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/cli.html">Ray Jobs CLI API Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/rest.html">Ray Jobs REST API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/ray-client.html">Ray Client</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/running-applications/autoscaling/reference.html">Programmatic Cluster Scaling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../cluster/faq.html">FAQ</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../cluster/package-overview.html">Ray Cluster Management API</a><input class="toctree-checkbox" id="toctree-checkbox-62" name="toctree-checkbox-62" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-62"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/cli.html">Cluster Management CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/jobs-package-ref.html">Python SDK API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/running-applications/job-submission/cli.html">Ray Jobs CLI API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../cluster/running-applications/autoscaling/reference.html">Programmatic Cluster Scaling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../cluster/usage-stats.html">Usage Stats Collection</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../ray-observability/index.html">Monitoring and Debugging</a><input class="toctree-checkbox" id="toctree-checkbox-63" name="toctree-checkbox-63" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-63"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-observability/getting-started.html">Ray Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-observability/ray-distributed-debugger.html">Ray Distributed Debugger</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../../../ray-observability/key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-observability/user-guides/index.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-64" name="toctree-checkbox-64" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-64"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/index.html">Debugging Applications</a><input class="toctree-checkbox" id="toctree-checkbox-65" name="toctree-checkbox-65" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-65"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/general-debugging.html">General Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/debug-memory.html">Debugging Memory Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/debug-hangs.html">Debugging Hangs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/debug-failures.html">Debugging Failures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/optimize-performance.html">Optimizing Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../ray-observability/user-guides/debug-apps/ray-debugging.html">Using the Ray Debugger</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/user-guides/cli-sdk.html">Monitoring with the CLI or SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/user-guides/configure-logging.html">Configuring Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/user-guides/profiling.html">Profiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/user-guides/add-app-metrics.html">Adding Application-Level Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/user-guides/ray-tracing.html">Tracing</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-observability/reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-66" name="toctree-checkbox-66" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-66"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/reference/api.html">State API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/reference/cli.html">State CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-observability/reference/system-metrics.html">System Metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../ray-contribute/index.html">Developer Guides</a><input class="toctree-checkbox" id="toctree-checkbox-67" name="toctree-checkbox-67" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-67"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-contribute/stability.html">API Stability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-contribute/api-policy.html">API Policy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../ray-contribute/getting-involved.html">Getting Involved / Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-68" name="toctree-checkbox-68" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-68"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/development.html">Building Ray from Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/ci.html">CI Testing Workflow on PRs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/docs.html">Contributing to the Ray Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/writing-code-snippets.html">How to write code snippets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/fake-autoscaler.html">Testing Autoscaling Locally</a></li>

<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/testing-tips.html">Tips for testing Ray programs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/debugging.html">Debugging for Ray Developers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ray-contribute/profiling.html">Profiling for Ray Developers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-core/configure.html">Configuring Ray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ray-contribute/whitepaper.html">Architecture Whitepapers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-references/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ray-security/index.html">Security</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">ray.rllib.al...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for ray.rllib.algorithms.algorithm_config</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Collection</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">gymnasium</span> <span class="k">as</span> <span class="nn">gym</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray.rllib.algorithms.callbacks</span> <span class="kn">import</span> <span class="n">DefaultCallbacks</span>
<span class="kn">from</span> <span class="nn">ray.rllib.core</span> <span class="kn">import</span> <span class="n">DEFAULT_MODULE_ID</span>
<span class="kn">from</span> <span class="nn">ray.rllib.core.columns</span> <span class="kn">import</span> <span class="n">Columns</span>
<span class="kn">from</span> <span class="nn">ray.rllib.core.rl_module</span> <span class="kn">import</span> <span class="n">validate_module_id</span>
<span class="kn">from</span> <span class="nn">ray.rllib.core.rl_module.multi_rl_module</span> <span class="kn">import</span> <span class="n">MultiRLModuleSpec</span>
<span class="kn">from</span> <span class="nn">ray.rllib.core.rl_module.rl_module</span> <span class="kn">import</span> <span class="n">RLModuleSpec</span>
<span class="kn">from</span> <span class="nn">ray.rllib.env</span> <span class="kn">import</span> <span class="n">INPUT_ENV_SPACES</span>
<span class="kn">from</span> <span class="nn">ray.rllib.env.env_context</span> <span class="kn">import</span> <span class="n">EnvContext</span>
<span class="kn">from</span> <span class="nn">ray.rllib.env.multi_agent_env</span> <span class="kn">import</span> <span class="n">MultiAgentEnv</span>
<span class="kn">from</span> <span class="nn">ray.rllib.env.wrappers.atari_wrappers</span> <span class="kn">import</span> <span class="n">is_atari</span>
<span class="kn">from</span> <span class="nn">ray.rllib.evaluation.collectors.sample_collector</span> <span class="kn">import</span> <span class="n">SampleCollector</span>
<span class="kn">from</span> <span class="nn">ray.rllib.evaluation.collectors.simple_list_collector</span> <span class="kn">import</span> <span class="n">SimpleListCollector</span>
<span class="kn">from</span> <span class="nn">ray.rllib.models</span> <span class="kn">import</span> <span class="n">MODEL_DEFAULTS</span>
<span class="kn">from</span> <span class="nn">ray.rllib.offline.input_reader</span> <span class="kn">import</span> <span class="n">InputReader</span>
<span class="kn">from</span> <span class="nn">ray.rllib.offline.io_context</span> <span class="kn">import</span> <span class="n">IOContext</span>
<span class="kn">from</span> <span class="nn">ray.rllib.policy.policy</span> <span class="kn">import</span> <span class="n">Policy</span><span class="p">,</span> <span class="n">PolicySpec</span>
<span class="kn">from</span> <span class="nn">ray.rllib.policy.sample_batch</span> <span class="kn">import</span> <span class="n">DEFAULT_POLICY_ID</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils</span> <span class="kn">import</span> <span class="n">deep_update</span><span class="p">,</span> <span class="n">merge_dicts</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.annotations</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">OldAPIStack</span><span class="p">,</span>
    <span class="n">OverrideToImplementCustomLogic_CallToSuperRecommended</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.deprecation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="n">Deprecated</span><span class="p">,</span>
    <span class="n">deprecation_warning</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.framework</span> <span class="kn">import</span> <span class="n">try_import_tf</span><span class="p">,</span> <span class="n">try_import_torch</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.from_config</span> <span class="kn">import</span> <span class="n">NotProvided</span><span class="p">,</span> <span class="n">from_config</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.schedules.scheduler</span> <span class="kn">import</span> <span class="n">Scheduler</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.serialization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NOT_SERIALIZABLE</span><span class="p">,</span>
    <span class="n">deserialize_type</span><span class="p">,</span>
    <span class="n">serialize_type</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.torch_utils</span> <span class="kn">import</span> <span class="n">TORCH_COMPILE_REQUIRED_VERSION</span>
<span class="kn">from</span> <span class="nn">ray.rllib.utils.typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AgentID</span><span class="p">,</span>
    <span class="n">AlgorithmConfigDict</span><span class="p">,</span>
    <span class="n">EnvConfigDict</span><span class="p">,</span>
    <span class="n">EnvType</span><span class="p">,</span>
    <span class="n">LearningRateOrSchedule</span><span class="p">,</span>
    <span class="n">ModuleID</span><span class="p">,</span>
    <span class="n">MultiAgentPolicyConfigDict</span><span class="p">,</span>
    <span class="n">PartialAlgorithmConfigDict</span><span class="p">,</span>
    <span class="n">PolicyID</span><span class="p">,</span>
    <span class="n">ResultDict</span><span class="p">,</span>
    <span class="n">RLModuleSpecType</span><span class="p">,</span>
    <span class="n">SampleBatchType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.tune.logger</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">ray.tune.registry</span> <span class="kn">import</span> <span class="n">get_trainable_cls</span>
<span class="kn">from</span> <span class="nn">ray.tune.result</span> <span class="kn">import</span> <span class="n">TRIAL_INFO</span>
<span class="kn">from</span> <span class="nn">ray.tune.tune</span> <span class="kn">import</span> <span class="n">_Config</span>

<span class="n">Space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span>

<span class="sd">&quot;&quot;&quot;TODO(jungong, sven): in &quot;offline_data&quot; we can potentially unify all input types</span>
<span class="sd">under input and input_config keys. E.g.</span>
<span class="sd">input: sample</span>
<span class="sd">input_config {</span>
<span class="sd">env: CartPole-v1</span>
<span class="sd">}</span>
<span class="sd">or:</span>
<span class="sd">input: json_reader</span>
<span class="sd">input_config {</span>
<span class="sd">path: /tmp/</span>
<span class="sd">}</span>
<span class="sd">or:</span>
<span class="sd">input: dataset</span>
<span class="sd">input_config {</span>
<span class="sd">format: parquet</span>
<span class="sd">path: /tmp/</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ray.rllib.algorithms.algorithm</span> <span class="kn">import</span> <span class="n">Algorithm</span>
    <span class="kn">from</span> <span class="nn">ray.rllib.connectors.connector_v2</span> <span class="kn">import</span> <span class="n">ConnectorV2</span>
    <span class="kn">from</span> <span class="nn">ray.rllib.core.learner</span> <span class="kn">import</span> <span class="n">Learner</span>
    <span class="kn">from</span> <span class="nn">ray.rllib.core.learner.learner_group</span> <span class="kn">import</span> <span class="n">LearnerGroup</span>
    <span class="kn">from</span> <span class="nn">ray.rllib.core.rl_module.rl_module</span> <span class="kn">import</span> <span class="n">RLModule</span>
    <span class="kn">from</span> <span class="nn">ray.rllib.evaluation.episode</span> <span class="kn">import</span> <span class="n">Episode</span> <span class="k">as</span> <span class="n">OldEpisode</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_rl_module_spec</span><span class="p">(</span><span class="n">module_spec</span><span class="p">:</span> <span class="n">RLModuleSpecType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module_spec</span><span class="p">,</span> <span class="p">(</span><span class="n">RLModuleSpec</span><span class="p">,</span> <span class="n">MultiRLModuleSpec</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;rl_module_spec must be an instance of &quot;</span>
            <span class="s2">&quot;RLModuleSpec or MultiRLModuleSpec.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">module_spec</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
        <span class="p">)</span>


<div class="viewcode-block" id="AlgorithmConfig">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig">[docs]</a>
<span class="k">class</span> <span class="nc">AlgorithmConfig</span><span class="p">(</span><span class="n">_Config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A RLlib AlgorithmConfig builds an RLlib Algorithm from a given configuration.</span>

<span class="sd">    .. testcode::</span>

<span class="sd">        from ray.rllib.algorithms.ppo import PPOConfig</span>
<span class="sd">        from ray.rllib.algorithms.callbacks import MemoryTrackingCallbacks</span>
<span class="sd">        # Construct a generic config object, specifying values within different</span>
<span class="sd">        # sub-categories, e.g. &quot;training&quot;.</span>
<span class="sd">        config = (PPOConfig().training(gamma=0.9, lr=0.01)</span>
<span class="sd">                .environment(env=&quot;CartPole-v1&quot;)</span>
<span class="sd">                .resources(num_gpus=0)</span>
<span class="sd">                .env_runners(num_env_runners=0)</span>
<span class="sd">                .callbacks(MemoryTrackingCallbacks)</span>
<span class="sd">            )</span>
<span class="sd">        # A config object can be used to construct the respective Algorithm.</span>
<span class="sd">        rllib_algo = config.build()</span>

<span class="sd">    .. testcode::</span>

<span class="sd">        from ray.rllib.algorithms.ppo import PPOConfig</span>
<span class="sd">        from ray import tune</span>
<span class="sd">        # In combination with a tune.grid_search:</span>
<span class="sd">        config = PPOConfig()</span>
<span class="sd">        config.training(lr=tune.grid_search([0.01, 0.001]))</span>
<span class="sd">        # Use `to_dict()` method to get the legacy plain python config dict</span>
<span class="sd">        # for usage with `tune.Tuner().fit()`.</span>
<span class="sd">        tune.Tuner(&quot;PPO&quot;, param_space=config.to_dict())</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">DEFAULT_AGENT_TO_MODULE_MAPPING_FN</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">episode</span><span class="p">):</span>
        <span class="c1"># The default agent ID to module ID mapping function to use in the multi-agent</span>
        <span class="c1"># case if None is provided.</span>
        <span class="c1"># Map any agent ID to &quot;default_policy&quot;.</span>
        <span class="k">return</span> <span class="n">DEFAULT_MODULE_ID</span>

    <span class="c1"># TODO (sven): Deprecate in new API stack.</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">DEFAULT_POLICY_MAPPING_FN</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># The default policy mapping function to use if None provided.</span>
        <span class="c1"># Map any agent ID to &quot;default_policy&quot;.</span>
        <span class="k">return</span> <span class="n">DEFAULT_POLICY_ID</span>

<div class="viewcode-block" id="AlgorithmConfig.from_dict">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.from_dict.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an AlgorithmConfig from a legacy python config dict.</span>

<span class="sd">        .. testcode::</span>

<span class="sd">            from ray.rllib.algorithms.ppo.ppo import PPOConfig</span>
<span class="sd">            # pass a RLlib config dict</span>
<span class="sd">            ppo_config = PPOConfig.from_dict({})</span>
<span class="sd">            ppo = ppo_config.build(env=&quot;Pendulum-v1&quot;)</span>

<span class="sd">        Args:</span>
<span class="sd">            config_dict: The legacy formatted python config dict for some algorithm.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new AlgorithmConfig object that matches the given python config dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a default config object of this class.</span>
        <span class="n">config_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="c1"># Remove `_is_frozen` flag from config dict in case the AlgorithmConfig that</span>
        <span class="c1"># the dict was derived from was already frozen (we don&#39;t want to copy the</span>
        <span class="c1"># frozenness).</span>
        <span class="n">config_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_is_frozen&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">config_obj</span><span class="o">.</span><span class="n">update_from_dict</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_obj</span></div>


<div class="viewcode-block" id="AlgorithmConfig.overrides">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.overrides.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.overrides">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">overrides</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates and validates a set of config key/value pairs (passed via kwargs).</span>

<span class="sd">        Validation whether given config keys are valid is done immediately upon</span>
<span class="sd">        construction (by comparing against the properties of a default AlgorithmConfig</span>
<span class="sd">        object of this class).</span>
<span class="sd">        Allows combination with a full AlgorithmConfig object to yield a new</span>
<span class="sd">        AlgorithmConfig object.</span>

<span class="sd">        Used anywhere, we would like to enable the user to only define a few config</span>
<span class="sd">        settings that would change with respect to some main config, e.g. in multi-agent</span>
<span class="sd">        setups and evaluation configs.</span>

<span class="sd">        .. testcode::</span>

<span class="sd">            from ray.rllib.algorithms.ppo import PPOConfig</span>
<span class="sd">            from ray.rllib.policy.policy import PolicySpec</span>
<span class="sd">            config = (</span>
<span class="sd">                PPOConfig()</span>
<span class="sd">                .multi_agent(</span>
<span class="sd">                    policies={</span>
<span class="sd">                        &quot;pol0&quot;: PolicySpec(config=PPOConfig.overrides(lambda_=0.95))</span>
<span class="sd">                    },</span>
<span class="sd">                )</span>
<span class="sd">            )</span>


<span class="sd">        .. testcode::</span>

<span class="sd">            from ray.rllib.algorithms.algorithm_config import AlgorithmConfig</span>
<span class="sd">            from ray.rllib.algorithms.ppo import PPOConfig</span>
<span class="sd">            config = (</span>
<span class="sd">                PPOConfig()</span>
<span class="sd">                .evaluation(</span>
<span class="sd">                    evaluation_num_env_runners=1,</span>
<span class="sd">                    evaluation_interval=1,</span>
<span class="sd">                    evaluation_config=AlgorithmConfig.overrides(explore=False),</span>
<span class="sd">                )</span>
<span class="sd">            )</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dict mapping valid config property-names to values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: In case a non-existing property name (kwargs key) is being</span>
<span class="sd">                passed in. Valid property names are taken from a default</span>
<span class="sd">                AlgorithmConfig object of `cls`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">config_overrides</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">default_config</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid property name </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> for config class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">!&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Allow things like &quot;lambda&quot; as well.</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_translate_special_keys</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">warn_deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">config_overrides</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">config_overrides</span></div>


<div class="viewcode-block" id="AlgorithmConfig.__init__">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.__init__.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algo_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes an AlgorithmConfig instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            algo_class: An optional Algorithm class that this config class belongs to.</span>
<span class="sd">                Used (if provided) to build a respective Algorithm instance from this</span>
<span class="sd">                config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define all settings and their default values.</span>

        <span class="c1"># Define the default RLlib Algorithm class that this AlgorithmConfig will be</span>
        <span class="c1"># applied to.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algo_class</span> <span class="o">=</span> <span class="n">algo_class</span>

        <span class="c1"># `self.python_environment()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_python_environs_for_driver</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_python_environs_for_worker</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># `self.resources()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placement_strategy</span> <span class="o">=</span> <span class="s2">&quot;PACK&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># @OldAPIStack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fake_gpus</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># @OldAPIStack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_for_main_process</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># `self.framework()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eager_tracing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eager_max_retraces</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_session_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># note: overridden by `local_tf_session_args`</span>
            <span class="s2">&quot;intra_op_parallelism_threads&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;inter_op_parallelism_threads&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;gpu_options&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;allow_growth&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;log_device_placement&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;device_count&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="c1"># Required by multi-GPU (num_gpus &gt; 1).</span>
            <span class="s2">&quot;allow_soft_placement&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_tf_session_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Allow a higher level of parallelism by default, but not unlimited</span>
            <span class="c1"># since that can cause crashes with many concurrent drivers.</span>
            <span class="s2">&quot;intra_op_parallelism_threads&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s2">&quot;inter_op_parallelism_threads&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Torch compile settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_what_to_compile</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">TorchCompileWhatToCompile</span><span class="o">.</span><span class="n">FORWARD_TRAIN</span>
        <span class="p">)</span>
        <span class="c1"># AOT Eager is a dummy backend and will not result in speedups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_dynamo_backend</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;aot_eager&quot;</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span> <span class="k">else</span> <span class="s2">&quot;inductor&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_dynamo_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># AOT Eager is a dummy backend and will not result in speedups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker_dynamo_backend</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;aot_eager&quot;</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span> <span class="k">else</span> <span class="s2">&quot;onnxrt&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker_dynamo_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Default kwargs for `torch.nn.parallel.DistributedDataParallel`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_ddp_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Default setting for skipping `nan` gradient updates.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torch_skip_nan_gradients</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># `self.api_stack()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_env_runner_and_connector_v2</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># `self.environment()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clip_rewards</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_actions</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clip_actions</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_atari</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_env_checking</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Deprecated settings:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_task_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render_env</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_mask_key</span> <span class="o">=</span> <span class="s2">&quot;action_mask&quot;</span>

        <span class="c1"># `self.env_runners()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_cls</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_env_runner</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_env_runner</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_resources_per_env_runner</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_env_runners_after_construction</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_requests_in_flight_per_env_runner</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_timeout_s</span> <span class="o">=</span> <span class="mf">60.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_env_on_local_worker</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env_to_module_connector</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_env_to_module_pipeline</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_module_to_env_connector</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_module_to_env_pipeline</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">episode_lookback_horizon</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># TODO (sven): Rename into `sample_timesteps` (or `sample_duration`</span>
        <span class="c1">#  and `sample_duration_unit` (replacing batch_mode), like we do it</span>
        <span class="c1">#  in the evaluation config).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="c1"># TODO (sven): Rename into `sample_mode`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_mode</span> <span class="o">=</span> <span class="s2">&quot;truncate_episodes&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compress_observations</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># @OldAPIStack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_worker_envs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_env_batch_wait_ms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_tf1_exec_eagerly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_collector</span> <span class="o">=</span> <span class="n">SimpleListCollector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor_pref</span> <span class="o">=</span> <span class="s2">&quot;deepmind&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observation_filter</span> <span class="o">=</span> <span class="s2">&quot;NoFilter&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_worker_filter_stats</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_worker_filter_stats</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_connectors</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler_perf_stats_ema_coef</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># `self.learners()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_learner</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_learner</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_gpu_idx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># `self.training()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.99</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad_clip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad_clip_by</span> <span class="o">=</span> <span class="s2">&quot;global_norm&quot;</span>
        <span class="c1"># Simple logic for now: If None, use `train_batch_size`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size_per_learner</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># @OldAPIStack</span>

        <span class="c1"># These setting have been adopted from the original PPO batch settings:</span>
        <span class="c1"># num_sgd_iter, minibatch_size, and shuffle_sequences.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minibatch_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_batch_per_epoch</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># TODO (sven): Unsolved problem with RLModules sometimes requiring settings from</span>
        <span class="c1">#  the main AlgorithmConfig. We should not require the user to provide those</span>
        <span class="c1">#  settings in both, the AlgorithmConfig (as property) AND the model config</span>
        <span class="c1">#  dict. We should generally move to a world, in which there exists an</span>
        <span class="c1">#  AlgorithmConfig that a) has-a user provided model config object and b)</span>
        <span class="c1">#  is given a chance to compile a final model config (dict or object) that is</span>
        <span class="c1">#  then passed into the RLModule/Catalog. This design would then match our</span>
        <span class="c1">#  &quot;compilation&quot; pattern, where we compile automatically those settings that</span>
        <span class="c1">#  should NOT be touched by the user.</span>
        <span class="c1">#  In case, an Algorithm already uses the above described pattern (and has</span>
        <span class="c1">#  `self.model` as a @property, ignore AttributeError (for trying to set this</span>
        <span class="c1">#  property).</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">MODEL_DEFAULTS</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_learner_connector</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_learner_pipeline</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learner_config_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># @OldAPIStack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_learner_class</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># `self.callbacks()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks_class</span> <span class="o">=</span> <span class="n">DefaultCallbacks</span>

        <span class="c1"># `self.explore()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explore</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># This is not compatible with RLModules, which have a method</span>
        <span class="c1"># `forward_exploration` to specify custom exploration behavior.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># `self.multi_agent()`</span>
        <span class="c1"># TODO (sven): Prepare multi-agent setup for logging each agent&#39;s and each</span>
        <span class="c1">#  RLModule&#39;s steps taken thus far (and passing this information into the</span>
        <span class="c1">#  EnvRunner metrics and the RLModule&#39;s forward pass). Thereby, deprecate the</span>
        <span class="c1">#  `count_steps_by` config setting AND - at the same time - allow users to</span>
        <span class="c1">#  specify the batch size unit instead (agent- vs env steps).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_steps_by</span> <span class="o">=</span> <span class="s2">&quot;env_steps&quot;</span>
        <span class="c1"># self.agent_to_module_mapping_fn = self.DEFAULT_AGENT_TO_MODULE_MAPPING_FN</span>
        <span class="c1"># Soon to be Deprecated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policies</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT_POLICY_ID</span><span class="p">:</span> <span class="n">PolicySpec</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_map_capacity</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_mapping_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_POLICY_MAPPING_FN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_states_are_swappable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observation_fn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># `self.offline_data()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_</span> <span class="o">=</span> <span class="s2">&quot;sampler&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_read_method</span> <span class="o">=</span> <span class="s2">&quot;read_parquet&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_read_method_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_read_schema</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_read_episodes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_read_sample_batches</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_filesystem</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_filesystem_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_compress_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">Columns</span><span class="o">.</span><span class="n">OBS</span><span class="p">,</span> <span class="n">Columns</span><span class="o">.</span><span class="n">NEXT_OBS</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_spaces_jsonable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialize_data</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialize_mapped_data</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_batches_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_batches_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_class</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_buffer_class</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_buffer_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_module_synch_period</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_num_iters_per_learner</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions_in_input_normalized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_inputs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_buffer_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_compress_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">Columns</span><span class="o">.</span><span class="n">OBS</span><span class="p">,</span> <span class="n">Columns</span><span class="o">.</span><span class="n">NEXT_OBS</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_max_file_size</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_max_rows_per_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_write_method</span> <span class="o">=</span> <span class="s2">&quot;write_parquet&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_write_method_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_filesystem</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_filesystem_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_write_episodes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offline_sampling</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># `self.evaluation()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_interval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration_unit</span> <span class="o">=</span> <span class="s2">&quot;episodes&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_sample_timeout_s</span> <span class="o">=</span> <span class="mf">120.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_parallel_to_training</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_force_reset_envs_before_iteration</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">off_policy_estimation_methods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ope_split_batch_by_episode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_evaluation_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># TODO: Set this flag still in the config or - much better - in the</span>
        <span class="c1">#  RolloutWorker as a property.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_evaluation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># TODO (sven): Deprecate this setting (it&#39;s not user-accessible right now any</span>
        <span class="c1">#  way). Replace by logic within `training_step` to merge and broadcast the</span>
        <span class="c1">#  EnvRunner (connector) states.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_filters_on_rollout_workers_timeout_s</span> <span class="o">=</span> <span class="mf">10.0</span>

        <span class="c1"># `self.reporting()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_per_episode_custom_metrics</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_episode_collection_timeout_s</span> <span class="o">=</span> <span class="mf">60.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_num_episodes_for_smoothing</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time_s_per_iteration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_train_timesteps_per_iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_sample_timesteps_per_iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_gradients</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># `self.checkpointing()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_native_model_files</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_trainable_policies_only</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># `self.debugging()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_creator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&quot;WARN&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_sys_usage</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_sampler</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># TODO (sven): Remove these settings again in the future. We only need them</span>
        <span class="c1">#  to debug a quite complex, production memory leak, possibly related to</span>
        <span class="c1">#  evaluation in parallel (when `training_step` is getting called inside a</span>
        <span class="c1">#  thread). It&#39;s also possible that the leak is not caused by RLlib itself,</span>
        <span class="c1">#  but by Ray core, but we need more data to narrow this down.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_training_always_in_thread</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluation_parallel_to_training_wo_thread</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># `self.fault_tolerance()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_env_runner_failures</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recreate_failed_env_runners</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># By default, restart failed worker a thousand times.</span>
        <span class="c1"># This should be enough to handle normal transient failures.</span>
        <span class="c1"># This also prevents infinite number of restarts in case</span>
        <span class="c1"># the worker or env has a bug.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_env_runner_restarts</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="c1"># Small delay between worker restarts. In case rollout or</span>
        <span class="c1"># evaluation workers have remote dependencies, this delay can be</span>
        <span class="c1"># adjusted to make sure we don&#39;t flood them with re-connection</span>
        <span class="c1"># requests, and allow them enough time to recover.</span>
        <span class="c1"># This delay also gives Ray time to stream back error logging</span>
        <span class="c1"># and exceptions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_between_env_runner_restarts_s</span> <span class="o">=</span> <span class="mf">60.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_failed_sub_environments</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_consecutive_env_runner_failures_tolerance</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_health_probe_timeout_s</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_restore_timeout_s</span> <span class="o">=</span> <span class="mi">1800</span>

        <span class="c1"># `self.rl_module()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_config_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Helper to keep track of the original exploration config when dis-/enabling</span>
        <span class="c1"># rl modules.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__prior_exploration_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Module ID specific config overrides.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_config_overrides_per_module</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Cached, actual AlgorithmConfig objects derived from</span>
        <span class="c1"># `self.algorithm_config_overrides_per_module`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_per_module_overrides</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ModuleID</span><span class="p">,</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># `self.experimental()`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_torch_grad_scaler_class</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_torch_lr_scheduler_classes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tf_policy_handles_more_than_one_loss</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_preprocessor_api</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_action_flattening</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_initialize_loss_from_dummy_batch</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dont_auto_sync_env_runner_states</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Has this config object been frozen (cannot alter its attributes anymore).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_frozen</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># TODO: Remove, once all deprecation_warning calls upon using these keys</span>
        <span class="c1">#  have been removed.</span>
        <span class="c1"># === Deprecated keys ===</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_episodes</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_smoothing_episodes</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps_per_iteration</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_iter_time_s</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics_timeout</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time_s_per_reporting</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_train_timesteps_per_reporting</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_sample_timesteps_per_reporting</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_evaluation</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_map_cache</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker_cls</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">synchronize_filters</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_async_evaluation</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_async_evaluation_function</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_rl_module_api</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_wrap_old_gym_envs</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">always_attach_evaluation_results</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>

        <span class="c1"># The following values have moved because of the new ReplayBuffer API</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prioritized_replay</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_starts</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replay_batch_size</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="c1"># -1 = DEPRECATED_VALUE is a valid value for replay_sequence_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replay_sequence_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replay_mode</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prioritized_replay_alpha</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prioritized_replay_beta</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prioritized_replay_eps</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time_s_per_reporting</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_train_timesteps_per_reporting</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_sample_timesteps_per_reporting</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_execution_plan_api</span> <span class="o">=</span> <span class="n">DEPRECATED_VALUE</span></div>


<div class="viewcode-block" id="AlgorithmConfig.to_dict">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.to_dict.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.to_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AlgorithmConfigDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts all settings into a legacy config dict for backward compatibility.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A complete AlgorithmConfigDict, usable in backward-compatible Tune/RLlib</span>
<span class="sd">            use cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algo_class&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_is_frozen&quot;</span><span class="p">)</span>

        <span class="c1"># Worst naming convention ever: NEVER EVER use reserved key-words...</span>
        <span class="k">if</span> <span class="s2">&quot;lambda_&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lambda_&quot;</span><span class="p">)</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;lambda&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lambda_&quot;</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lambda_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;input_&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;input_&quot;</span><span class="p">)</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;input_&quot;</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;input_&quot;</span><span class="p">)</span>

        <span class="c1"># Convert `policies` (PolicySpecs?) into dict.</span>
        <span class="c1"># Convert policies dict such that each policy ID maps to a old-style.</span>
        <span class="c1"># 4-tuple: class, obs-, and action space, config.</span>
        <span class="k">if</span> <span class="s2">&quot;policies&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">policies_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">policy_id</span><span class="p">,</span> <span class="n">policy_spec</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;policies&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policy_spec</span><span class="p">,</span> <span class="n">PolicySpec</span><span class="p">):</span>
                    <span class="n">policies_dict</span><span class="p">[</span><span class="n">policy_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">policies_dict</span><span class="p">[</span><span class="n">policy_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">policy_spec</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">policies_dict</span>

        <span class="c1"># Switch out deprecated vs new config keys.</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;callbacks_class&quot;</span><span class="p">,</span> <span class="n">DefaultCallbacks</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;create_env_on_driver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;create_env_on_local_worker&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;custom_eval_function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;custom_evaluation_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;framework&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;framework_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Simplify: Remove all deprecated keys that have as value `DEPRECATED_VALUE`.</span>
        <span class="c1"># These would be useless in the returned dict anyways.</span>
        <span class="k">for</span> <span class="n">dep_k</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;monitor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;evaluation_num_episodes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metrics_smoothing_episodes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timesteps_per_iteration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_iter_time_s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;collect_metrics_timeout&quot;</span><span class="p">,</span>
            <span class="s2">&quot;buffer_size&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prioritized_replay&quot;</span><span class="p">,</span>
            <span class="s2">&quot;learning_starts&quot;</span><span class="p">,</span>
            <span class="s2">&quot;replay_batch_size&quot;</span><span class="p">,</span>
            <span class="s2">&quot;replay_mode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prioritized_replay_alpha&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prioritized_replay_beta&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prioritized_replay_eps&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_time_s_per_reporting&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_train_timesteps_per_reporting&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_sample_timesteps_per_reporting&quot;</span><span class="p">,</span>
            <span class="s2">&quot;input_evaluation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_enable_new_api_stack&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep_k</span><span class="p">)</span> <span class="o">==</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
                <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">dep_k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">config</span></div>


<div class="viewcode-block" id="AlgorithmConfig.update_from_dict">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.update_from_dict.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.update_from_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">update_from_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_dict</span><span class="p">:</span> <span class="n">PartialAlgorithmConfigDict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modifies this AlgorithmConfig via the provided python config dict.</span>

<span class="sd">        Warns if `config_dict` contains deprecated keys.</span>
<span class="sd">        Silently sets even properties of `self` that do NOT exist. This way, this method</span>
<span class="sd">        may be used to configure custom Policies which do not have their own specific</span>
<span class="sd">        AlgorithmConfig classes, e.g.</span>
<span class="sd">        `ray.rllib.examples.policy.random_policy::RandomPolicy`.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_dict: The old-style python config dict (PartialAlgorithmConfigDict)</span>
<span class="sd">                to use for overriding some properties defined in there.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eval_call</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># We deal with this special key before all others because it may influence</span>
        <span class="c1"># stuff like &quot;exploration_config&quot;.</span>
        <span class="c1"># Namely, we want to re-instantiate the exploration config this config had</span>
        <span class="c1"># inside `self.experimental()` before potentially overwriting it in the</span>
        <span class="c1"># following.</span>
        <span class="n">enable_rl_module_and_learner</span> <span class="o">=</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;_enable_new_api_stack&quot;</span><span class="p">,</span>
            <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enable_rl_module_and_learner&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_rl_module_and_learner</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_stack</span><span class="p">(</span><span class="n">enable_rl_module_and_learner</span><span class="o">=</span><span class="n">enable_rl_module_and_learner</span><span class="p">)</span>

        <span class="c1"># Modify our properties one by one.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_special_keys</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">warn_deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Ray Tune saves additional data under this magic keyword.</span>
            <span class="c1"># This should not get treated as AlgorithmConfig field.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">TRIAL_INFO</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_enable_new_api_stack&quot;</span><span class="p">]:</span>
                <span class="c1"># We&#39;ve dealt with this above.</span>
                <span class="k">continue</span>
            <span class="c1"># Set our multi-agent settings.</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;multiagent&quot;</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;policies&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;policy_map_capacity&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;policy_mapping_fn&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;policies_to_train&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;policy_states_are_swappable&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;observation_fn&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;count_steps_by&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">value</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multi_agent</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Some keys specify config sub-dicts and therefore should go through the</span>
            <span class="c1"># correct methods to properly `.update()` those from given config dict</span>
            <span class="c1"># (to not lose any sub-keys).</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;callbacks_class&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">NOT_SERIALIZABLE</span><span class="p">:</span>
                <span class="c1"># For backward compatibility reasons, only resolve possible</span>
                <span class="c1"># classpath if value is a str type.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">deserialize_type</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">(</span><span class="n">callbacks_class</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;env_config&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">(</span><span class="n">env_config</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;evaluation_&quot;</span><span class="p">):</span>
                <span class="n">eval_call</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;exploration_config&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">enable_rl_module_and_learner</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">value</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deserialize_type</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env_runners</span><span class="p">(</span><span class="n">exploration_config</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span>
                <span class="c1"># Resolve possible classpath.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_model&quot;</span><span class="p">):</span>
                    <span class="n">value</span><span class="p">[</span><span class="s2">&quot;custom_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deserialize_type</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;custom_model&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;replay_buffer_config&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">value</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deserialize_type</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;sample_collector&quot;</span><span class="p">:</span>
                <span class="c1"># Resolve possible classpath.</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">deserialize_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env_runners</span><span class="p">(</span><span class="n">sample_collector</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># Set the property named `key` to `value`.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="p">(</span><span class="o">**</span><span class="n">eval_call</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_state">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_state.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_state">[docs]</a>
    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dict state that can be pickled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing all attributes of the instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algo_class&quot;</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_is_frozen&quot;</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">}</span>

        <span class="c1"># Convert `policies` (PolicySpecs?) into dict.</span>
        <span class="c1"># Convert policies dict such that each policy ID maps to a old-style.</span>
        <span class="c1"># 4-tuple: class, obs-, and action space, config.</span>
        <span class="c1"># TODO (simon, sven): Remove when deprecating old stack.</span>
        <span class="k">if</span> <span class="s2">&quot;policies&quot;</span> <span class="ow">in</span> <span class="n">state</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">policies_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">policy_id</span><span class="p">,</span> <span class="n">policy_spec</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;policies&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policy_spec</span><span class="p">,</span> <span class="n">PolicySpec</span><span class="p">):</span>
                    <span class="n">policies_dict</span><span class="p">[</span><span class="n">policy_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">policies_dict</span><span class="p">[</span><span class="n">policy_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">policy_spec</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">policies_dict</span>

        <span class="c1"># state = self._serialize_dict(state)</span>

        <span class="k">return</span> <span class="n">state</span></div>


<div class="viewcode-block" id="AlgorithmConfig.from_state">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.from_state.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.from_state">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an instance constructed from the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            cls: An `AlgorithmConfig` class.</span>
<span class="sd">            state: A dictionary containing the state of an `AlgorithmConfig`.</span>
<span class="sd">                See `AlgorithmConfig.get_state` for creating a state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An `AlgorithmConfig` instance with attributes from the `state`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ctor</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ctor</span><span class="p">()</span>

        <span class="n">config</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">config</span></div>


    <span class="c1"># TODO(sven): We might want to have a `deserialize` method as well. Right now,</span>
    <span class="c1">#  simply using the from_dict() API works in this same (deserializing) manner,</span>
    <span class="c1">#  whether the dict used is actually code-free (already serialized) or not</span>
    <span class="c1">#  (i.e. a classic RLlib config dict with e.g. &quot;callbacks&quot; key still pointing to</span>
    <span class="c1">#  a class).</span>
<div class="viewcode-block" id="AlgorithmConfig.serialize">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.serialize.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.serialize">[docs]</a>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a mapping from str to JSON&#39;able values representing this config.</span>

<span class="sd">        The resulting values will not have any code in them.</span>
<span class="sd">        Classes (such as `callbacks_class`) will be converted to their full</span>
<span class="sd">        classpath, e.g. `ray.rllib.algorithms.callbacks.DefaultCallbacks`.</span>
<span class="sd">        Actual code such as lambda functions will be written as their source</span>
<span class="sd">        code (str) plus any closure information for properly restoring the</span>
<span class="sd">        code inside the AlgorithmConfig object made from the returned dict data.</span>
<span class="sd">        Dataclass objects get converted to dicts.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dict mapping from str to JSON&#39;able values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_dict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>


<div class="viewcode-block" id="AlgorithmConfig.copy">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.copy.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_frozen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a deep copy of this config and (un)freezes if necessary.</span>

<span class="sd">        Args:</span>
<span class="sd">            copy_frozen: Whether the created deep copy will be frozen or not. If None,</span>
<span class="sd">                keep the same frozen status that `self` currently has.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A deep copy of `self` that is (un)frozen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy_frozen</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">cp</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">copy_frozen</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">cp</span><span class="o">.</span><span class="n">_is_frozen</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">evaluation_config</span><span class="p">,</span> <span class="n">AlgorithmConfig</span><span class="p">):</span>
                <span class="n">cp</span><span class="o">.</span><span class="n">evaluation_config</span><span class="o">.</span><span class="n">_is_frozen</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">cp</span></div>


<div class="viewcode-block" id="AlgorithmConfig.freeze">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.freeze.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.freeze">[docs]</a>
    <span class="k">def</span> <span class="nf">freeze</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Freezes this config object, such that no attributes can be set anymore.</span>

<span class="sd">        Algorithms should use this method to make sure that their config objects</span>
<span class="sd">        remain read-only after this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_frozen</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_frozen</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Also freeze underlying eval config, if applicable.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span><span class="p">,</span> <span class="n">AlgorithmConfig</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span></div>


        <span class="c1"># TODO: Flip out all set/dict/list values into frozen versions</span>
        <span class="c1">#  of themselves? This way, users won&#39;t even be able to alter those values</span>
        <span class="c1">#  directly anymore.</span>

<div class="viewcode-block" id="AlgorithmConfig.validate">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate">[docs]</a>
    <span class="nd">@OverrideToImplementCustomLogic_CallToSuperRecommended</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates all values in this config.&quot;&quot;&quot;</span>

        <span class="c1"># Check framework specific settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_framework_settings</span><span class="p">()</span>
        <span class="c1"># Check resources specific settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_resources_settings</span><span class="p">()</span>
        <span class="c1"># Check multi-agent specific settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_multi_agent_settings</span><span class="p">()</span>
        <span class="c1"># Check input specific settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_input_settings</span><span class="p">()</span>
        <span class="c1"># Check evaluation specific settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_evaluation_settings</span><span class="p">()</span>
        <span class="c1"># Check offline specific settings (new API stack).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_offline_settings</span><span class="p">()</span>

        <span class="c1"># Check new API stack specific settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_new_api_stack_settings</span><span class="p">()</span>

        <span class="c1"># Check to-be-deprecated settings (however that are still in use).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_to_be_deprecated_settings</span><span class="p">()</span></div>


<div class="viewcode-block" id="AlgorithmConfig.build">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build">[docs]</a>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EnvType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger_creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">Logger</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Algorithm&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds an Algorithm from this AlgorithmConfig (or a copy thereof).</span>

<span class="sd">        Args:</span>
<span class="sd">            env: Name of the environment to use (e.g. a gym-registered str),</span>
<span class="sd">                a full class path (e.g.</span>
<span class="sd">                &quot;ray.rllib.examples.envs.classes.random_env.RandomEnv&quot;), or an Env</span>
<span class="sd">                class directly. Note that this arg can also be specified via</span>
<span class="sd">                the &quot;env&quot; key in `config`.</span>
<span class="sd">            logger_creator: Callable that creates a ray.tune.Logger</span>
<span class="sd">                object. If unspecified, a default logger is created.</span>
<span class="sd">            use_copy: Whether to deepcopy `self` and pass the copy to the Algorithm</span>
<span class="sd">                (instead of `self`) as config. This is useful in case you would like to</span>
<span class="sd">                recycle the same AlgorithmConfig over and over, e.g. in a test case, in</span>
<span class="sd">                which we loop over different DL-frameworks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A ray.rllib.algorithms.algorithm.Algorithm object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span>
        <span class="k">if</span> <span class="n">logger_creator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger_creator</span> <span class="o">=</span> <span class="n">logger_creator</span>

        <span class="n">algo_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo_class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algo_class</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">algo_class</span> <span class="o">=</span> <span class="n">get_trainable_cls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algo_class</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">algo_class</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">use_copy</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">logger_creator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger_creator</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">build_env_to_module_connector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ray.rllib.connectors.env_to_module</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">AddObservationsFromEpisodesToBatch</span><span class="p">,</span>
            <span class="n">AddStatesFromEpisodesToBatch</span><span class="p">,</span>
            <span class="n">AgentToModuleMapping</span><span class="p">,</span>
            <span class="n">BatchIndividualItems</span><span class="p">,</span>
            <span class="n">EnvToModulePipeline</span><span class="p">,</span>
            <span class="n">NumpyToTensor</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">custom_connectors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Create an env-to-module connector pipeline (including RLlib&#39;s default</span>
        <span class="c1"># env-&gt;module connector piece) and return it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_to_module_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_to_module_connector</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">ray.rllib.connectors.connector_v2</span> <span class="kn">import</span> <span class="n">ConnectorV2</span>

            <span class="c1"># ConnectorV2 (piece or pipeline).</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_</span><span class="p">,</span> <span class="n">ConnectorV2</span><span class="p">):</span>
                <span class="n">custom_connectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">val_</span><span class="p">]</span>
            <span class="c1"># Sequence of individual ConnectorV2 pieces.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">custom_connectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">val_</span><span class="p">)</span>
            <span class="c1"># Unsupported return value.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`AlgorithmConfig.env_runners(env_to_module_connector=..)` must &quot;</span>
                    <span class="s2">&quot;return a ConnectorV2 object or a list thereof (to be added to a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;pipeline)! Your function returned </span><span class="si">{</span><span class="n">val_</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

        <span class="n">obs_space</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;single_observation_space&quot;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obs_space</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
            <span class="n">obs_space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">aid</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get_observation_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">act_space</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;single_action_space&quot;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">act_space</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
            <span class="n">act_space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">aid</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get_action_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">EnvToModulePipeline</span><span class="p">(</span>
            <span class="n">input_observation_space</span><span class="o">=</span><span class="n">obs_space</span><span class="p">,</span>
            <span class="n">input_action_space</span><span class="o">=</span><span class="n">act_space</span><span class="p">,</span>
            <span class="n">connectors</span><span class="o">=</span><span class="n">custom_connectors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_env_to_module_pipeline</span><span class="p">:</span>
            <span class="c1"># Append OBS handling.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AddObservationsFromEpisodesToBatch</span><span class="p">())</span>
            <span class="c1"># Append STATE_IN/STATE_OUT (and time-rank) handler.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AddStatesFromEpisodesToBatch</span><span class="p">())</span>
            <span class="c1"># If multi-agent -&gt; Map from AgentID-based data to ModuleID based data.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">AgentToModuleMapping</span><span class="p">(</span>
                        <span class="n">module_specs</span><span class="o">=</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rl_module_spec</span><span class="p">,</span> <span class="n">MultiRLModuleSpec</span><span class="p">)</span>
                            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">agent_to_module_mapping_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">policy_mapping_fn</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># Batch all data.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BatchIndividualItems</span><span class="p">(</span><span class="n">multi_agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">()))</span>
            <span class="c1"># Convert to Tensors.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NumpyToTensor</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">pipeline</span>

    <span class="k">def</span> <span class="nf">build_module_to_env_connector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ray.rllib.connectors.module_to_env</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">GetActions</span><span class="p">,</span>
            <span class="n">ListifyDataForVectorEnv</span><span class="p">,</span>
            <span class="n">ModuleToAgentUnmapping</span><span class="p">,</span>
            <span class="n">ModuleToEnvPipeline</span><span class="p">,</span>
            <span class="n">NormalizeAndClipActions</span><span class="p">,</span>
            <span class="n">RemoveSingleTsTimeRankFromBatch</span><span class="p">,</span>
            <span class="n">TensorToNumpy</span><span class="p">,</span>
            <span class="n">UnBatchToIndividualItems</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">custom_connectors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Create a module-to-env connector pipeline (including RLlib&#39;s default</span>
        <span class="c1"># module-&gt;env connector piece) and return it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module_to_env_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module_to_env_connector</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">ray.rllib.connectors.connector_v2</span> <span class="kn">import</span> <span class="n">ConnectorV2</span>

            <span class="c1"># ConnectorV2 (piece or pipeline).</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_</span><span class="p">,</span> <span class="n">ConnectorV2</span><span class="p">):</span>
                <span class="n">custom_connectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">val_</span><span class="p">]</span>
            <span class="c1"># Sequence of individual ConnectorV2 pieces.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">custom_connectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">val_</span><span class="p">)</span>
            <span class="c1"># Unsupported return value.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`AlgorithmConfig.env_runners(module_to_env_connector=..)` must &quot;</span>
                    <span class="s2">&quot;return a ConnectorV2 object or a list thereof (to be added to a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;pipeline)! Your function returned </span><span class="si">{</span><span class="n">val_</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

        <span class="n">obs_space</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;single_observation_space&quot;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obs_space</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
            <span class="n">obs_space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">aid</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get_observation_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">act_space</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;single_action_space&quot;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">act_space</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
            <span class="n">act_space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">aid</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get_action_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ModuleToEnvPipeline</span><span class="p">(</span>
            <span class="n">input_observation_space</span><span class="o">=</span><span class="n">obs_space</span><span class="p">,</span>
            <span class="n">input_action_space</span><span class="o">=</span><span class="n">act_space</span><span class="p">,</span>
            <span class="n">connectors</span><span class="o">=</span><span class="n">custom_connectors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_module_to_env_pipeline</span><span class="p">:</span>
            <span class="c1"># Prepend: Anything that has to do with plain data processing (not</span>
            <span class="c1"># particularly with the actions).</span>

            <span class="c1"># Remove extra time-rank, if applicable.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">RemoveSingleTsTimeRankFromBatch</span><span class="p">())</span>

            <span class="c1"># If multi-agent -&gt; Map from ModuleID-based data to AgentID based data.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">ModuleToAgentUnmapping</span><span class="p">())</span>

            <span class="c1"># Unbatch all data.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">UnBatchToIndividualItems</span><span class="p">())</span>

            <span class="c1"># Convert to numpy.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">TensorToNumpy</span><span class="p">())</span>

            <span class="c1"># Sample actions from ACTION_DIST_INPUTS (if ACTIONS not present).</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">GetActions</span><span class="p">())</span>

            <span class="c1"># Append: Anything that has to do with action sampling.</span>
            <span class="c1"># Unsquash/clip actions based on config and action space.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">NormalizeAndClipActions</span><span class="p">(</span>
                    <span class="n">normalize_actions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_actions</span><span class="p">,</span>
                    <span class="n">clip_actions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clip_actions</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Listify data from ConnectorV2-data format to normal lists that we can</span>
            <span class="c1"># index into by env vector index. These lists contain individual items</span>
            <span class="c1"># for single-agent and multi-agent dicts for multi-agent.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ListifyDataForVectorEnv</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">pipeline</span>

    <span class="k">def</span> <span class="nf">build_learner_connector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_observation_space</span><span class="p">,</span>
        <span class="n">input_action_space</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ray.rllib.connectors.learner</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">AddColumnsFromEpisodesToTrainBatch</span><span class="p">,</span>
            <span class="n">AddObservationsFromEpisodesToBatch</span><span class="p">,</span>
            <span class="n">AddStatesFromEpisodesToBatch</span><span class="p">,</span>
            <span class="n">AgentToModuleMapping</span><span class="p">,</span>
            <span class="n">BatchIndividualItems</span><span class="p">,</span>
            <span class="n">LearnerConnectorPipeline</span><span class="p">,</span>
            <span class="n">NumpyToTensor</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">custom_connectors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Create a learner connector pipeline (including RLlib&#39;s default</span>
        <span class="c1"># learner connector piece) and return it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_learner_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_learner_connector</span><span class="p">(</span>
                <span class="n">input_observation_space</span><span class="p">,</span>
                <span class="n">input_action_space</span><span class="p">,</span>
                <span class="c1"># device,  # TODO (sven): Also pass device into custom builder.</span>
            <span class="p">)</span>

            <span class="kn">from</span> <span class="nn">ray.rllib.connectors.connector_v2</span> <span class="kn">import</span> <span class="n">ConnectorV2</span>

            <span class="c1"># ConnectorV2 (piece or pipeline).</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_</span><span class="p">,</span> <span class="n">ConnectorV2</span><span class="p">):</span>
                <span class="n">custom_connectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">val_</span><span class="p">]</span>
            <span class="c1"># Sequence of individual ConnectorV2 pieces.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">custom_connectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">val_</span><span class="p">)</span>
            <span class="c1"># Unsupported return value.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`AlgorithmConfig.training(learner_connector=..)` must return &quot;</span>
                    <span class="s2">&quot;a ConnectorV2 object or a list thereof (to be added to a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;pipeline)! Your function returned </span><span class="si">{</span><span class="n">val_</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">LearnerConnectorPipeline</span><span class="p">(</span>
            <span class="n">connectors</span><span class="o">=</span><span class="n">custom_connectors</span><span class="p">,</span>
            <span class="n">input_observation_space</span><span class="o">=</span><span class="n">input_observation_space</span><span class="p">,</span>
            <span class="n">input_action_space</span><span class="o">=</span><span class="n">input_action_space</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_learner_pipeline</span><span class="p">:</span>
            <span class="c1"># Append OBS handling.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AddObservationsFromEpisodesToBatch</span><span class="p">(</span><span class="n">as_learner_connector</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Append all other columns handling.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AddColumnsFromEpisodesToTrainBatch</span><span class="p">())</span>
            <span class="c1"># Append STATE_IN/STATE_OUT (and time-rank) handler.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AddStatesFromEpisodesToBatch</span><span class="p">(</span><span class="n">as_learner_connector</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="c1"># If multi-agent -&gt; Map from AgentID-based data to ModuleID based data.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">AgentToModuleMapping</span><span class="p">(</span>
                        <span class="n">module_specs</span><span class="o">=</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rl_module_spec</span><span class="p">,</span> <span class="n">MultiRLModuleSpec</span><span class="p">)</span>
                            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">agent_to_module_mapping_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">policy_mapping_fn</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># Batch all data.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BatchIndividualItems</span><span class="p">(</span><span class="n">multi_agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">()))</span>
            <span class="c1"># Convert to Tensors.</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NumpyToTensor</span><span class="p">(</span><span class="n">as_learner_connector</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pipeline</span>

<div class="viewcode-block" id="AlgorithmConfig.build_learner_group">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner_group.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner_group">[docs]</a>
    <span class="k">def</span> <span class="nf">build_learner_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spaces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">ModuleID</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rl_module_spec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RLModuleSpecType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;LearnerGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds and returns a new LearnerGroup object based on settings in `self`.</span>

<span class="sd">        Args:</span>
<span class="sd">            env: An optional EnvType object (e.g. a gym.Env) useful for extracting space</span>
<span class="sd">                information for the to-be-constructed RLModule inside the LearnerGroup&#39;s</span>
<span class="sd">                Learner workers. Note that if RLlib cannot infer any space information</span>
<span class="sd">                either from this `env` arg, from the optional `spaces` arg or from</span>
<span class="sd">                `self`, the LearnerGroup cannot be created.</span>
<span class="sd">            spaces: An optional dict mapping ModuleIDs to</span>
<span class="sd">                (observation-space, action-space)-tuples for the to-be-constructed</span>
<span class="sd">                RLModule inside the LearnerGroup&#39;s Learner workers. Note that if RLlib</span>
<span class="sd">                cannot infer any space information either from this `spces` arg,</span>
<span class="sd">                from the optional `env` arg or from `self`, the LearnerGroup cannot</span>
<span class="sd">                be created.</span>
<span class="sd">            rl_module_spec: An optional (single-agent or multi-agent) RLModuleSpec to</span>
<span class="sd">                use for the constructed LearnerGroup. If None, RLlib will try to infer</span>
<span class="sd">                the RLModuleSpec using the other information given and stored in this</span>
<span class="sd">                `AlgorithmConfig` object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The newly created `LearnerGroup` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ray.rllib.core.learner.learner_group</span> <span class="kn">import</span> <span class="n">LearnerGroup</span>

        <span class="c1"># If `spaces` or `env` provided -&gt; Create a MultiRLModuleSpec first to be</span>
        <span class="c1"># passed into the LearnerGroup constructor.</span>
        <span class="k">if</span> <span class="n">rl_module_spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rl_module_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_multi_rl_module_spec</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">spaces</span><span class="o">=</span><span class="n">spaces</span><span class="p">)</span>

        <span class="c1"># Construct the actual LearnerGroup.</span>
        <span class="n">learner_group</span> <span class="o">=</span> <span class="n">LearnerGroup</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">module_spec</span><span class="o">=</span><span class="n">rl_module_spec</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">learner_group</span></div>


<div class="viewcode-block" id="AlgorithmConfig.build_learner">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.build_learner">[docs]</a>
    <span class="k">def</span> <span class="nf">build_learner</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spaces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Learner&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds and returns a new Learner object based on settings in `self`.</span>

<span class="sd">        This Learner object will already have its `build()` method called, meaning</span>
<span class="sd">        its RLModule will already be constructed.</span>

<span class="sd">        Args:</span>
<span class="sd">            env: An optional EnvType object (e.g. a gym.Env) useful for extracting space</span>
<span class="sd">                information for the to-be-constructed RLModule inside the Learner.</span>
<span class="sd">                Note that if RLlib cannot infer any space information</span>
<span class="sd">                either from this `env` arg, from the optional `spaces` arg or from</span>
<span class="sd">                `self`, the Learner cannot be created.</span>
<span class="sd">            spaces: An optional dict mapping ModuleIDs to</span>
<span class="sd">                (observation-space, action-space)-tuples for the to-be-constructed</span>
<span class="sd">                RLModule inside the Learner. Note that if RLlib cannot infer any</span>
<span class="sd">                space information either from this `spces` arg, from the optional</span>
<span class="sd">                `env` arg or from `self`, the Learner cannot be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The newly created (and already built) Learner object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If `spaces` or `env` provided -&gt; Create a MultiRLModuleSpec first to be</span>
        <span class="c1"># passed into the LearnerGroup constructor.</span>
        <span class="n">rl_module_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">spaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rl_module_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_multi_rl_module_spec</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">spaces</span><span class="o">=</span><span class="n">spaces</span><span class="p">)</span>
        <span class="c1"># Construct the actual Learner object.</span>
        <span class="n">learner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learner_class</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_spec</span><span class="o">=</span><span class="n">rl_module_spec</span><span class="p">)</span>
        <span class="c1"># `build()` the Learner (internal structures such as RLModule, etc..).</span>
        <span class="n">learner</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">learner</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_config_for_module">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_config_for_module.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_config_for_module">[docs]</a>
    <span class="k">def</span> <span class="nf">get_config_for_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_id</span><span class="p">:</span> <span class="n">ModuleID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an AlgorithmConfig object, specific to the given module ID.</span>

<span class="sd">        In a multi-agent setup, individual modules might override one or more</span>
<span class="sd">        AlgorithmConfig properties (e.g. `train_batch_size`, `lr`) using the</span>
<span class="sd">        `overrides()` method.</span>

<span class="sd">        In order to retrieve a full AlgorithmConfig instance (with all these overrides</span>
<span class="sd">        already translated and built-in), users can call this method with the respective</span>
<span class="sd">        module ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            module_id: The module ID for which to get the final AlgorithmConfig object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new AlgorithmConfig object for the specific module ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ModuleID NOT found in cached ModuleID, but in overrides dict.</span>
        <span class="c1"># Create new algo config object and cache it.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">module_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_module_overrides</span>
            <span class="ow">and</span> <span class="n">module_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_config_overrides_per_module</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_per_module_overrides</span><span class="p">[</span><span class="n">module_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">update_from_dict</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_config_overrides_per_module</span><span class="p">[</span><span class="n">module_id</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the module specific algo config object.</span>
        <span class="k">if</span> <span class="n">module_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_module_overrides</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_module_overrides</span><span class="p">[</span><span class="n">module_id</span><span class="p">]</span>
        <span class="c1"># No overrides for ModuleID -&gt; return self.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.python_environment">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.python_environment.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.python_environment">[docs]</a>
    <span class="k">def</span> <span class="nf">python_environment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">extra_python_environs_for_driver</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">extra_python_environs_for_worker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s python environment settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            extra_python_environs_for_driver: Any extra python env vars to set in the</span>
<span class="sd">                algorithm&#39;s process, e.g., {&quot;OMP_NUM_THREADS&quot;: &quot;16&quot;}.</span>
<span class="sd">            extra_python_environs_for_worker: The extra python environments need to set</span>
<span class="sd">                for worker processes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">extra_python_environs_for_driver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extra_python_environs_for_driver</span> <span class="o">=</span> <span class="n">extra_python_environs_for_driver</span>
        <span class="k">if</span> <span class="n">extra_python_environs_for_worker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extra_python_environs_for_worker</span> <span class="o">=</span> <span class="n">extra_python_environs_for_worker</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.resources">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.resources">[docs]</a>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">num_cpus_for_main_process</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_gpus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">_fake_gpus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">placement_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">num_cpus_per_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `env_runners`</span>
        <span class="n">num_gpus_per_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `env_runners`</span>
        <span class="n">custom_resources_per_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `env_runners`</span>
        <span class="n">num_learner_workers</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `learners`</span>
        <span class="n">num_cpus_per_learner_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `learners`</span>
        <span class="n">num_gpus_per_learner_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `learners`</span>
        <span class="n">local_gpu_idx</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>  <span class="c1"># moved to `learners`</span>
        <span class="n">num_cpus_for_local_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Specifies resources allocated for an Algorithm and its ray actors/workers.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_cpus_for_main_process: Number of CPUs to allocate for the main algorithm</span>
<span class="sd">                process that runs `Algorithm.training_step()`.</span>
<span class="sd">                Note: This is only relevant when running RLlib through Tune. Otherwise,</span>
<span class="sd">                `Algorithm.training_step()` runs in the main program (driver).</span>
<span class="sd">            num_gpus: Number of GPUs to allocate to the algorithm process.</span>
<span class="sd">                Note that not all algorithms can take advantage of GPUs.</span>
<span class="sd">                Support for multi-GPU is currently only available for</span>
<span class="sd">                tf-[PPO/IMPALA/DQN/PG]. This can be fractional (e.g., 0.3 GPUs).</span>
<span class="sd">            _fake_gpus: Set to True for debugging (multi-)?GPU funcitonality on a</span>
<span class="sd">                CPU machine. GPU towers will be simulated by graphs located on</span>
<span class="sd">                CPUs in this case. Use `num_gpus` to test for different numbers of</span>
<span class="sd">                fake GPUs.</span>
<span class="sd">            placement_strategy: The strategy for the placement group factory returned by</span>
<span class="sd">                `Algorithm.default_resource_request()`. A PlacementGroup defines, which</span>
<span class="sd">                devices (resources) should always be co-located on the same node.</span>
<span class="sd">                For example, an Algorithm with 2 EnvRunners and 1 Learner (with</span>
<span class="sd">                1 GPU) will request a placement group with the bundles:</span>
<span class="sd">                [{&quot;cpu&quot;: 1}, {&quot;gpu&quot;: 1, &quot;cpu&quot;: 1}, {&quot;cpu&quot;: 1}, {&quot;cpu&quot;: 1}], where the</span>
<span class="sd">                first bundle is for the local (main Algorithm) process, the second one</span>
<span class="sd">                for the 1 Learner worker and the last 2 bundles are for the two</span>
<span class="sd">                EnvRunners. These bundles can now be &quot;placed&quot; on the same or different</span>
<span class="sd">                nodes depending on the value of `placement_strategy`:</span>
<span class="sd">                &quot;PACK&quot;: Packs bundles into as few nodes as possible.</span>
<span class="sd">                &quot;SPREAD&quot;: Places bundles across distinct nodes as even as possible.</span>
<span class="sd">                &quot;STRICT_PACK&quot;: Packs bundles into one node. The group is not allowed</span>
<span class="sd">                to span multiple nodes.</span>
<span class="sd">                &quot;STRICT_SPREAD&quot;: Packs bundles across distinct nodes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_cpus_per_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_cpus_per_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(num_cpus_per_env_runner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_env_runner</span> <span class="o">=</span> <span class="n">num_cpus_per_worker</span>

        <span class="k">if</span> <span class="n">num_gpus_per_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_gpus_per_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(num_gpus_per_env_runner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_env_runner</span> <span class="o">=</span> <span class="n">num_gpus_per_worker</span>

        <span class="k">if</span> <span class="n">custom_resources_per_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(custom_resources_per_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(custom_resources_per_env_runner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_resources_per_env_runner</span> <span class="o">=</span> <span class="n">custom_resources_per_worker</span>

        <span class="k">if</span> <span class="n">num_learner_workers</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_learner_workers)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.learners(num_learner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span> <span class="o">=</span> <span class="n">num_learner_workers</span>

        <span class="k">if</span> <span class="n">num_cpus_per_learner_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_cpus_per_learner_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.learners(num_cpus_per_learner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_learner</span> <span class="o">=</span> <span class="n">num_cpus_per_learner_worker</span>

        <span class="k">if</span> <span class="n">num_gpus_per_learner_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_gpus_per_learner_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.learners(num_gpus_per_learner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_learner</span> <span class="o">=</span> <span class="n">num_gpus_per_learner_worker</span>

        <span class="k">if</span> <span class="n">local_gpu_idx</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(local_gpu_idx)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.learners(local_gpu_idx)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_gpu_idx</span> <span class="o">=</span> <span class="n">local_gpu_idx</span>

        <span class="k">if</span> <span class="n">num_cpus_for_local_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_cpus_for_local_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.resources(num_cpus_for_main_process)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_for_main_process</span> <span class="o">=</span> <span class="n">num_cpus_for_local_worker</span>

        <span class="k">if</span> <span class="n">num_cpus_for_main_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_for_main_process</span> <span class="o">=</span> <span class="n">num_cpus_for_main_process</span>
        <span class="k">if</span> <span class="n">num_gpus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">=</span> <span class="n">num_gpus</span>
        <span class="k">if</span> <span class="n">_fake_gpus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fake_gpus</span> <span class="o">=</span> <span class="n">_fake_gpus</span>
        <span class="k">if</span> <span class="n">placement_strategy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">placement_strategy</span> <span class="o">=</span> <span class="n">placement_strategy</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.framework">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.framework">[docs]</a>
    <span class="k">def</span> <span class="nf">framework</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">framework</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">eager_tracing</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">eager_max_retraces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">tf_session_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">local_tf_session_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_learner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_learner_what_to_compile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_learner_dynamo_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_learner_dynamo_backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_worker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_worker_dynamo_backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_compile_worker_dynamo_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_ddp_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">torch_skip_nan_gradients</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s DL framework settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            framework: torch: PyTorch; tf2: TensorFlow 2.x (eager execution or traced</span>
<span class="sd">                if eager_tracing=True); tf: TensorFlow (static-graph);</span>
<span class="sd">            eager_tracing: Enable tracing in eager mode. This greatly improves</span>
<span class="sd">                performance (speedup ~2x), but makes it slightly harder to debug</span>
<span class="sd">                since Python code won&#39;t be evaluated after the initial eager pass.</span>
<span class="sd">                Only possible if framework=tf2.</span>
<span class="sd">            eager_max_retraces: Maximum number of tf.function re-traces before a</span>
<span class="sd">                runtime error is raised. This is to prevent unnoticed retraces of</span>
<span class="sd">                methods inside the `..._eager_traced` Policy, which could slow down</span>
<span class="sd">                execution by a factor of 4, without the user noticing what the root</span>
<span class="sd">                cause for this slowdown could be.</span>
<span class="sd">                Only necessary for framework=tf2.</span>
<span class="sd">                Set to None to ignore the re-trace count and never throw an error.</span>
<span class="sd">            tf_session_args: Configures TF for single-process operation by default.</span>
<span class="sd">            local_tf_session_args: Override the following tf session args on the local</span>
<span class="sd">                worker</span>
<span class="sd">            torch_compile_learner: If True, forward_train methods on TorchRLModules</span>
<span class="sd">                on the learner are compiled. If not specified, the default is to compile</span>
<span class="sd">                forward train on the learner.</span>
<span class="sd">            torch_compile_learner_what_to_compile: A TorchCompileWhatToCompile</span>
<span class="sd">                mode specifying what to compile on the learner side if</span>
<span class="sd">                torch_compile_learner is True. See TorchCompileWhatToCompile for</span>
<span class="sd">                details and advice on its usage.</span>
<span class="sd">            torch_compile_learner_dynamo_backend: The torch dynamo backend to use on</span>
<span class="sd">                the learner.</span>
<span class="sd">            torch_compile_learner_dynamo_mode: The torch dynamo mode to use on the</span>
<span class="sd">                learner.</span>
<span class="sd">            torch_compile_worker: If True, forward exploration and inference methods on</span>
<span class="sd">                TorchRLModules on the workers are compiled. If not specified,</span>
<span class="sd">                the default is to not compile forward methods on the workers because</span>
<span class="sd">                retracing can be expensive.</span>
<span class="sd">            torch_compile_worker_dynamo_backend: The torch dynamo backend to use on</span>
<span class="sd">                the workers.</span>
<span class="sd">            torch_compile_worker_dynamo_mode: The torch dynamo mode to use on the</span>
<span class="sd">                workers.</span>
<span class="sd">            torch_ddp_kwargs: The kwargs to pass into</span>
<span class="sd">                `torch.nn.parallel.DistributedDataParallel` when using `num_learners</span>
<span class="sd">                &gt; 1`. This is specifically helpful when searching for unused parameters</span>
<span class="sd">                that are not used in the backward pass. This can give hints for errors</span>
<span class="sd">                in custom models where some parameters do not get touched in the</span>
<span class="sd">                backward pass although they should.</span>
<span class="sd">            torch_skip_nan_gradients: If updates with `nan` gradients should be entirely</span>
<span class="sd">                skipped. This skips updates in the optimizer entirely if they contain</span>
<span class="sd">                any `nan` gradient. This can help to avoid biasing moving-average based</span>
<span class="sd">                optimizers - like Adam. This can help in training phases where policy</span>
<span class="sd">                updates can be highly unstable such as during the early stages of</span>
<span class="sd">                training or with highly exploratory policies. In such phases many</span>
<span class="sd">                gradients might turn `nan` and setting them to zero could corrupt the</span>
<span class="sd">                optimizer&#39;s internal state. The default is `False` and turns `nan`</span>
<span class="sd">                gradients to zero. If many `nan` gradients are encountered consider (a)</span>
<span class="sd">                monitoring gradients by setting `log_gradients` in `AlgorithmConfig` to</span>
<span class="sd">                `True`, (b) use proper weight initialization (e.g. Xavier, Kaiming) via</span>
<span class="sd">                the `model_config_dict` in `AlgorithmConfig.rl_module` and/or (c)</span>
<span class="sd">                gradient clipping via `grad_clip` in `AlgorithmConfig.training`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">framework</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">framework</span> <span class="o">==</span> <span class="s2">&quot;tfe&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.framework(&#39;tfe&#39;)&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.framework(&#39;tf2&#39;)&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">=</span> <span class="n">framework</span>
        <span class="k">if</span> <span class="n">eager_tracing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eager_tracing</span> <span class="o">=</span> <span class="n">eager_tracing</span>
        <span class="k">if</span> <span class="n">eager_max_retraces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eager_max_retraces</span> <span class="o">=</span> <span class="n">eager_max_retraces</span>
        <span class="k">if</span> <span class="n">tf_session_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tf_session_args</span> <span class="o">=</span> <span class="n">tf_session_args</span>
        <span class="k">if</span> <span class="n">local_tf_session_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_tf_session_args</span> <span class="o">=</span> <span class="n">local_tf_session_args</span>

        <span class="k">if</span> <span class="n">torch_compile_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner</span> <span class="o">=</span> <span class="n">torch_compile_learner</span>
        <span class="k">if</span> <span class="n">torch_compile_learner_dynamo_backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_dynamo_backend</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">torch_compile_learner_dynamo_backend</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">torch_compile_learner_dynamo_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_dynamo_mode</span> <span class="o">=</span> <span class="n">torch_compile_learner_dynamo_mode</span>
        <span class="k">if</span> <span class="n">torch_compile_learner_what_to_compile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_what_to_compile</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">torch_compile_learner_what_to_compile</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">torch_compile_worker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker</span> <span class="o">=</span> <span class="n">torch_compile_worker</span>
        <span class="k">if</span> <span class="n">torch_compile_worker_dynamo_backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker_dynamo_backend</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">torch_compile_worker_dynamo_backend</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">torch_compile_worker_dynamo_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker_dynamo_mode</span> <span class="o">=</span> <span class="n">torch_compile_worker_dynamo_mode</span>
        <span class="k">if</span> <span class="n">torch_ddp_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_ddp_kwargs</span> <span class="o">=</span> <span class="n">torch_ddp_kwargs</span>
        <span class="k">if</span> <span class="n">torch_skip_nan_gradients</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torch_skip_nan_gradients</span> <span class="o">=</span> <span class="n">torch_skip_nan_gradients</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.api_stack">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.api_stack.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.api_stack">[docs]</a>
    <span class="k">def</span> <span class="nf">api_stack</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">enable_rl_module_and_learner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">enable_env_runner_and_connector_v2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s API stack settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            enable_rl_module_and_learner: Enables the usage of `RLModule` (instead of</span>
<span class="sd">                `ModelV2`) and Learner (instead of the training-related parts of</span>
<span class="sd">                `Policy`). If `enable_env_runner_and_connector_v2=False`, these two</span>
<span class="sd">                classes (`RLModule` and `Learner`) will be used along with</span>
<span class="sd">                `RolloutWorkers` and `Policy`.</span>
<span class="sd">            enable_env_runner_and_connector_v2: Enables the usage of EnvRunners</span>
<span class="sd">                (SingleAgentEnvRunner and MultiAgentEnvRunner) and ConnectorV2.</span>
<span class="sd">                When setting this to True, `enable_rl_module_and_learner` must be True</span>
<span class="sd">                as well.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">enable_rl_module_and_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span> <span class="o">=</span> <span class="n">enable_rl_module_and_learner</span>

            <span class="k">if</span> <span class="n">enable_rl_module_and_learner</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prior_exploration_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">elif</span> <span class="n">enable_rl_module_and_learner</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prior_exploration_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prior_exploration_config</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__prior_exploration_config</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;config.enable_rl_module_and_learner was set to False, but no &quot;</span>
                        <span class="s2">&quot;prior exploration config was found to be restored.&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">enable_env_runner_and_connector_v2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_env_runner_and_connector_v2</span> <span class="o">=</span> <span class="n">enable_env_runner_and_connector_v2</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.environment">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.environment">[docs]</a>
    <span class="k">def</span> <span class="nf">environment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EnvType</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">env_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvConfigDict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">observation_space</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">action_space</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">env_task_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">ResultDict</span><span class="p">,</span> <span class="n">EnvType</span><span class="p">,</span> <span class="n">EnvContext</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">render_env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">clip_rewards</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">normalize_actions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">clip_actions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">disable_env_checking</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">is_atari</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">action_mask_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">auto_wrap_old_gym_envs</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s RL-environment settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            env: The environment specifier. This can either be a tune-registered env,</span>
<span class="sd">                via `tune.register_env([name], lambda env_ctx: [env object])`,</span>
<span class="sd">                or a string specifier of an RLlib supported type. In the latter case,</span>
<span class="sd">                RLlib will try to interpret the specifier as either an Farama-Foundation</span>
<span class="sd">                gymnasium env, a PyBullet env, or a fully qualified classpath to an Env</span>
<span class="sd">                class, e.g. &quot;ray.rllib.examples.envs.classes.random_env.RandomEnv&quot;.</span>
<span class="sd">            env_config: Arguments dict passed to the env creator as an EnvContext</span>
<span class="sd">                object (which is a dict plus the properties: `num_env_runners`,</span>
<span class="sd">                `worker_index`, `vector_index`, and `remote`).</span>
<span class="sd">            observation_space: The observation space for the Policies of this Algorithm.</span>
<span class="sd">            action_space: The action space for the Policies of this Algorithm.</span>
<span class="sd">            env_task_fn: A callable taking the last train results, the base env and the</span>
<span class="sd">                env context as args and returning a new task to set the env to.</span>
<span class="sd">                The env must be a `TaskSettableEnv` sub-class for this to work.</span>
<span class="sd">                See `examples/curriculum_learning.py` for an example.</span>
<span class="sd">            render_env: If True, try to render the environment on the local worker or on</span>
<span class="sd">                worker 1 (if num_env_runners &gt; 0). For vectorized envs, this usually</span>
<span class="sd">                means that only the first sub-environment will be rendered.</span>
<span class="sd">                In order for this to work, your env will have to implement the</span>
<span class="sd">                `render()` method which either:</span>
<span class="sd">                a) handles window generation and rendering itself (returning True) or</span>
<span class="sd">                b) returns a numpy uint8 image of shape [height x width x 3 (RGB)].</span>
<span class="sd">            clip_rewards: Whether to clip rewards during Policy&#39;s postprocessing.</span>
<span class="sd">                None (default): Clip for Atari only (r=sign(r)).</span>
<span class="sd">                True: r=sign(r): Fixed rewards -1.0, 1.0, or 0.0.</span>
<span class="sd">                False: Never clip.</span>
<span class="sd">                [float value]: Clip at -value and + value.</span>
<span class="sd">                Tuple[value1, value2]: Clip at value1 and value2.</span>
<span class="sd">            normalize_actions: If True, RLlib will learn entirely inside a normalized</span>
<span class="sd">                action space (0.0 centered with small stddev; only affecting Box</span>
<span class="sd">                components). RLlib will unsquash actions (and clip, just in case) to the</span>
<span class="sd">                bounds of the env&#39;s action space before sending actions back to the env.</span>
<span class="sd">            clip_actions: If True, the RLlib default ModuleToEnv connector will clip</span>
<span class="sd">                actions according to the env&#39;s bounds (before sending them into the</span>
<span class="sd">                `env.step()` call).</span>
<span class="sd">            disable_env_checking: Disable RLlib&#39;s env checks after a gymnasium.Env</span>
<span class="sd">                instance has been constructed in an EnvRunner. Note that the checks</span>
<span class="sd">                include an `env.reset()` and `env.step()` (with a random action), which</span>
<span class="sd">                might tinker with your env&#39;s logic and behavior and thus negatively</span>
<span class="sd">                influence sample collection- and/or learning behavior.</span>
<span class="sd">            is_atari: This config can be used to explicitly specify whether the env is</span>
<span class="sd">                an Atari env or not. If not specified, RLlib will try to auto-detect</span>
<span class="sd">                this.</span>
<span class="sd">            action_mask_key: If observation is a dictionary, expect the value by</span>
<span class="sd">                the key `action_mask_key` to contain a valid actions mask (`numpy.int8`</span>
<span class="sd">                array of zeros and ones). Defaults to &quot;action_mask&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">auto_wrap_old_gym_envs</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.environment(auto_wrap_old_gym_envs=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="k">if</span> <span class="n">env_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="n">deep_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_config</span><span class="p">,</span> <span class="n">env_config</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">observation_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">observation_space</span>
        <span class="k">if</span> <span class="n">action_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">action_space</span>
        <span class="k">if</span> <span class="n">env_task_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env_task_fn</span> <span class="o">=</span> <span class="n">env_task_fn</span>
        <span class="k">if</span> <span class="n">render_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render_env</span> <span class="o">=</span> <span class="n">render_env</span>
        <span class="k">if</span> <span class="n">clip_rewards</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clip_rewards</span> <span class="o">=</span> <span class="n">clip_rewards</span>
        <span class="k">if</span> <span class="n">normalize_actions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalize_actions</span> <span class="o">=</span> <span class="n">normalize_actions</span>
        <span class="k">if</span> <span class="n">clip_actions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clip_actions</span> <span class="o">=</span> <span class="n">clip_actions</span>
        <span class="k">if</span> <span class="n">disable_env_checking</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_env_checking</span> <span class="o">=</span> <span class="n">disable_env_checking</span>
        <span class="k">if</span> <span class="n">is_atari</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_atari</span> <span class="o">=</span> <span class="n">is_atari</span>
        <span class="k">if</span> <span class="n">action_mask_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_mask_key</span> <span class="o">=</span> <span class="n">action_mask_key</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.env_runners">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.env_runners.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.env_runners">[docs]</a>
    <span class="k">def</span> <span class="nf">env_runners</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">env_runner_cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_env_runners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_envs_per_env_runner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_cpus_per_env_runner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_gpus_per_env_runner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">custom_resources_per_env_runner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">validate_env_runners_after_construction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">sample_timeout_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">max_requests_in_flight_per_env_runner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">env_to_module_connector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">EnvType</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ConnectorV2&quot;</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ConnectorV2&quot;</span><span class="p">]]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">module_to_env_connector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">EnvType</span><span class="p">,</span> <span class="s2">&quot;RLModule&quot;</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ConnectorV2&quot;</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ConnectorV2&quot;</span><span class="p">]]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">add_default_connectors_to_env_to_module_pipeline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">add_default_connectors_to_module_to_env_pipeline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">episode_lookback_horizon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">use_worker_filter_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">update_worker_filter_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">compress_observations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">rollout_fragment_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">batch_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">explore</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># @OldAPIStack settings.</span>
        <span class="n">exploration_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">create_env_on_local_worker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">sample_collector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">SampleCollector</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">enable_connectors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">remote_worker_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">remote_env_batch_wait_ms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">preprocessor_pref</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">observation_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">enable_tf1_exec_eagerly</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="n">sampler_perf_stats_ema_coef</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>  <span class="c1"># @OldAPIStack</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">num_rollout_workers</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">num_envs_per_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">validate_workers_after_construction</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">ignore_worker_failures</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">recreate_failed_workers</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">restart_failed_sub_environments</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">num_consecutive_worker_failures_tolerance</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">worker_health_probe_timeout_s</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">worker_restore_timeout_s</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">synchronize_filter</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the rollout worker configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            env_runner_cls: The EnvRunner class to use for environment rollouts (data</span>
<span class="sd">                collection).</span>
<span class="sd">            num_env_runners: Number of EnvRunner actors to create for parallel sampling.</span>
<span class="sd">                Setting this to 0 will force sampling to be done in the local</span>
<span class="sd">                EnvRunner (main process or the Algorithm&#39;s actor when using Tune).</span>
<span class="sd">            num_envs_per_env_runner: Number of environments to step through</span>
<span class="sd">                (vector-wise) per EnvRunner. This enables batching when computing</span>
<span class="sd">                actions through RLModule inference, which can improve performance</span>
<span class="sd">                for inference-bottlenecked workloads.</span>
<span class="sd">            num_cpus_per_env_runner: Number of CPUs to allocate per EnvRunner.</span>
<span class="sd">            num_gpus_per_env_runner: Number of GPUs to allocate per EnvRunner. This can</span>
<span class="sd">                be fractional. This is usually needed only if your env itself requires a</span>
<span class="sd">                GPU (i.e., it is a GPU-intensive video game), or model inference is</span>
<span class="sd">                unusually expensive.</span>
<span class="sd">            custom_resources_per_env_runner: Any custom Ray resources to allocate per</span>
<span class="sd">                EnvRunner.</span>
<span class="sd">            sample_timeout_s: The timeout in seconds for calling `sample()` on remote</span>
<span class="sd">                EnvRunner workers. Results (episode list) from workers that take longer</span>
<span class="sd">                than this time are discarded. Only used by algorithms that sample</span>
<span class="sd">                synchronously in turn with their update step (e.g., PPO or DQN). Not</span>
<span class="sd">                relevant for any algos that sample asynchronously, such as APPO or</span>
<span class="sd">                IMPALA.</span>
<span class="sd">            max_requests_in_flight_per_env_runner: Max number of inflight requests</span>
<span class="sd">                to each EnvRunner worker. See the FaultTolerantActorManager class for</span>
<span class="sd">                more details.</span>
<span class="sd">                Tuning these values is important when running experiments with</span>
<span class="sd">                large sample batches, where there is the risk that the object store may</span>
<span class="sd">                fill up, causing spilling of objects to disk. This can cause any</span>
<span class="sd">                asynchronous requests to become very slow, making your experiment run</span>
<span class="sd">                slowly as well. You can inspect the object store during your experiment</span>
<span class="sd">                via a call to Ray memory on your head node, and by using the Ray</span>
<span class="sd">                dashboard. If you&#39;re seeing that the object store is filling up,</span>
<span class="sd">                turn down the number of remote requests in flight or enable compression.</span>
<span class="sd">            sample_collector: For the old API stack only. The SampleCollector class to</span>
<span class="sd">                be used to collect and retrieve environment-, model-, and sampler data.</span>
<span class="sd">                Override the SampleCollector base class to implement your own</span>
<span class="sd">                collection/buffering/retrieval logic.</span>
<span class="sd">            create_env_on_local_worker: When `num_env_runners` &gt; 0, the driver</span>
<span class="sd">                (local_worker; worker-idx=0) does not need an environment. This is</span>
<span class="sd">                because it doesn&#39;t have to sample (done by remote_workers;</span>
<span class="sd">                worker_indices &gt; 0) nor evaluate (done by evaluation workers;</span>
<span class="sd">                see below).</span>
<span class="sd">            enable_connectors: Use connector based environment runner, so that all</span>
<span class="sd">                preprocessing of obs and postprocessing of actions are done in agent</span>
<span class="sd">                and action connectors.</span>
<span class="sd">            env_to_module_connector: A callable taking an Env as input arg and returning</span>
<span class="sd">                an env-to-module ConnectorV2 (might be a pipeline) object.</span>
<span class="sd">            module_to_env_connector: A callable taking an Env and an RLModule as input</span>
<span class="sd">                args and returning a module-to-env ConnectorV2 (might be a pipeline)</span>
<span class="sd">                object.</span>
<span class="sd">            add_default_connectors_to_env_to_module_pipeline: If True (default), RLlib&#39;s</span>
<span class="sd">                EnvRunners will automatically add the default env-to-module ConnectorV2</span>
<span class="sd">                pieces to the EnvToModulePipeline. These automatically perform adding</span>
<span class="sd">                observations and states (in case of stateful Module(s)), agent-to-module</span>
<span class="sd">                mapping, batching, and conversion to tensor data. Only if you know</span>
<span class="sd">                exactly what you are doing, you should set this setting to False.</span>
<span class="sd">                Note that this setting is only relevant if the new API stack is used</span>
<span class="sd">                (including the new EnvRunner classes).</span>
<span class="sd">            add_default_connectors_to_module_to_env_pipeline: If True (default), RLlib&#39;s</span>
<span class="sd">                EnvRunners will automatically add the default module-to-env ConnectorV2</span>
<span class="sd">                pieces to the ModuleToEnvPipeline. These automatically perform removing</span>
<span class="sd">                the additional time-rank (if applicable, in case of stateful</span>
<span class="sd">                Module(s)), module-to-agent unmapping, un-batching (to lists), and</span>
<span class="sd">                conversion from tensor data to numpy. Only if you know exactly what you</span>
<span class="sd">                are doing, you should set this setting to False.</span>
<span class="sd">                Note that this setting is only relevant if the new API stack is used</span>
<span class="sd">                (including the new EnvRunner classes).</span>
<span class="sd">            episode_lookback_horizon: The amount of data (in timesteps) to keep from the</span>
<span class="sd">                preceeding episode chunk when a new chunk (for the same episode) is</span>
<span class="sd">                generated to continue sampling at a later time. The larger this value,</span>
<span class="sd">                the more an env-to-module connector will be able to look back in time</span>
<span class="sd">                and compile RLModule input data from this information. For example, if</span>
<span class="sd">                your custom env-to-module connector (and your custom RLModule) requires</span>
<span class="sd">                the previous 10 rewards as inputs, you must set this to at least 10.</span>
<span class="sd">            use_worker_filter_stats: Whether to use the workers in the EnvRunnerGroup to</span>
<span class="sd">                update the central filters (held by the local worker). If False, stats</span>
<span class="sd">                from the workers will not be used and discarded.</span>
<span class="sd">            update_worker_filter_stats: Whether to push filter updates from the central</span>
<span class="sd">                filters (held by the local worker) to the remote workers&#39; filters.</span>
<span class="sd">                Setting this to True might be useful within the evaluation config in</span>
<span class="sd">                order to disable the usage of evaluation trajectories for synching</span>
<span class="sd">                the central filter (used for training).</span>
<span class="sd">            rollout_fragment_length: Divide episodes into fragments of this many steps</span>
<span class="sd">                each during sampling. Trajectories of this size are collected from</span>
<span class="sd">                EnvRunners and combined into a larger batch of `train_batch_size`</span>
<span class="sd">                for learning.</span>
<span class="sd">                For example, given rollout_fragment_length=100 and</span>
<span class="sd">                train_batch_size=1000:</span>
<span class="sd">                1. RLlib collects 10 fragments of 100 steps each from rollout workers.</span>
<span class="sd">                2. These fragments are concatenated and we perform an epoch of SGD.</span>
<span class="sd">                When using multiple envs per worker, the fragment size is multiplied by</span>
<span class="sd">                `num_envs_per_env_runner`. This is since we are collecting steps from</span>
<span class="sd">                multiple envs in parallel. For example, if num_envs_per_env_runner=5,</span>
<span class="sd">                then EnvRunners will return experiences in chunks of 5*100 = 500 steps.</span>
<span class="sd">                The dataflow here can vary per algorithm. For example, PPO further</span>
<span class="sd">                divides the train batch into minibatches for multi-epoch SGD.</span>
<span class="sd">                Set `rollout_fragment_length` to &quot;auto&quot; to have RLlib compute an exact</span>
<span class="sd">                value to match the given batch size.</span>
<span class="sd">            batch_mode: How to build individual batches with the EnvRunner(s). Batches</span>
<span class="sd">                coming from distributed EnvRunners are usually concat&#39;d to form the</span>
<span class="sd">                train batch. Note that &quot;steps&quot; below can mean different things (either</span>
<span class="sd">                env- or agent-steps) and depends on the `count_steps_by` setting,</span>
<span class="sd">                adjustable via `AlgorithmConfig.multi_agent(count_steps_by=..)`:</span>
<span class="sd">                1) &quot;truncate_episodes&quot;: Each call to `EnvRunner.sample()` will return a</span>
<span class="sd">                batch of at most `rollout_fragment_length * num_envs_per_env_runner` in</span>
<span class="sd">                size. The batch will be exactly `rollout_fragment_length * num_envs`</span>
<span class="sd">                in size if postprocessing does not change batch sizes. Episodes</span>
<span class="sd">                may be truncated in order to meet this size requirement.</span>
<span class="sd">                This mode guarantees evenly sized batches, but increases</span>
<span class="sd">                variance as the future return must now be estimated at truncation</span>
<span class="sd">                boundaries.</span>
<span class="sd">                2) &quot;complete_episodes&quot;: Each call to `EnvRunner.sample()` will return a</span>
<span class="sd">                batch of at least `rollout_fragment_length * num_envs_per_env_runner` in</span>
<span class="sd">                size. Episodes will not be truncated, but multiple episodes</span>
<span class="sd">                may be packed within one batch to meet the (minimum) batch size.</span>
<span class="sd">                Note that when `num_envs_per_env_runner &gt; 1`, episode steps will be</span>
<span class="sd">                buffered until the episode completes, and hence batches may contain</span>
<span class="sd">                significant amounts of off-policy data.</span>
<span class="sd">            explore: Default exploration behavior, iff `explore=None` is passed into</span>
<span class="sd">                compute_action(s). Set to False for no exploration behavior (e.g.,</span>
<span class="sd">                for evaluation).</span>
<span class="sd">            exploration_config: A dict specifying the Exploration object&#39;s config.</span>
<span class="sd">            remote_worker_envs: If using num_envs_per_env_runner &gt; 1, whether to create</span>
<span class="sd">                those new envs in remote processes instead of in the same worker.</span>
<span class="sd">                This adds overheads, but can make sense if your envs can take much</span>
<span class="sd">                time to step / reset (e.g., for StarCraft). Use this cautiously;</span>
<span class="sd">                overheads are significant.</span>
<span class="sd">            remote_env_batch_wait_ms: Timeout that remote workers are waiting when</span>
<span class="sd">                polling environments. 0 (continue when at least one env is ready) is</span>
<span class="sd">                a reasonable default, but optimal value could be obtained by measuring</span>
<span class="sd">                your environment step / reset and model inference perf.</span>
<span class="sd">            validate_env_runners_after_construction: Whether to validate that each</span>
<span class="sd">                created remote EnvRunner is healthy after its construction process.</span>
<span class="sd">            preprocessor_pref: Whether to use &quot;rllib&quot; or &quot;deepmind&quot; preprocessors by</span>
<span class="sd">                default. Set to None for using no preprocessor. In this case, the</span>
<span class="sd">                model will have to handle possibly complex observations from the</span>
<span class="sd">                environment.</span>
<span class="sd">            observation_filter: Element-wise observation filter, either &quot;NoFilter&quot;</span>
<span class="sd">                or &quot;MeanStdFilter&quot;.</span>
<span class="sd">            compress_observations: Whether to LZ4 compress individual observations</span>
<span class="sd">                in the SampleBatches collected during rollouts.</span>
<span class="sd">            enable_tf1_exec_eagerly: Explicitly tells the rollout worker to enable</span>
<span class="sd">                TF eager execution. This is useful for example when framework is</span>
<span class="sd">                &quot;torch&quot;, but a TF2 policy needs to be restored for evaluation or</span>
<span class="sd">                league-based purposes.</span>
<span class="sd">            sampler_perf_stats_ema_coef: If specified, perf stats are in EMAs. This</span>
<span class="sd">                is the coeff of how much new data points contribute to the averages.</span>
<span class="sd">                Default is None, which uses simple global average instead.</span>
<span class="sd">                The EMA update rule is: updated = (1 - ema_coef) * old + ema_coef * new</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_rollout_workers</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(num_rollout_workers)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(num_env_runners)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="o">=</span> <span class="n">num_rollout_workers</span>
        <span class="k">if</span> <span class="n">num_envs_per_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(num_envs_per_worker)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(num_envs_per_env_runner)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">=</span> <span class="n">num_envs_per_worker</span>
        <span class="k">if</span> <span class="n">validate_workers_after_construction</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(validate_workers_after_construction)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(validate_env_runners_after_&quot;</span>
                <span class="s2">&quot;construction)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_env_runners_after_construction</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">validate_workers_after_construction</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">env_runner_cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_cls</span> <span class="o">=</span> <span class="n">env_runner_cls</span>
        <span class="k">if</span> <span class="n">num_env_runners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="o">=</span> <span class="n">num_env_runners</span>
        <span class="k">if</span> <span class="n">num_envs_per_env_runner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num_envs_per_env_runner</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;`num_envs_per_env_runner` (</span><span class="si">{</span><span class="n">num_envs_per_env_runner</span><span class="si">}</span><span class="s2">) must be &quot;</span>
                    <span class="s2">&quot;larger 0!&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">=</span> <span class="n">num_envs_per_env_runner</span>

        <span class="k">if</span> <span class="n">num_cpus_per_env_runner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_env_runner</span> <span class="o">=</span> <span class="n">num_cpus_per_env_runner</span>
        <span class="k">if</span> <span class="n">num_gpus_per_env_runner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_env_runner</span> <span class="o">=</span> <span class="n">num_gpus_per_env_runner</span>
        <span class="k">if</span> <span class="n">custom_resources_per_env_runner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_resources_per_env_runner</span> <span class="o">=</span> <span class="n">custom_resources_per_env_runner</span>

        <span class="k">if</span> <span class="n">sample_timeout_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_timeout_s</span> <span class="o">=</span> <span class="n">sample_timeout_s</span>
        <span class="k">if</span> <span class="n">max_requests_in_flight_per_env_runner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_requests_in_flight_per_env_runner</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">max_requests_in_flight_per_env_runner</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">sample_collector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_collector</span> <span class="o">=</span> <span class="n">sample_collector</span>
        <span class="k">if</span> <span class="n">create_env_on_local_worker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_env_on_local_worker</span> <span class="o">=</span> <span class="n">create_env_on_local_worker</span>
        <span class="k">if</span> <span class="n">enable_connectors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_connectors</span> <span class="o">=</span> <span class="n">enable_connectors</span>
        <span class="k">if</span> <span class="n">env_to_module_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env_to_module_connector</span> <span class="o">=</span> <span class="n">env_to_module_connector</span>
        <span class="k">if</span> <span class="n">module_to_env_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_module_to_env_connector</span> <span class="o">=</span> <span class="n">module_to_env_connector</span>
        <span class="k">if</span> <span class="n">add_default_connectors_to_env_to_module_pipeline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_env_to_module_pipeline</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">add_default_connectors_to_env_to_module_pipeline</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">add_default_connectors_to_module_to_env_pipeline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_module_to_env_pipeline</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">add_default_connectors_to_module_to_env_pipeline</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">episode_lookback_horizon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">episode_lookback_horizon</span> <span class="o">=</span> <span class="n">episode_lookback_horizon</span>
        <span class="k">if</span> <span class="n">use_worker_filter_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_worker_filter_stats</span> <span class="o">=</span> <span class="n">use_worker_filter_stats</span>
        <span class="k">if</span> <span class="n">update_worker_filter_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_worker_filter_stats</span> <span class="o">=</span> <span class="n">update_worker_filter_stats</span>
        <span class="k">if</span> <span class="n">rollout_fragment_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">rollout_fragment_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">rollout_fragment_length</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="ow">or</span> <span class="n">rollout_fragment_length</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rollout_fragment_length` must be int &gt;0 or &#39;auto&#39;!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span> <span class="o">=</span> <span class="n">rollout_fragment_length</span>
        <span class="k">if</span> <span class="n">batch_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">batch_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;truncate_episodes&quot;</span><span class="p">,</span> <span class="s2">&quot;complete_episodes&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;`batch_mode` (</span><span class="si">{</span><span class="n">batch_mode</span><span class="si">}</span><span class="s2">) must be one of [truncate_episodes|&quot;</span>
                    <span class="s2">&quot;complete_episodes]!&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch_mode</span> <span class="o">=</span> <span class="n">batch_mode</span>
        <span class="k">if</span> <span class="n">explore</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">explore</span> <span class="o">=</span> <span class="n">explore</span>
        <span class="k">if</span> <span class="n">exploration_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="c1"># Override entire `exploration_config` if `type` key changes.</span>
            <span class="c1"># Update, if `type` key remains the same or is not specified.</span>
            <span class="n">new_exploration_config</span> <span class="o">=</span> <span class="n">deep_update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">:</span> <span class="n">exploration_config</span><span class="p">},</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="p">[</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">],</span>
                <span class="p">[</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span> <span class="o">=</span> <span class="n">new_exploration_config</span><span class="p">[</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">remote_worker_envs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remote_worker_envs</span> <span class="o">=</span> <span class="n">remote_worker_envs</span>
        <span class="k">if</span> <span class="n">remote_env_batch_wait_ms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remote_env_batch_wait_ms</span> <span class="o">=</span> <span class="n">remote_env_batch_wait_ms</span>
        <span class="k">if</span> <span class="n">validate_env_runners_after_construction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_env_runners_after_construction</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">validate_env_runners_after_construction</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">preprocessor_pref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor_pref</span> <span class="o">=</span> <span class="n">preprocessor_pref</span>
        <span class="k">if</span> <span class="n">observation_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_filter</span> <span class="o">=</span> <span class="n">observation_filter</span>
        <span class="k">if</span> <span class="n">synchronize_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">synchronize_filters</span> <span class="o">=</span> <span class="n">synchronize_filter</span>
        <span class="k">if</span> <span class="n">compress_observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compress_observations</span> <span class="o">=</span> <span class="n">compress_observations</span>
        <span class="k">if</span> <span class="n">enable_tf1_exec_eagerly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_tf1_exec_eagerly</span> <span class="o">=</span> <span class="n">enable_tf1_exec_eagerly</span>
        <span class="k">if</span> <span class="n">sampler_perf_stats_ema_coef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler_perf_stats_ema_coef</span> <span class="o">=</span> <span class="n">sampler_perf_stats_ema_coef</span>

        <span class="c1"># Deprecated settings.</span>
        <span class="k">if</span> <span class="n">synchronize_filter</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(synchronize_filter=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(update_worker_filter_stats=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">ignore_worker_failures</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;ignore_worker_failures is deprecated, and will soon be a no-op&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">recreate_failed_workers</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(recreate_failed_workers=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(recreate_failed_workers=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">restart_failed_sub_environments</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(restart_failed_sub_environments=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;AlgorithmConfig.fault_tolerance(&quot;</span>
                    <span class="s2">&quot;restart_failed_sub_environments=..)&quot;</span>
                <span class="p">),</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">num_consecutive_worker_failures_tolerance</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;AlgorithmConfig.env_runners(&quot;</span>
                    <span class="s2">&quot;num_consecutive_worker_failures_tolerance=..)&quot;</span>
                <span class="p">),</span>
                <span class="n">new</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;AlgorithmConfig.fault_tolerance(&quot;</span>
                    <span class="s2">&quot;num_consecutive_worker_failures_tolerance=..)&quot;</span>
                <span class="p">),</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">worker_health_probe_timeout_s</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(worker_health_probe_timeout_s=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(worker_health_probe_timeout_s=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">worker_restore_timeout_s</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(worker_restore_timeout_s=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(worker_restore_timeout_s=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.learners">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.learners.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.learners">[docs]</a>
    <span class="k">def</span> <span class="nf">learners</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">num_learners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_cpus_per_learner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_gpus_per_learner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">local_gpu_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets LearnerGroup and Learner worker related configurations.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_learners: Number of Learner workers used for updating the RLModule.</span>
<span class="sd">                A value of 0 means training takes place on a local Learner on main</span>
<span class="sd">                process CPUs or 1 GPU (determined by `num_gpus_per_learner`).</span>
<span class="sd">                For multi-gpu training, you have to set `num_learners` to &gt; 1 and set</span>
<span class="sd">                `num_gpus_per_learner` accordingly (e.g., 4 GPUs total and model fits on</span>
<span class="sd">                1 GPU: `num_learners=4; num_gpus_per_learner=1` OR 4 GPUs total and</span>
<span class="sd">                model requires 2 GPUs: `num_learners=2; num_gpus_per_learner=2`).</span>
<span class="sd">            num_cpus_per_learner: Number of CPUs allocated per Learner worker.</span>
<span class="sd">                Only necessary for custom processing pipeline inside each Learner</span>
<span class="sd">                requiring multiple CPU cores. Ignored if `num_learners=0`.</span>
<span class="sd">            num_gpus_per_learner: Number of GPUs allocated per Learner worker. If</span>
<span class="sd">                `num_learners=0`, any value greater than 0 runs the</span>
<span class="sd">                training on a single GPU on the main process, while a value of 0 runs</span>
<span class="sd">                the training on main process CPUs. If `num_gpus_per_learner` is &gt; 0,</span>
<span class="sd">                then you shouldn&#39;t change `num_cpus_per_learner` (from its default</span>
<span class="sd">                value of 1).</span>
<span class="sd">            local_gpu_idx: If `num_gpus_per_learner` &gt; 0, and</span>
<span class="sd">                `num_learners` &lt; 2, then RLlib uses this GPU index for training. This is</span>
<span class="sd">                an index into the available</span>
<span class="sd">                CUDA devices. For example if `os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;1&quot;`</span>
<span class="sd">                and `local_gpu_idx=0`, RLlib uses the GPU with ID=1 on the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_learners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span> <span class="o">=</span> <span class="n">num_learners</span>
        <span class="k">if</span> <span class="n">num_cpus_per_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_learner</span> <span class="o">=</span> <span class="n">num_cpus_per_learner</span>
        <span class="k">if</span> <span class="n">num_gpus_per_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_learner</span> <span class="o">=</span> <span class="n">num_gpus_per_learner</span>
        <span class="k">if</span> <span class="n">local_gpu_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_gpu_idx</span> <span class="o">=</span> <span class="n">local_gpu_idx</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.training">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.training">[docs]</a>
    <span class="k">def</span> <span class="nf">training</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">lr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LearningRateOrSchedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">grad_clip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">grad_clip_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">train_batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">train_batch_size_per_learner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_epochs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">minibatch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">shuffle_batch_per_epoch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">learner_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Learner&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">learner_connector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;RLModule&quot;</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ConnectorV2&quot;</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ConnectorV2&quot;</span><span class="p">]]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">add_default_connectors_to_learner_pipeline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">learner_config_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">num_sgd_iter</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">max_requests_in_flight_per_sampler_worker</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the training related configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            gamma: Float specifying the discount factor of the Markov Decision process.</span>
<span class="sd">            lr: The learning rate (float) or learning rate schedule in the format of</span>
<span class="sd">                [[timestep, lr-value], [timestep, lr-value], ...]</span>
<span class="sd">                In case of a schedule, intermediary timesteps will be assigned to</span>
<span class="sd">                linearly interpolated learning rate values. A schedule config&#39;s first</span>
<span class="sd">                entry must start with timestep 0, i.e.: [[0, initial_value], [...]].</span>
<span class="sd">                Note: If you require a) more than one optimizer (per RLModule),</span>
<span class="sd">                b) optimizer types that are not Adam, c) a learning rate schedule that</span>
<span class="sd">                is not a linearly interpolated, piecewise schedule as described above,</span>
<span class="sd">                or d) specifying c&#39;tor arguments of the optimizer that are not the</span>
<span class="sd">                learning rate (e.g. Adam&#39;s epsilon), then you must override your</span>
<span class="sd">                Learner&#39;s `configure_optimizer_for_module()` method and handle</span>
<span class="sd">                lr-scheduling yourself.</span>
<span class="sd">            grad_clip: If None, no gradient clipping will be applied. Otherwise,</span>
<span class="sd">                depending on the setting of `grad_clip_by`, the (float) value of</span>
<span class="sd">                `grad_clip` will have the following effect:</span>
<span class="sd">                If `grad_clip_by=value`: Will clip all computed gradients individually</span>
<span class="sd">                inside the interval [-`grad_clip`, +`grad_clip`].</span>
<span class="sd">                If `grad_clip_by=norm`, will compute the L2-norm of each weight/bias</span>
<span class="sd">                gradient tensor individually and then clip all gradients such that these</span>
<span class="sd">                L2-norms do not exceed `grad_clip`. The L2-norm of a tensor is computed</span>
<span class="sd">                via: `sqrt(SUM(w0^2, w1^2, ..., wn^2))` where w[i] are the elements of</span>
<span class="sd">                the tensor (no matter what the shape of this tensor is).</span>
<span class="sd">                If `grad_clip_by=global_norm`, will compute the square of the L2-norm of</span>
<span class="sd">                each weight/bias gradient tensor individually, sum up all these squared</span>
<span class="sd">                L2-norms across all given gradient tensors (e.g. the entire module to</span>
<span class="sd">                be updated), square root that overall sum, and then clip all gradients</span>
<span class="sd">                such that this global L2-norm does not exceed the given value.</span>
<span class="sd">                The global L2-norm over a list of tensors (e.g. W and V) is computed</span>
<span class="sd">                via:</span>
<span class="sd">                `sqrt[SUM(w0^2, w1^2, ..., wn^2) + SUM(v0^2, v1^2, ..., vm^2)]`, where</span>
<span class="sd">                w[i] and v[j] are the elements of the tensors W and V (no matter what</span>
<span class="sd">                the shapes of these tensors are).</span>
<span class="sd">            grad_clip_by: See `grad_clip` for the effect of this setting on gradient</span>
<span class="sd">                clipping. Allowed values are `value`, `norm`, and `global_norm`.</span>
<span class="sd">            train_batch_size_per_learner: Train batch size per individual Learner</span>
<span class="sd">                worker. This setting only applies to the new API stack. The number</span>
<span class="sd">                of Learner workers can be set via `config.resources(</span>
<span class="sd">                num_learners=...)`. The total effective batch size is then</span>
<span class="sd">                `num_learners` x `train_batch_size_per_learner` and you can</span>
<span class="sd">                access it with the property `AlgorithmConfig.total_train_batch_size`.</span>
<span class="sd">            train_batch_size: Training batch size, if applicable. When on the new API</span>
<span class="sd">                stack, this setting should no longer be used. Instead, use</span>
<span class="sd">                `train_batch_size_per_learner` (in combination with</span>
<span class="sd">                `num_learners`).</span>
<span class="sd">            num_epochs: The number of complete passes over the entire train batch (per</span>
<span class="sd">                Learner). Each pass might be further split into n minibatches (if</span>
<span class="sd">                `minibatch_size` provided).</span>
<span class="sd">            minibatch_size: The size of minibatches to use to further split the train</span>
<span class="sd">                batch into.</span>
<span class="sd">            shuffle_batch_per_epoch: Whether to shuffle the train batch once per epoch.</span>
<span class="sd">                If the train batch has a time rank (axis=1), shuffling will only take</span>
<span class="sd">                place along the batch axis to not disturb any intact (episode)</span>
<span class="sd">                trajectories.</span>
<span class="sd">            model: Arguments passed into the policy model. See models/catalog.py for a</span>
<span class="sd">                full list of the available model options.</span>
<span class="sd">                TODO: Provide ModelConfig objects instead of dicts.</span>
<span class="sd">            optimizer: Arguments to pass to the policy optimizer. This setting is not</span>
<span class="sd">                used when `enable_rl_module_and_learner=True`.</span>
<span class="sd">            learner_class: The `Learner` class to use for (distributed) updating of the</span>
<span class="sd">                RLModule. Only used when `enable_rl_module_and_learner=True`.</span>
<span class="sd">            learner_connector: A callable taking an env observation space and an env</span>
<span class="sd">                action space as inputs and returning a learner ConnectorV2 (might be</span>
<span class="sd">                a pipeline) object.</span>
<span class="sd">            add_default_connectors_to_learner_pipeline: If True (default), RLlib&#39;s</span>
<span class="sd">                Learners will automatically add the default Learner ConnectorV2</span>
<span class="sd">                pieces to the LearnerPipeline. These automatically perform:</span>
<span class="sd">                a) adding observations from episodes to the train batch, if this has not</span>
<span class="sd">                already been done by a user-provided connector piece</span>
<span class="sd">                b) if RLModule is stateful, add a time rank to the train batch, zero-pad</span>
<span class="sd">                the data, and add the correct state inputs, if this has not already been</span>
<span class="sd">                done by a user-provided connector piece.</span>
<span class="sd">                c) add all other information (actions, rewards, terminateds, etc..) to</span>
<span class="sd">                the train batch, if this has not already been done by a user-provided</span>
<span class="sd">                connector piece.</span>
<span class="sd">                Only if you know exactly what you are doing, you</span>
<span class="sd">                should set this setting to False.</span>
<span class="sd">                Note that this setting is only relevant if the new API stack is used</span>
<span class="sd">                (including the new EnvRunner classes).</span>
<span class="sd">            learner_config_dict: A dict to insert any settings accessible from within</span>
<span class="sd">                the Learner instance. This should only be used in connection with custom</span>
<span class="sd">                Learner subclasses and in case the user doesn&#39;t want to write an extra</span>
<span class="sd">                `AlgorithmConfig` subclass just to add a few settings to the base Algo&#39;s</span>
<span class="sd">                own config class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_sgd_iter</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.training(num_sgd_iter=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.training(num_epochs=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">num_epochs</span> <span class="o">=</span> <span class="n">num_sgd_iter</span>
        <span class="k">if</span> <span class="n">max_requests_in_flight_per_sampler_worker</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.training(&quot;</span>
                <span class="s2">&quot;max_requests_in_flight_per_sampler_worker=...)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(&quot;</span>
                <span class="s2">&quot;max_requests_in_flight_per_env_runner=...)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env_runners</span><span class="p">(</span>
                <span class="n">max_requests_in_flight_per_env_runner</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">max_requests_in_flight_per_sampler_worker</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="k">if</span> <span class="n">lr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
        <span class="k">if</span> <span class="n">grad_clip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grad_clip</span> <span class="o">=</span> <span class="n">grad_clip</span>
        <span class="k">if</span> <span class="n">grad_clip_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grad_clip_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="s2">&quot;global_norm&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;`grad_clip_by` (</span><span class="si">{</span><span class="n">grad_clip_by</span><span class="si">}</span><span class="s2">) must be one of: &#39;value&#39;, &#39;norm&#39;, &quot;</span>
                    <span class="s2">&quot;or &#39;global_norm&#39;!&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grad_clip_by</span> <span class="o">=</span> <span class="n">grad_clip_by</span>
        <span class="k">if</span> <span class="n">train_batch_size_per_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size_per_learner</span> <span class="o">=</span> <span class="n">train_batch_size_per_learner</span>
        <span class="k">if</span> <span class="n">train_batch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="n">train_batch_size</span>
        <span class="k">if</span> <span class="n">num_epochs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_epochs</span> <span class="o">=</span> <span class="n">num_epochs</span>
        <span class="k">if</span> <span class="n">minibatch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minibatch_size</span> <span class="o">=</span> <span class="n">minibatch_size</span>
        <span class="k">if</span> <span class="n">shuffle_batch_per_epoch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_batch_per_epoch</span> <span class="o">=</span> <span class="n">shuffle_batch_per_epoch</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_use_default_native_models&quot;</span><span class="p">,</span> <span class="n">DEPRECATED_VALUE</span><span class="p">)</span>
                <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span>
            <span class="p">):</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.training(_use_default_native_models=True)&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;_use_default_native_models is not supported &quot;</span>
                    <span class="s2">&quot;anymore. To get rid of this error, set `config.api_stack(&quot;</span>
                    <span class="s2">&quot;enable_rl_module_and_learner=True)`. Native models will &quot;</span>
                    <span class="s2">&quot;be better supported by the upcoming RLModule API.&quot;</span><span class="p">,</span>
                    <span class="c1"># Error out if user tries to enable this.</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;_use_default_native_models&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">learner_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_learner_class</span> <span class="o">=</span> <span class="n">learner_class</span>
        <span class="k">if</span> <span class="n">learner_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_learner_connector</span> <span class="o">=</span> <span class="n">learner_connector</span>
        <span class="k">if</span> <span class="n">add_default_connectors_to_learner_pipeline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_default_connectors_to_learner_pipeline</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">add_default_connectors_to_learner_pipeline</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">learner_config_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">learner_config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">learner_config_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.callbacks">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.callbacks">[docs]</a>
    <span class="k">def</span> <span class="nf">callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks_class</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the callbacks configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            callbacks_class: Callbacks class, whose methods will be run during</span>
<span class="sd">                various phases of training and environment sample collection.</span>
<span class="sd">                See the `DefaultCallbacks` class and</span>
<span class="sd">                `examples/metrics/custom_metrics_and_callbacks.py` for more usage</span>
<span class="sd">                information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callbacks_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">callbacks_class</span> <span class="o">=</span> <span class="n">DefaultCallbacks</span>
        <span class="c1"># Check, whether given `callbacks` is a callable.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callbacks_class</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`config.callbacks_class` must be a callable method that &quot;</span>
                <span class="s2">&quot;returns a subclass of DefaultCallbacks, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">callbacks_class</span><span class="si">}</span><span class="s2">!&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks_class</span> <span class="o">=</span> <span class="n">callbacks_class</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.evaluation">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.evaluation">[docs]</a>
    <span class="k">def</span> <span class="nf">evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">evaluation_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_duration_unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_sample_timeout_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_parallel_to_training</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_force_reset_envs_before_iteration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">,</span> <span class="n">PartialAlgorithmConfigDict</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">off_policy_estimation_methods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">ope_split_batch_by_episode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">evaluation_num_env_runners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">custom_evaluation_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">always_attach_evaluation_results</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">evaluation_num_workers</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s evaluation settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            evaluation_interval: Evaluate with every `evaluation_interval` training</span>
<span class="sd">                iterations. The evaluation stats will be reported under the &quot;evaluation&quot;</span>
<span class="sd">                metric key. Set to None (or 0) for no evaluation.</span>
<span class="sd">            evaluation_duration: Duration for which to run evaluation each</span>
<span class="sd">                `evaluation_interval`. The unit for the duration can be set via</span>
<span class="sd">                `evaluation_duration_unit` to either &quot;episodes&quot; (default) or</span>
<span class="sd">                &quot;timesteps&quot;. If using multiple evaluation workers (EnvRunners) in the</span>
<span class="sd">                `evaluation_num_env_runners &gt; 1` setting, the amount of</span>
<span class="sd">                episodes/timesteps to run will be split amongst these.</span>
<span class="sd">                A special value of &quot;auto&quot; can be used in case</span>
<span class="sd">                `evaluation_parallel_to_training=True`. This is the recommended way when</span>
<span class="sd">                trying to save as much time on evaluation as possible. The Algorithm</span>
<span class="sd">                will then run as many timesteps via the evaluation workers as possible,</span>
<span class="sd">                while not taking longer than the parallely running training step and</span>
<span class="sd">                thus, never wasting any idle time on either training- or evaluation</span>
<span class="sd">                workers. When using this setting (`evaluation_duration=&quot;auto&quot;`), it is</span>
<span class="sd">                strongly advised to set `evaluation_interval=1` and</span>
<span class="sd">                `evaluation_force_reset_envs_before_iteration=True` at the same time.</span>
<span class="sd">            evaluation_duration_unit: The unit, with which to count the evaluation</span>
<span class="sd">                duration. Either &quot;episodes&quot; (default) or &quot;timesteps&quot;. Note that this</span>
<span class="sd">                setting is ignored if `evaluation_duration=&quot;auto&quot;`.</span>
<span class="sd">            evaluation_sample_timeout_s: The timeout (in seconds) for evaluation workers</span>
<span class="sd">                to sample a complete episode in the case your config settings are:</span>
<span class="sd">                `evaluation_duration != auto` and `evaluation_duration_unit=episode`.</span>
<span class="sd">                After this time, the user will receive a warning and instructions on how</span>
<span class="sd">                to fix the issue.</span>
<span class="sd">            evaluation_parallel_to_training: Whether to run evaluation in parallel to</span>
<span class="sd">                the `Algorithm.training_step()` call, using threading. Default=False.</span>
<span class="sd">                E.g. for evaluation_interval=1 -&gt; In every call to `Algorithm.train()`,</span>
<span class="sd">                the `Algorithm.training_step()` and `Algorithm.evaluate()` calls will</span>
<span class="sd">                run in parallel. Note that this setting - albeit extremely efficient b/c</span>
<span class="sd">                it wastes no extra time for evaluation - causes the evaluation results</span>
<span class="sd">                to lag one iteration behind the rest of the training results. This is</span>
<span class="sd">                important when picking a good checkpoint. For example, if iteration 42</span>
<span class="sd">                reports a good evaluation `episode_return_mean`, be aware that these</span>
<span class="sd">                results were achieved on the weights trained in iteration 41, so you</span>
<span class="sd">                should probably pick the iteration 41 checkpoint instead.</span>
<span class="sd">            evaluation_force_reset_envs_before_iteration: Whether all environments</span>
<span class="sd">                should be force-reset (even if they are not done yet) right before</span>
<span class="sd">                the evaluation step of the iteration begins. Setting this to True</span>
<span class="sd">                (default) will make sure that the evaluation results will not be</span>
<span class="sd">                polluted with episode statistics that were actually (at least partially)</span>
<span class="sd">                achieved with an earlier set of weights. Note that this setting is only</span>
<span class="sd">                supported on the new API stack w/ EnvRunners and ConnectorV2</span>
<span class="sd">                (`config.enable_rl_module_and_learner=True` AND</span>
<span class="sd">                `config.enable_env_runner_and_connector_v2=True`).</span>
<span class="sd">            evaluation_config: Typical usage is to pass extra args to evaluation env</span>
<span class="sd">                creator and to disable exploration by computing deterministic actions.</span>
<span class="sd">                IMPORTANT NOTE: Policy gradient algorithms are able to find the optimal</span>
<span class="sd">                policy, even if this is a stochastic one. Setting &quot;explore=False&quot; here</span>
<span class="sd">                will result in the evaluation workers not using this optimal policy!</span>
<span class="sd">            off_policy_estimation_methods: Specify how to evaluate the current policy,</span>
<span class="sd">                along with any optional config parameters. This only has an effect when</span>
<span class="sd">                reading offline experiences (&quot;input&quot; is not &quot;sampler&quot;).</span>
<span class="sd">                Available keys:</span>
<span class="sd">                {ope_method_name: {&quot;type&quot;: ope_type, ...}} where `ope_method_name`</span>
<span class="sd">                is a user-defined string to save the OPE results under, and</span>
<span class="sd">                `ope_type` can be any subclass of OffPolicyEstimator, e.g.</span>
<span class="sd">                ray.rllib.offline.estimators.is::ImportanceSampling</span>
<span class="sd">                or your own custom subclass, or the full class path to the subclass.</span>
<span class="sd">                You can also add additional config arguments to be passed to the</span>
<span class="sd">                OffPolicyEstimator in the dict, e.g.</span>
<span class="sd">                {&quot;qreg_dr&quot;: {&quot;type&quot;: DoublyRobust, &quot;q_model_type&quot;: &quot;qreg&quot;, &quot;k&quot;: 5}}</span>
<span class="sd">            ope_split_batch_by_episode: Whether to use SampleBatch.split_by_episode() to</span>
<span class="sd">                split the input batch to episodes before estimating the ope metrics. In</span>
<span class="sd">                case of bandits you should make this False to see improvements in ope</span>
<span class="sd">                evaluation speed. In case of bandits, it is ok to not split by episode,</span>
<span class="sd">                since each record is one timestep already. The default is True.</span>
<span class="sd">            evaluation_num_env_runners: Number of parallel EnvRunners to use for</span>
<span class="sd">                evaluation. Note that this is set to zero by default, which means</span>
<span class="sd">                evaluation will be run in the algorithm process (only if</span>
<span class="sd">                `evaluation_interval` is not 0 or None). If you increase this, it will</span>
<span class="sd">                increase the Ray resource usage of the algorithm since evaluation</span>
<span class="sd">                workers are created separately from those EnvRunners used to sample data</span>
<span class="sd">                for training.</span>
<span class="sd">            custom_evaluation_function: Customize the evaluation method. This must be a</span>
<span class="sd">                function of signature (algo: Algorithm, eval_workers: EnvRunnerGroup) -&gt;</span>
<span class="sd">                (metrics: dict, env_steps: int, agent_steps: int) (metrics: dict if</span>
<span class="sd">                `enable_env_runner_and_connector_v2=True`), where `env_steps` and</span>
<span class="sd">                `agent_steps` define the number of sampled steps during the evaluation</span>
<span class="sd">                iteration. See the Algorithm.evaluate() method to see the default</span>
<span class="sd">                implementation. The Algorithm guarantees all eval workers have the</span>
<span class="sd">                latest policy state before this function is called.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">always_attach_evaluation_results</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.evaluation(always_attach_evaluation_results=..)&quot;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;This setting is no longer needed, b/c Tune does not error &quot;</span>
                <span class="s2">&quot;anymore (only warns) when a metrics key can&#39;t be found in the &quot;</span>
                <span class="s2">&quot;results.&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">evaluation_num_workers</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.evaluation(evaluation_num_workers=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.evaluation(evaluation_num_env_runners=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="o">=</span> <span class="n">evaluation_num_workers</span>

        <span class="k">if</span> <span class="n">evaluation_interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_interval</span> <span class="o">=</span> <span class="n">evaluation_interval</span>
        <span class="k">if</span> <span class="n">evaluation_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span> <span class="o">=</span> <span class="n">evaluation_duration</span>
        <span class="k">if</span> <span class="n">evaluation_duration_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration_unit</span> <span class="o">=</span> <span class="n">evaluation_duration_unit</span>
        <span class="k">if</span> <span class="n">evaluation_sample_timeout_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_sample_timeout_s</span> <span class="o">=</span> <span class="n">evaluation_sample_timeout_s</span>
        <span class="k">if</span> <span class="n">evaluation_parallel_to_training</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_parallel_to_training</span> <span class="o">=</span> <span class="n">evaluation_parallel_to_training</span>
        <span class="k">if</span> <span class="n">evaluation_force_reset_envs_before_iteration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_force_reset_envs_before_iteration</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">evaluation_force_reset_envs_before_iteration</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">evaluation_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="c1"># If user really wants to set this to None, we should allow this here,</span>
            <span class="c1"># instead of creating an empty dict.</span>
            <span class="k">if</span> <span class="n">evaluation_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Update (don&#39;t replace) the existing overrides with the provided ones.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">ray.rllib.algorithms.algorithm</span> <span class="kn">import</span> <span class="n">Algorithm</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="o">=</span> <span class="n">deep_update</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="ow">or</span> <span class="p">{},</span>
                    <span class="n">evaluation_config</span><span class="p">,</span>
                    <span class="kc">True</span><span class="p">,</span>
                    <span class="n">Algorithm</span><span class="o">.</span><span class="n">_allow_unknown_subkeys</span><span class="p">,</span>
                    <span class="n">Algorithm</span><span class="o">.</span><span class="n">_override_all_subkeys_if_type_changes</span><span class="p">,</span>
                    <span class="n">Algorithm</span><span class="o">.</span><span class="n">_override_all_key_list</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">off_policy_estimation_methods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">off_policy_estimation_methods</span> <span class="o">=</span> <span class="n">off_policy_estimation_methods</span>
        <span class="k">if</span> <span class="n">evaluation_num_env_runners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="o">=</span> <span class="n">evaluation_num_env_runners</span>
        <span class="k">if</span> <span class="n">custom_evaluation_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_evaluation_function</span> <span class="o">=</span> <span class="n">custom_evaluation_function</span>
        <span class="k">if</span> <span class="n">ope_split_batch_by_episode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ope_split_batch_by_episode</span> <span class="o">=</span> <span class="n">ope_split_batch_by_episode</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.offline_data">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.offline_data">[docs]</a>
    <span class="k">def</span> <span class="nf">offline_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">input_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">IOContext</span><span class="p">],</span> <span class="n">InputReader</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_read_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_read_method_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_read_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_read_episodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_read_sample_batches</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_filesystem</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_filesystem_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_compress_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">materialize_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">materialize_mapped_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">map_batches_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">iter_batches_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">prelearner_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">prelearner_buffer_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">prelearner_buffer_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">prelearner_module_synch_period</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">dataset_num_iters_per_learner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">input_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">actions_in_input_normalized</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">postprocess_inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">shuffle_buffer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_compress_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_max_file_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_max_rows_per_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_write_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_write_method_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_filesystem</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_filesystem_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">output_write_episodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">offline_sampling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s offline data settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_: Specify how to generate experiences:</span>
<span class="sd">                - &quot;sampler&quot;: Generate experiences via online (env) simulation (default).</span>
<span class="sd">                - A local directory or file glob expression (e.g., &quot;/tmp/*.json&quot;).</span>
<span class="sd">                - A list of individual file paths/URIs (e.g., [&quot;/tmp/1.json&quot;,</span>
<span class="sd">                &quot;s3://bucket/2.json&quot;]).</span>
<span class="sd">                - A dict with string keys and sampling probabilities as values (e.g.,</span>
<span class="sd">                {&quot;sampler&quot;: 0.4, &quot;/tmp/*.json&quot;: 0.4, &quot;s3://bucket/expert.json&quot;: 0.2}).</span>
<span class="sd">                - A callable that takes an `IOContext` object as only arg and returns a</span>
<span class="sd">                `ray.rllib.offline.InputReader`.</span>
<span class="sd">                - A string key that indexes a callable with</span>
<span class="sd">                `tune.registry.register_input`</span>
<span class="sd">            input_read_method: Read method for the `ray.data.Dataset` to read in the</span>
<span class="sd">                offline data from `input_`. The default is `read_parquet` for Parquet</span>
<span class="sd">                files. See https://docs.ray.io/en/latest/data/api/input_output.html for</span>
<span class="sd">                more info about available read methods in `ray.data`.</span>
<span class="sd">            input_read_method_kwargs: Keyword args for `input_read_method`. These</span>
<span class="sd">                will be passed into the read method without checking. If no arguments</span>
<span class="sd">                are passed in the default argument</span>
<span class="sd">                `{&#39;override_num_blocks&#39;: max(num_learners * 2, 2)}` is used. Use these</span>
<span class="sd">                keyword args together with `map_batches_kwargs` and</span>
<span class="sd">                `iter_batches_kwargs` to tune the performance of the data pipeline.</span>
<span class="sd">            input_read_schema: Table schema for converting offline data to episodes.</span>
<span class="sd">                This schema maps the offline data columns to</span>
<span class="sd">                ray.rllib.core.columns.Columns:</span>
<span class="sd">                `{Columns.OBS: &#39;o_t&#39;, Columns.ACTIONS: &#39;a_t&#39;, ...}`. Columns in</span>
<span class="sd">                the data set that are not mapped via this schema are sorted into</span>
<span class="sd">                episodes&#39; `extra_model_outputs`. If no schema is passed in the default</span>
<span class="sd">                schema used is `ray.rllib.offline.offline_data.SCHEMA`. If your data set</span>
<span class="sd">                contains already the names in this schema, no `input_read_schema` is</span>
<span class="sd">                needed.</span>
<span class="sd">            input_read_episodes: Whether offline data is already stored in RLlib&#39;s</span>
<span class="sd">                `EpisodeType` format, i.e. `ray.rllib.env.SingleAgentEpisode` (multi</span>
<span class="sd">                -agent is planned but not supported, yet). Reading episodes directly</span>
<span class="sd">                avoids additional transform steps and is usually faster and</span>
<span class="sd">                therefore the recommended format when your application remains fully</span>
<span class="sd">                inside of RLlib&#39;s schema. The other format is a columnar format and is</span>
<span class="sd">                agnostic to the RL framework used. Use the latter format, if you are</span>
<span class="sd">                unsure when to use the data or in which RL framework. The default is</span>
<span class="sd">                to read column data, i.e. False. `input_read_episodes` and</span>
<span class="sd">                `input_read_sample_batches` cannot be True at the same time. See</span>
<span class="sd">                also `output_write_episodes` to define the output data format when</span>
<span class="sd">                recording.</span>
<span class="sd">            input_read_sample_batches: Whether offline data is stored in RLlib&#39;s old</span>
<span class="sd">                stack `SampleBatch` type. This is usually the case for older data</span>
<span class="sd">                recorded with RLlib in JSON line format. Reading in `SampleBatch`</span>
<span class="sd">                data needs extra transforms and might not concatenate episode chunks</span>
<span class="sd">                contained in different `SampleBatch`es in the data. If possible avoid</span>
<span class="sd">                to read `SampleBatch`es and convert them in a controlled form into</span>
<span class="sd">                RLlib&#39;s `EpisodeType` (i.e. `SingleAgentEpisode` or</span>
<span class="sd">                `MultiAgentEpisode`). The default is False. `input_read_episodes`</span>
<span class="sd">                and `input_read_sample_batches` cannot be True at the same time.</span>
<span class="sd">            input_filesystem: A cloud filesystem to handle access to cloud storage when</span>
<span class="sd">                reading experiences. Should be either &quot;gcs&quot; for Google Cloud Storage,</span>
<span class="sd">                &quot;s3&quot; for AWS S3 buckets, or &quot;abs&quot; for Azure Blob Storage.</span>
<span class="sd">            input_filesystem_kwargs: A dictionary holding the kwargs for the filesystem</span>
<span class="sd">                given by `input_filesystem`. See `gcsfs.GCSFilesystem` for GCS,</span>
<span class="sd">                `pyarrow.fs.S3FileSystem`, for S3, and `ablfs.AzureBlobFilesystem` for</span>
<span class="sd">                ABS filesystem arguments.</span>
<span class="sd">            input_compress_columns: What input columns are compressed with LZ4 in the</span>
<span class="sd">                input data. If data is stored in RLlib&#39;s `SingleAgentEpisode` (</span>
<span class="sd">                `MultiAgentEpisode` not supported, yet). Note,</span>
<span class="sd">                `rllib.core.columns.Columns.OBS` will also try to decompress</span>
<span class="sd">                `rllib.core.columns.Columns.NEXT_OBS`.</span>
<span class="sd">            materialize_data: Whether the raw data should be materialized in memory.</span>
<span class="sd">                This boosts performance, but requires enough memory to avoid an OOM, so</span>
<span class="sd">                make sure that your cluster has the resources available. For very large</span>
<span class="sd">                data you might want to switch to streaming mode by setting this to</span>
<span class="sd">                `False` (default). If your algorithm does not need the RLModule in the</span>
<span class="sd">                Learner connector pipeline or all (learner) connectors are stateless</span>
<span class="sd">                you should consider setting `materialize_mapped_data` to `True`</span>
<span class="sd">                instead (and set `materialize_data` to `False`). If your data does not</span>
<span class="sd">                fit into memory and your Learner connector pipeline requires an RLModule</span>
<span class="sd">                or is stateful, set both `materialize_data` and</span>
<span class="sd">                `materialize_mapped_data` to `False`.</span>
<span class="sd">            materialize_mapped_data: Whether the data should be materialized after</span>
<span class="sd">                running it through the Learner connector pipeline (i.e. after running</span>
<span class="sd">                the `OfflinePreLearner`). This improves performance, but should only be</span>
<span class="sd">                used in case the (learner) connector pipeline does not require an</span>
<span class="sd">                RLModule and the (learner) connector pipeline is stateless. For example,</span>
<span class="sd">                MARWIL&#39;s Learner connector pipeline requires the RLModule for value</span>
<span class="sd">                function predictions and training batches would become stale after some</span>
<span class="sd">                iterations causing learning degradation or divergence. Also ensure that</span>
<span class="sd">                your cluster has enough memory available to avoid an OOM. If set to</span>
<span class="sd">                `True` (True), make sure that `materialize_data` is set to `False` to</span>
<span class="sd">                avoid materialization of two datasets. If your data does not fit into</span>
<span class="sd">                memory and your Learner connector pipeline requires an RLModule or is</span>
<span class="sd">                stateful, set both `materialize_data` and `materialize_mapped_data` to</span>
<span class="sd">                `False`.</span>
<span class="sd">            map_batches_kwargs: Keyword args for the `map_batches` method. These will be</span>
<span class="sd">                passed into the `ray.data.Dataset.map_batches` method when sampling</span>
<span class="sd">                without checking. If no arguments passed in the default arguments</span>
<span class="sd">                `{&#39;concurrency&#39;: max(2, num_learners), &#39;zero_copy_batch&#39;: True}` is</span>
<span class="sd">                used. Use these keyword args together with `input_read_method_kwargs`</span>
<span class="sd">                and `iter_batches_kwargs` to tune the performance of the data pipeline.</span>
<span class="sd">            iter_batches_kwargs: Keyword args for the `iter_batches` method. These will</span>
<span class="sd">                be passed into the `ray.data.Dataset.iter_batches` method when sampling</span>
<span class="sd">                without checking. If no arguments are passed in, the default argument</span>
<span class="sd">                `{&#39;prefetch_batches&#39;: 2, &#39;local_buffer_shuffle_size&#39;:</span>
<span class="sd">                train_batch_size_per_learner x 4}` is used. Use these keyword args</span>
<span class="sd">                together with `input_read_method_kwargs` and `map_batches_kwargs` to</span>
<span class="sd">                tune the performance of the data pipeline.</span>
<span class="sd">            prelearner_class: An optional `OfflinePreLearner` class that is used to</span>
<span class="sd">                transform data batches in `ray.data.map_batches` used in the</span>
<span class="sd">                `OfflineData` class to transform data from columns to batches that can</span>
<span class="sd">                be used in the `Learner.update...()` methods. Override the</span>
<span class="sd">                `OfflinePreLearner` class and pass your derived class in here, if you</span>
<span class="sd">                need to make some further transformations specific for your data or</span>
<span class="sd">                loss. The default is None which uses the base `OfflinePreLearner`</span>
<span class="sd">                defined in `ray.rllib.offline.offline_prelearner`.</span>
<span class="sd">            prelearner_module_synch_period: The period (number of batches converted)</span>
<span class="sd">                after which the `RLModule` held by the `PreLearner` should sync weights.</span>
<span class="sd">                The `PreLearner` is used to preprocess batches for the learners. The</span>
<span class="sd">                higher this value the more off-policy the `PreLearner`&#39;s module will be.</span>
<span class="sd">                Values too small will force the `PreLearner` to sync more frequently</span>
<span class="sd">                and thus might slow down the data pipeline. The default value chosen</span>
<span class="sd">                by the `OfflinePreLearner` is 10.</span>
<span class="sd">            dataset_num_iters_per_learner: Number of updates to run in each learner</span>
<span class="sd">                during a single training iteration. If None, each learner runs a</span>
<span class="sd">                complete epoch over its data block (the dataset is partitioned into</span>
<span class="sd">                at least as many blocks as there are learners). The default is `None`.</span>
<span class="sd">            input_config: Arguments that describe the settings for reading the input.</span>
<span class="sd">                If input is &quot;sample&quot;, this will be environment configuration, e.g.</span>
<span class="sd">                `env_name` and `env_config`, etc. See `EnvContext` for more info.</span>
<span class="sd">                If the input is &quot;dataset&quot;, this will be e.g. `format`, `path`.</span>
<span class="sd">            actions_in_input_normalized: True, if the actions in a given offline &quot;input&quot;</span>
<span class="sd">                are already normalized (between -1.0 and 1.0). This is usually the case</span>
<span class="sd">                when the offline file has been generated by another RLlib algorithm</span>
<span class="sd">                (e.g. PPO or SAC), while &quot;normalize_actions&quot; was set to True.</span>
<span class="sd">            postprocess_inputs: Whether to run postprocess_trajectory() on the</span>
<span class="sd">                trajectory fragments from offline inputs. Note that postprocessing will</span>
<span class="sd">                be done using the *current* policy, not the *behavior* policy, which</span>
<span class="sd">                is typically undesirable for on-policy algorithms.</span>
<span class="sd">            shuffle_buffer_size: If positive, input batches will be shuffled via a</span>
<span class="sd">                sliding window buffer of this number of batches. Use this if the input</span>
<span class="sd">                data is not in random enough order. Input is delayed until the shuffle</span>
<span class="sd">                buffer is filled.</span>
<span class="sd">            output: Specify where experiences should be saved:</span>
<span class="sd">                 - None: don&#39;t save any experiences</span>
<span class="sd">                 - &quot;logdir&quot; to save to the agent log dir</span>
<span class="sd">                 - a path/URI to save to a custom output directory (e.g., &quot;s3://bckt/&quot;)</span>
<span class="sd">                 - a function that returns a rllib.offline.OutputWriter</span>
<span class="sd">            output_config: Arguments accessible from the IOContext for configuring</span>
<span class="sd">                custom output.</span>
<span class="sd">            output_compress_columns: What sample batch columns to LZ4 compress in the</span>
<span class="sd">                output data. Note, `rllib.core.columns.Columns.OBS` will also compress</span>
<span class="sd">                `rllib.core.columns.Columns.NEXT_OBS`.</span>
<span class="sd">            output_max_file_size: Max output file size (in bytes) before rolling over</span>
<span class="sd">                to a new file.</span>
<span class="sd">            output_max_rows_per_file: Max output row numbers before rolling over to a</span>
<span class="sd">                new file.</span>
<span class="sd">            output_write_method: Write method for the `ray.data.Dataset` to write the</span>
<span class="sd">                offline data to `output`. The default is `read_parquet` for Parquet</span>
<span class="sd">                files. See https://docs.ray.io/en/latest/data/api/input_output.html for</span>
<span class="sd">                more info about available read methods in `ray.data`.</span>
<span class="sd">            output_write_method_kwargs: `kwargs` for the `output_write_method`. These</span>
<span class="sd">                will be passed into the write method without checking.</span>
<span class="sd">            output_filesystem: A cloud filesystem to handle access to cloud storage when</span>
<span class="sd">                writing experiences. Should be either &quot;gcs&quot; for Google Cloud Storage,</span>
<span class="sd">                &quot;s3&quot; for AWS S3 buckets, or &quot;abs&quot; for Azure Blob Storage.</span>
<span class="sd">            output_filesystem_kwargs: A dictionary holding the kwargs for the filesystem</span>
<span class="sd">                given by `output_filesystem`. See `gcsfs.GCSFilesystem` for GCS,</span>
<span class="sd">                `pyarrow.fs.S3FileSystem`, for S3, and `ablfs.AzureBlobFilesystem` for</span>
<span class="sd">                ABS filesystem arguments.</span>
<span class="sd">            offline_sampling: Whether sampling for the Algorithm happens via</span>
<span class="sd">                reading from offline data. If True, EnvRunners will NOT limit the</span>
<span class="sd">                number of collected batches within the same `sample()` call based on</span>
<span class="sd">                the number of sub-environments within the worker (no sub-environments</span>
<span class="sd">                present).</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">input_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_</span> <span class="o">=</span> <span class="n">input_</span>
        <span class="k">if</span> <span class="n">input_read_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_read_method</span> <span class="o">=</span> <span class="n">input_read_method</span>
        <span class="k">if</span> <span class="n">input_read_method_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_read_method_kwargs</span> <span class="o">=</span> <span class="n">input_read_method_kwargs</span>
        <span class="k">if</span> <span class="n">input_read_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_read_schema</span> <span class="o">=</span> <span class="n">input_read_schema</span>
        <span class="k">if</span> <span class="n">input_read_episodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_read_episodes</span> <span class="o">=</span> <span class="n">input_read_episodes</span>
        <span class="k">if</span> <span class="n">input_read_sample_batches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_read_sample_batches</span> <span class="o">=</span> <span class="n">input_read_sample_batches</span>
        <span class="k">if</span> <span class="n">input_filesystem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_filesystem</span> <span class="o">=</span> <span class="n">input_filesystem</span>
        <span class="k">if</span> <span class="n">input_filesystem_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_filesystem_kwargs</span> <span class="o">=</span> <span class="n">input_filesystem_kwargs</span>
        <span class="k">if</span> <span class="n">input_compress_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_compress_columns</span> <span class="o">=</span> <span class="n">input_compress_columns</span>
        <span class="k">if</span> <span class="n">materialize_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materialize_data</span> <span class="o">=</span> <span class="n">materialize_data</span>
        <span class="k">if</span> <span class="n">materialize_mapped_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materialize_mapped_data</span> <span class="o">=</span> <span class="n">materialize_mapped_data</span>
        <span class="k">if</span> <span class="n">map_batches_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_batches_kwargs</span> <span class="o">=</span> <span class="n">map_batches_kwargs</span>
        <span class="k">if</span> <span class="n">iter_batches_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_batches_kwargs</span> <span class="o">=</span> <span class="n">iter_batches_kwargs</span>
        <span class="k">if</span> <span class="n">prelearner_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_class</span> <span class="o">=</span> <span class="n">prelearner_class</span>
        <span class="k">if</span> <span class="n">prelearner_buffer_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_buffer_class</span> <span class="o">=</span> <span class="n">prelearner_buffer_class</span>
        <span class="k">if</span> <span class="n">prelearner_buffer_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_buffer_kwargs</span> <span class="o">=</span> <span class="n">prelearner_buffer_kwargs</span>
        <span class="k">if</span> <span class="n">prelearner_module_synch_period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_module_synch_period</span> <span class="o">=</span> <span class="n">prelearner_module_synch_period</span>
        <span class="k">if</span> <span class="n">dataset_num_iters_per_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_num_iters_per_learner</span> <span class="o">=</span> <span class="n">dataset_num_iters_per_learner</span>
        <span class="k">if</span> <span class="n">input_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;input_config must be a dict, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">input_config</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># TODO (Kourosh) Once we use a complete separation between rollout worker</span>
            <span class="c1">#  and input dataset reader we can remove this.</span>
            <span class="c1">#  For now Error out if user attempts to set these parameters.</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> should not be set in the input_config. RLlib will use </span><span class="si">{}</span><span class="s2"> instead.&quot;</span>
            <span class="k">if</span> <span class="n">input_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_cpus_per_read_task&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;num_cpus_per_read_task&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;config.env_runners(num_cpus_per_env_runner=..)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">input_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_evaluation</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s2">&quot;parallelism&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;config.evaluation(evaluation_num_env_runners=..)&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="s2">&quot;config.env_runners(num_env_runners=..)&quot;</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span> <span class="o">=</span> <span class="n">input_config</span>
        <span class="k">if</span> <span class="n">actions_in_input_normalized</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actions_in_input_normalized</span> <span class="o">=</span> <span class="n">actions_in_input_normalized</span>
        <span class="k">if</span> <span class="n">postprocess_inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_inputs</span> <span class="o">=</span> <span class="n">postprocess_inputs</span>
        <span class="k">if</span> <span class="n">shuffle_buffer_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_buffer_size</span> <span class="o">=</span> <span class="n">shuffle_buffer_size</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">if</span> <span class="n">output_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span> <span class="o">=</span> <span class="n">output_config</span>
        <span class="k">if</span> <span class="n">output_compress_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_compress_columns</span> <span class="o">=</span> <span class="n">output_compress_columns</span>
        <span class="k">if</span> <span class="n">output_max_file_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_max_file_size</span> <span class="o">=</span> <span class="n">output_max_file_size</span>
        <span class="k">if</span> <span class="n">output_max_rows_per_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_max_rows_per_file</span> <span class="o">=</span> <span class="n">output_max_rows_per_file</span>
        <span class="k">if</span> <span class="n">output_write_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_write_method</span> <span class="o">=</span> <span class="n">output_write_method</span>
        <span class="k">if</span> <span class="n">output_write_method_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_write_method_kwargs</span> <span class="o">=</span> <span class="n">output_write_method_kwargs</span>
        <span class="k">if</span> <span class="n">output_filesystem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_filesystem</span> <span class="o">=</span> <span class="n">output_filesystem</span>
        <span class="k">if</span> <span class="n">output_filesystem_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_filesystem_kwargs</span> <span class="o">=</span> <span class="n">output_filesystem_kwargs</span>
        <span class="k">if</span> <span class="n">output_write_episodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_write_episodes</span> <span class="o">=</span> <span class="n">output_write_episodes</span>
        <span class="k">if</span> <span class="n">offline_sampling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offline_sampling</span> <span class="o">=</span> <span class="n">offline_sampling</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.multi_agent">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.multi_agent">[docs]</a>
    <span class="k">def</span> <span class="nf">multi_agent</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">policies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">MultiAgentPolicyConfigDict</span><span class="p">,</span> <span class="n">Collection</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">policy_map_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">policy_mapping_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">AgentID</span><span class="p">,</span> <span class="s2">&quot;OldEpisode&quot;</span><span class="p">],</span> <span class="n">PolicyID</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">policies_to_train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">SampleBatchType</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">policy_states_are_swappable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">observation_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">count_steps_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args:</span>
        <span class="n">algorithm_config_overrides_per_module</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">replay_mode</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="c1"># Now done via Ray object store, which has its own cloud-supported</span>
        <span class="c1"># spillover mechanism.</span>
        <span class="n">policy_map_cache</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s multi-agent settings.</span>

<span class="sd">        Validates the new multi-agent settings and translates everything into</span>
<span class="sd">        a unified multi-agent setup format. For example a `policies` list or set</span>
<span class="sd">        of IDs is properly converted into a dict mapping these IDs to PolicySpecs.</span>

<span class="sd">        Args:</span>
<span class="sd">            policies: Map of type MultiAgentPolicyConfigDict from policy ids to either</span>
<span class="sd">                4-tuples of (policy_cls, obs_space, act_space, config) or PolicySpecs.</span>
<span class="sd">                These tuples or PolicySpecs define the class of the policy, the</span>
<span class="sd">                observation- and action spaces of the policies, and any extra config.</span>
<span class="sd">            policy_map_capacity: Keep this many policies in the &quot;policy_map&quot; (before</span>
<span class="sd">                writing least-recently used ones to disk/S3).</span>
<span class="sd">            policy_mapping_fn: Function mapping agent ids to policy ids. The signature</span>
<span class="sd">                is: `(agent_id, episode, worker, **kwargs) -&gt; PolicyID`.</span>
<span class="sd">            policies_to_train: Determines those policies that should be updated.</span>
<span class="sd">                Options are:</span>
<span class="sd">                - None, for training all policies.</span>
<span class="sd">                - An iterable of PolicyIDs that should be trained.</span>
<span class="sd">                - A callable, taking a PolicyID and a SampleBatch or MultiAgentBatch</span>
<span class="sd">                and returning a bool (indicating whether the given policy is trainable</span>
<span class="sd">                or not, given the particular batch). This allows you to have a policy</span>
<span class="sd">                trained only on certain data (e.g. when playing against a certain</span>
<span class="sd">                opponent).</span>
<span class="sd">            policy_states_are_swappable: Whether all Policy objects in this map can be</span>
<span class="sd">                &quot;swapped out&quot; via a simple `state = A.get_state(); B.set_state(state)`,</span>
<span class="sd">                where `A` and `B` are policy instances in this map. You should set</span>
<span class="sd">                this to True for significantly speeding up the PolicyMap&#39;s cache lookup</span>
<span class="sd">                times, iff your policies all share the same neural network</span>
<span class="sd">                architecture and optimizer types. If True, the PolicyMap will not</span>
<span class="sd">                have to garbage collect old, least recently used policies, but instead</span>
<span class="sd">                keep them in memory and simply override their state with the state of</span>
<span class="sd">                the most recently accessed one.</span>
<span class="sd">                For example, in a league-based training setup, you might have 100s of</span>
<span class="sd">                the same policies in your map (playing against each other in various</span>
<span class="sd">                combinations), but all of them share the same state structure</span>
<span class="sd">                (are &quot;swappable&quot;).</span>
<span class="sd">            observation_fn: Optional function that can be used to enhance the local</span>
<span class="sd">                agent observations to include more state. See</span>
<span class="sd">                rllib/evaluation/observation_function.py for more info.</span>
<span class="sd">            count_steps_by: Which metric to use as the &quot;batch size&quot; when building a</span>
<span class="sd">                MultiAgentBatch. The two supported values are:</span>
<span class="sd">                &quot;env_steps&quot;: Count each time the env is &quot;stepped&quot; (no matter how many</span>
<span class="sd">                multi-agent actions are passed/how many multi-agent observations</span>
<span class="sd">                have been returned in the previous step).</span>
<span class="sd">                &quot;agent_steps&quot;: Count each individual agent step as one step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">policies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="c1"># Make sure our Policy IDs are ok (this should work whether `policies`</span>
            <span class="c1"># is a dict or just any Sequence).</span>
            <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">policies</span><span class="p">:</span>
                <span class="n">validate_module_id</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Collection: Convert to dict.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">policies</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">PolicySpec</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">policies</span><span class="p">}</span>
            <span class="c1"># Validate each policy spec in a given dict.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">policies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># If not a PolicySpec object, values must be lists/tuples of len 4.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">PolicySpec</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;Policy specs must be tuples/lists of &quot;</span>
                                <span class="s2">&quot;(cls or None, obs_space, action_space, config), &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2"> for PolicyID=</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                    <span class="c1"># TODO: Switch from dict to AlgorithmConfigOverride, once available.</span>
                    <span class="c1"># Config not a dict.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="p">(</span><span class="n">AlgorithmConfig</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
                        <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Multi-agent policy config for </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2"> must be a dict or &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;AlgorithmConfig object, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="si">}</span><span class="s2">!&quot;</span>
                        <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">policies</span> <span class="o">=</span> <span class="n">policies</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`policies` must be dict mapping PolicyID to PolicySpec OR a &quot;</span>
                    <span class="s2">&quot;set/tuple/list of PolicyIDs!&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">algorithm_config_overrides_per_module</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span><span class="n">old</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rl_module</span><span class="p">(</span>
                <span class="n">algorithm_config_overrides_per_module</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">algorithm_config_overrides_per_module</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">policy_map_capacity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">policy_map_capacity</span> <span class="o">=</span> <span class="n">policy_map_capacity</span>

        <span class="k">if</span> <span class="n">policy_mapping_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="c1"># Create `policy_mapping_fn` from a config dict.</span>
            <span class="c1"># Helpful if users would like to specify custom callable classes in</span>
            <span class="c1"># yaml files.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policy_mapping_fn</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">policy_mapping_fn</span> <span class="o">=</span> <span class="n">from_config</span><span class="p">(</span><span class="n">policy_mapping_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">policy_mapping_fn</span> <span class="o">=</span> <span class="n">policy_mapping_fn</span>

        <span class="k">if</span> <span class="n">observation_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_fn</span> <span class="o">=</span> <span class="n">observation_fn</span>

        <span class="k">if</span> <span class="n">policy_map_cache</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.multi_agent(policy_map_cache=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">replay_mode</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.multi_agent(replay_mode=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.training(&quot;</span>
                <span class="s2">&quot;replay_buffer_config={&#39;replay_mode&#39;: ..})&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">count_steps_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count_steps_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;env_steps&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_steps&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;config.multi_agent(count_steps_by=..) must be one of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;[env_steps|agent_steps], not </span><span class="si">{</span><span class="n">count_steps_by</span><span class="si">}</span><span class="s2">!&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count_steps_by</span> <span class="o">=</span> <span class="n">count_steps_by</span>

        <span class="k">if</span> <span class="n">policies_to_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies_to_train</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
                <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">policies_to_train</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">policies_to_train</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;ERROR: `policies_to_train` must be a [list|set|tuple] or a &quot;</span>
                <span class="s2">&quot;callable taking PolicyID and SampleBatch and returning &quot;</span>
                <span class="s2">&quot;True|False (trainable or not?) or None (for always training all &quot;</span>
                <span class="s2">&quot;policies).&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Check `policies_to_train` for invalid entries.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies_to_train</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">policies_to_train</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;`config.multi_agent(policies_to_train=..)` is empty! &quot;</span>
                        <span class="s2">&quot;Make sure - if you would like to learn at least one policy - &quot;</span>
                        <span class="s2">&quot;to add its ID to that list.&quot;</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span> <span class="o">=</span> <span class="n">policies_to_train</span>

        <span class="k">if</span> <span class="n">policy_states_are_swappable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">policy_states_are_swappable</span> <span class="o">=</span> <span class="n">policy_states_are_swappable</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.is_multi_agent">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.is_multi_agent.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.is_multi_agent">[docs]</a>
    <span class="k">def</span> <span class="nf">is_multi_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns whether this config specifies a multi-agent setup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True, if a) &gt;1 policies defined OR b) 1 policy defined, but its ID is NOT</span>
<span class="sd">            DEFAULT_POLICY_ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">DEFAULT_POLICY_ID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span></div>


<div class="viewcode-block" id="AlgorithmConfig.reporting">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.reporting">[docs]</a>
    <span class="k">def</span> <span class="nf">reporting</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keep_per_episode_custom_metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">metrics_episode_collection_timeout_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">metrics_num_episodes_for_smoothing</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">min_time_s_per_iteration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">min_train_timesteps_per_iteration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">min_sample_timesteps_per_iteration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">log_gradients</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s reporting settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            keep_per_episode_custom_metrics: Store raw custom metrics without</span>
<span class="sd">                calculating max, min, mean</span>
<span class="sd">            metrics_episode_collection_timeout_s: Wait for metric batches for at most</span>
<span class="sd">                this many seconds. Those that have not returned in time will be</span>
<span class="sd">                collected in the next train iteration.</span>
<span class="sd">            metrics_num_episodes_for_smoothing: Smooth rollout metrics over this many</span>
<span class="sd">                episodes, if possible.</span>
<span class="sd">                In case rollouts (sample collection) just started, there may be fewer</span>
<span class="sd">                than this many episodes in the buffer and we&#39;ll compute metrics</span>
<span class="sd">                over this smaller number of available episodes.</span>
<span class="sd">                In case there are more than this many episodes collected in a single</span>
<span class="sd">                training iteration, use all of these episodes for metrics computation,</span>
<span class="sd">                meaning don&#39;t ever cut any &quot;excess&quot; episodes.</span>
<span class="sd">                Set this to 1 to disable smoothing and to always report only the most</span>
<span class="sd">                recently collected episode&#39;s return.</span>
<span class="sd">            min_time_s_per_iteration: Minimum time (in sec) to accumulate within a</span>
<span class="sd">                single `Algorithm.train()` call. This value does not affect learning,</span>
<span class="sd">                only the number of times `Algorithm.training_step()` is called by</span>
<span class="sd">                `Algorithm.train()`. If - after one such step attempt, the time taken</span>
<span class="sd">                has not reached `min_time_s_per_iteration`, will perform n more</span>
<span class="sd">                `Algorithm.training_step()` calls until the minimum time has been</span>
<span class="sd">                consumed. Set to 0 or None for no minimum time.</span>
<span class="sd">            min_train_timesteps_per_iteration: Minimum training timesteps to accumulate</span>
<span class="sd">                within a single `train()` call. This value does not affect learning,</span>
<span class="sd">                only the number of times `Algorithm.training_step()` is called by</span>
<span class="sd">                `Algorithm.train()`. If - after one such step attempt, the training</span>
<span class="sd">                timestep count has not been reached, will perform n more</span>
<span class="sd">                `training_step()` calls until the minimum timesteps have been</span>
<span class="sd">                executed. Set to 0 or None for no minimum timesteps.</span>
<span class="sd">            min_sample_timesteps_per_iteration: Minimum env sampling timesteps to</span>
<span class="sd">                accumulate within a single `train()` call. This value does not affect</span>
<span class="sd">                learning, only the number of times `Algorithm.training_step()` is</span>
<span class="sd">                called by `Algorithm.train()`. If - after one such step attempt, the env</span>
<span class="sd">                sampling timestep count has not been reached, will perform n more</span>
<span class="sd">                `training_step()` calls until the minimum timesteps have been</span>
<span class="sd">                executed. Set to 0 or None for no minimum timesteps.</span>
<span class="sd">            log_gradients: Log gradients to results. If this is `True` the global norm</span>
<span class="sd">                of the gradients dictionariy for each optimizer is logged to results.</span>
<span class="sd">                The default is `True`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">keep_per_episode_custom_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keep_per_episode_custom_metrics</span> <span class="o">=</span> <span class="n">keep_per_episode_custom_metrics</span>
        <span class="k">if</span> <span class="n">metrics_episode_collection_timeout_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics_episode_collection_timeout_s</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">metrics_episode_collection_timeout_s</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">metrics_num_episodes_for_smoothing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics_num_episodes_for_smoothing</span> <span class="o">=</span> <span class="n">metrics_num_episodes_for_smoothing</span>
        <span class="k">if</span> <span class="n">min_time_s_per_iteration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_time_s_per_iteration</span> <span class="o">=</span> <span class="n">min_time_s_per_iteration</span>
        <span class="k">if</span> <span class="n">min_train_timesteps_per_iteration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_train_timesteps_per_iteration</span> <span class="o">=</span> <span class="n">min_train_timesteps_per_iteration</span>
        <span class="k">if</span> <span class="n">min_sample_timesteps_per_iteration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_sample_timesteps_per_iteration</span> <span class="o">=</span> <span class="n">min_sample_timesteps_per_iteration</span>
        <span class="k">if</span> <span class="n">log_gradients</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_gradients</span> <span class="o">=</span> <span class="n">log_gradients</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.checkpointing">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.checkpointing">[docs]</a>
    <span class="k">def</span> <span class="nf">checkpointing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">export_native_model_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">checkpoint_trainable_policies_only</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s checkpointing settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            export_native_model_files: Whether an individual Policy-</span>
<span class="sd">                or the Algorithm&#39;s checkpoints also contain (tf or torch) native</span>
<span class="sd">                model files. These could be used to restore just the NN models</span>
<span class="sd">                from these files w/o requiring RLlib. These files are generated</span>
<span class="sd">                by calling the tf- or torch- built-in saving utility methods on</span>
<span class="sd">                the actual models.</span>
<span class="sd">            checkpoint_trainable_policies_only: Whether to only add Policies to the</span>
<span class="sd">                Algorithm checkpoint (in sub-directory &quot;policies/&quot;) that are trainable</span>
<span class="sd">                according to the `is_trainable_policy` callable of the local worker.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">export_native_model_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_native_model_files</span> <span class="o">=</span> <span class="n">export_native_model_files</span>
        <span class="k">if</span> <span class="n">checkpoint_trainable_policies_only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_trainable_policies_only</span> <span class="o">=</span> <span class="n">checkpoint_trainable_policies_only</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.debugging">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.debugging">[docs]</a>
    <span class="k">def</span> <span class="nf">debugging</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger_creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">Logger</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">logger_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">log_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">log_sys_usage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">fake_sampler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_run_training_always_in_thread</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_evaluation_parallel_to_training_wo_thread</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s debugging settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            logger_creator: Callable that creates a ray.tune.Logger</span>
<span class="sd">                object. If unspecified, a default logger is created.</span>
<span class="sd">            logger_config: Define logger-specific configuration to be used inside Logger</span>
<span class="sd">                Default value None allows overwriting with nested dicts.</span>
<span class="sd">            log_level: Set the ray.rllib.* log level for the agent process and its</span>
<span class="sd">                workers. Should be one of DEBUG, INFO, WARN, or ERROR. The DEBUG level</span>
<span class="sd">                will also periodically print out summaries of relevant internal dataflow</span>
<span class="sd">                (this is also printed out once at startup at the INFO level).</span>
<span class="sd">            log_sys_usage: Log system resource metrics to results. This requires</span>
<span class="sd">                `psutil` to be installed for sys stats, and `gputil` for GPU metrics.</span>
<span class="sd">            fake_sampler: Use fake (infinite speed) sampler. For testing only.</span>
<span class="sd">            seed: This argument, in conjunction with worker_index, sets the random</span>
<span class="sd">                seed of each worker, so that identically configured trials will have</span>
<span class="sd">                identical results. This makes experiments reproducible.</span>
<span class="sd">            _run_training_always_in_thread: Runs the n `training_step()` calls per</span>
<span class="sd">                iteration always in a separate thread (just as we would do with</span>
<span class="sd">                `evaluation_parallel_to_training=True`, but even without evaluation</span>
<span class="sd">                going on and even without evaluation workers being created in the</span>
<span class="sd">                Algorithm).</span>
<span class="sd">            _evaluation_parallel_to_training_wo_thread: Only relevant if</span>
<span class="sd">                `evaluation_parallel_to_training` is True. Then, in order to achieve</span>
<span class="sd">                parallelism, RLlib will not use a thread pool (as it usually does in</span>
<span class="sd">                this situation).</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">logger_creator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger_creator</span> <span class="o">=</span> <span class="n">logger_creator</span>
        <span class="k">if</span> <span class="n">logger_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger_config</span> <span class="o">=</span> <span class="n">logger_config</span>
        <span class="k">if</span> <span class="n">log_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">log_level</span>
        <span class="k">if</span> <span class="n">log_sys_usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_sys_usage</span> <span class="o">=</span> <span class="n">log_sys_usage</span>
        <span class="k">if</span> <span class="n">fake_sampler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fake_sampler</span> <span class="o">=</span> <span class="n">fake_sampler</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="k">if</span> <span class="n">_run_training_always_in_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_training_always_in_thread</span> <span class="o">=</span> <span class="n">_run_training_always_in_thread</span>
        <span class="k">if</span> <span class="n">_evaluation_parallel_to_training_wo_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluation_parallel_to_training_wo_thread</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">_evaluation_parallel_to_training_wo_thread</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.fault_tolerance">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.fault_tolerance.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.fault_tolerance">[docs]</a>
    <span class="k">def</span> <span class="nf">fault_tolerance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ignore_env_runner_failures</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">recreate_failed_env_runners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">max_num_env_runner_restarts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">delay_between_env_runner_restarts_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">restart_failed_sub_environments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">num_consecutive_env_runner_failures_tolerance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">env_runner_health_probe_timeout_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">env_runner_restore_timeout_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">ignore_worker_failures</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">recreate_failed_workers</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">max_num_worker_restarts</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">delay_between_worker_restarts_s</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">num_consecutive_worker_failures_tolerance</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">worker_health_probe_timeout_s</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
        <span class="n">worker_restore_timeout_s</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s fault tolerance settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_env_runner_failures: Whether to ignore any EnvRunner failures</span>
<span class="sd">                and continue running with the remaining EnvRunners. This setting will</span>
<span class="sd">                be ignored, if `recreate_failed_env_runners=True`.</span>
<span class="sd">            recreate_failed_env_runners: Whether - upon an EnvRunner failure - RLlib</span>
<span class="sd">                will try to recreate the lost EnvRunner as an identical copy of the</span>
<span class="sd">                failed one. The new EnvRunner will only differ from the failed one in</span>
<span class="sd">                its `self.recreated_worker=True` property value. It will have the same</span>
<span class="sd">                `worker_index` as the original one. If True, the</span>
<span class="sd">                `ignore_env_runner_failures` setting will be ignored.</span>
<span class="sd">            max_num_env_runner_restarts: The maximum number of times any EnvRunner</span>
<span class="sd">                is allowed to be restarted (if `recreate_failed_env_runners` is True).</span>
<span class="sd">            delay_between_env_runner_restarts_s: The delay (in seconds) between two</span>
<span class="sd">                consecutive EnvRunner restarts (if `recreate_failed_env_runners` is</span>
<span class="sd">                True).</span>
<span class="sd">            restart_failed_sub_environments: If True and any sub-environment (within</span>
<span class="sd">                a vectorized env) throws any error during env stepping, the</span>
<span class="sd">                Sampler will try to restart the faulty sub-environment. This is done</span>
<span class="sd">                without disturbing the other (still intact) sub-environment and without</span>
<span class="sd">                the EnvRunner crashing.</span>
<span class="sd">            num_consecutive_env_runner_failures_tolerance: The number of consecutive</span>
<span class="sd">                times an EnvRunner failure (also for evaluation) is tolerated before</span>
<span class="sd">                finally crashing the Algorithm. Only useful if either</span>
<span class="sd">                `ignore_env_runner_failures` or `recreate_failed_env_runners` is True.</span>
<span class="sd">                Note that for `restart_failed_sub_environments` and sub-environment</span>
<span class="sd">                failures, the EnvRunner itself is NOT affected and won&#39;t throw any</span>
<span class="sd">                errors as the flawed sub-environment is silently restarted under the</span>
<span class="sd">                hood.</span>
<span class="sd">            env_runner_health_probe_timeout_s: Max amount of time in seconds, we should</span>
<span class="sd">                spend waiting for EnvRunner health probe calls</span>
<span class="sd">                (`EnvRunner.ping.remote()`) to respond. Health pings are very cheap,</span>
<span class="sd">                however, we perform the health check via a blocking `ray.get()`, so the</span>
<span class="sd">                default value should not be too large.</span>
<span class="sd">            env_runner_restore_timeout_s: Max amount of time we should wait to restore</span>
<span class="sd">                states on recovered EnvRunner actors. Default is 30 mins.</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ignore_worker_failures</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(ignore_worker_failures)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(ignore_env_runner_failures)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">recreate_failed_workers</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(recreate_failed_workers)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(recreate_failed_env_runners)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">max_num_worker_restarts</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(max_num_worker_restarts)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(max_num_env_runner_restarts)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">delay_between_worker_restarts_s</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(delay_between_worker_restarts_s)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(delay_between_env_runner_&quot;</span>
                <span class="s2">&quot;restarts_s)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">num_consecutive_worker_failures_tolerance</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(num_consecutive_worker_&quot;</span>
                <span class="s2">&quot;failures_tolerance)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(num_consecutive_env_runner_&quot;</span>
                <span class="s2">&quot;failures_tolerance)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">worker_health_probe_timeout_s</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(worker_health_probe_timeout_s)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(&quot;</span>
                <span class="s2">&quot;env_runner_health_probe_timeout_s)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">worker_restore_timeout_s</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(worker_restore_timeout_s)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.fault_tolerance(env_runner_restore_timeout_s)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">ignore_env_runner_failures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ignore_env_runner_failures</span> <span class="o">=</span> <span class="n">ignore_env_runner_failures</span>
        <span class="k">if</span> <span class="n">recreate_failed_env_runners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recreate_failed_env_runners</span> <span class="o">=</span> <span class="n">recreate_failed_env_runners</span>
        <span class="k">if</span> <span class="n">max_num_env_runner_restarts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_num_env_runner_restarts</span> <span class="o">=</span> <span class="n">max_num_env_runner_restarts</span>
        <span class="k">if</span> <span class="n">delay_between_env_runner_restarts_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delay_between_env_runner_restarts_s</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">delay_between_env_runner_restarts_s</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">restart_failed_sub_environments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_failed_sub_environments</span> <span class="o">=</span> <span class="n">restart_failed_sub_environments</span>
        <span class="k">if</span> <span class="n">num_consecutive_env_runner_failures_tolerance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_consecutive_env_runner_failures_tolerance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">num_consecutive_env_runner_failures_tolerance</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">env_runner_health_probe_timeout_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_health_probe_timeout_s</span> <span class="o">=</span> <span class="n">env_runner_health_probe_timeout_s</span>
        <span class="k">if</span> <span class="n">env_runner_restore_timeout_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_restore_timeout_s</span> <span class="o">=</span> <span class="n">env_runner_restore_timeout_s</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.rl_module">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rl_module.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.rl_module">[docs]</a>
    <span class="k">def</span> <span class="nf">rl_module</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">model_config_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">rl_module_spec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RLModuleSpecType</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">algorithm_config_overrides_per_module</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Dict</span><span class="p">[</span><span class="n">ModuleID</span><span class="p">,</span> <span class="n">PartialAlgorithmConfigDict</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated arg.</span>
        <span class="n">_enable_rl_module_api</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s RLModule settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_config_dict: The default model config dictionary for `RLModule`s. This</span>
<span class="sd">                will be used for any `RLModule` if not otherwise specified in the</span>
<span class="sd">                `rl_module_spec`.</span>
<span class="sd">            rl_module_spec: The RLModule spec to use for this config. It can be either</span>
<span class="sd">                a RLModuleSpec or a MultiRLModuleSpec. If the</span>
<span class="sd">                observation_space, action_space, catalog_class, or the model config is</span>
<span class="sd">                not specified it will be inferred from the env and other parts of the</span>
<span class="sd">                algorithm config object.</span>
<span class="sd">            algorithm_config_overrides_per_module: Only used if</span>
<span class="sd">                `enable_rl_module_and_learner=True`.</span>
<span class="sd">                A mapping from ModuleIDs to per-module AlgorithmConfig override dicts,</span>
<span class="sd">                which apply certain settings,</span>
<span class="sd">                e.g. the learning rate, from the main AlgorithmConfig only to this</span>
<span class="sd">                particular module (within a MultiRLModule).</span>
<span class="sd">                You can create override dicts by using the `AlgorithmConfig.overrides`</span>
<span class="sd">                utility. For example, to override your learning rate and (PPO) lambda</span>
<span class="sd">                setting just for a single RLModule with your MultiRLModule, do:</span>
<span class="sd">                config.multi_agent(algorithm_config_overrides_per_module={</span>
<span class="sd">                &quot;module_1&quot;: PPOConfig.overrides(lr=0.0002, lambda_=0.75),</span>
<span class="sd">                })</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_enable_rl_module_api</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.rl_module(_enable_rl_module_api=..)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.api_stack(enable_rl_module_and_learner=..)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">model_config_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_config_dict</span> <span class="o">=</span> <span class="n">model_config_dict</span>
        <span class="k">if</span> <span class="n">rl_module_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span> <span class="o">=</span> <span class="n">rl_module_spec</span>
        <span class="k">if</span> <span class="n">algorithm_config_overrides_per_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">algorithm_config_overrides_per_module</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`algorithm_config_overrides_per_module` must be a dict mapping &quot;</span>
                    <span class="s2">&quot;module IDs to config override dicts! You provided &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">algorithm_config_overrides_per_module</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_config_overrides_per_module</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">algorithm_config_overrides_per_module</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="AlgorithmConfig.experimental">
<a class="viewcode-back" href="../../../../rllib/rllib-training.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.experimental">[docs]</a>
    <span class="k">def</span> <span class="nf">experimental</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">_torch_grad_scaler_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_torch_lr_scheduler_classes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ModuleID</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">]]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_tf_policy_handles_more_than_one_loss</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_disable_preprocessor_api</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_disable_action_flattening</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="n">_disable_initialize_loss_from_dummy_batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotProvided</span><span class="p">,</span>
        <span class="c1"># Deprecated args.</span>
        <span class="n">_enable_new_api_stack</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the config&#39;s experimental settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            _torch_grad_scaler_class: Class to use for torch loss scaling (and gradient</span>
<span class="sd">                unscaling). The class must implement the following methods to be</span>
<span class="sd">                compatible with a `TorchLearner`. These methods/APIs match exactly those</span>
<span class="sd">                of torch&#39;s own `torch.amp.GradScaler` (see here for more details</span>
<span class="sd">                https://pytorch.org/docs/stable/amp.html#gradient-scaling):</span>
<span class="sd">                `scale([loss])` to scale the loss by some factor.</span>
<span class="sd">                `get_scale()` to get the current scale factor value.</span>
<span class="sd">                `step([optimizer])` to unscale the grads (divide by the scale factor)</span>
<span class="sd">                and step the given optimizer.</span>
<span class="sd">                `update()` to update the scaler after an optimizer step (for example to</span>
<span class="sd">                adjust the scale factor).</span>
<span class="sd">            _torch_lr_scheduler_classes: A list of `torch.lr_scheduler.LRScheduler`</span>
<span class="sd">                (see here for more details</span>
<span class="sd">                https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate)</span>
<span class="sd">                classes or a dictionary mapping module IDs to such a list of respective</span>
<span class="sd">                scheduler classes. Multiple scheduler classes can be applied in sequence</span>
<span class="sd">                and will be stepped in the same sequence as defined here. Note, most</span>
<span class="sd">                learning rate schedulers need arguments to be configured, that is, you</span>
<span class="sd">                might have to partially initialize the schedulers in the list(s) using</span>
<span class="sd">                `functools.partial`.</span>
<span class="sd">            _tf_policy_handles_more_than_one_loss: Experimental flag.</span>
<span class="sd">                If True, TFPolicy handles more than one loss or optimizer.</span>
<span class="sd">                Set this to True, if you would like to return more than</span>
<span class="sd">                one loss term from your `loss_fn` and an equal number of optimizers</span>
<span class="sd">                from your `optimizer_fn`. In the future, the default for this will be</span>
<span class="sd">                True.</span>
<span class="sd">            _disable_preprocessor_api: Experimental flag.</span>
<span class="sd">                If True, no (observation) preprocessor will be created and</span>
<span class="sd">                observations will arrive in model as they are returned by the env.</span>
<span class="sd">                In the future, the default for this will be True.</span>
<span class="sd">            _disable_action_flattening: Experimental flag.</span>
<span class="sd">                If True, RLlib will no longer flatten the policy-computed actions into</span>
<span class="sd">                a single tensor (for storage in SampleCollectors/output files/etc..),</span>
<span class="sd">                but leave (possibly nested) actions as-is. Disabling flattening affects:</span>
<span class="sd">                - SampleCollectors: Have to store possibly nested action structs.</span>
<span class="sd">                - Models that have the previous action(s) as part of their input.</span>
<span class="sd">                - Algorithms reading from offline files (incl. action information).</span>

<span class="sd">        Returns:</span>
<span class="sd">            This updated AlgorithmConfig object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_enable_new_api_stack</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.experimental(_enable_new_api_stack=...)&quot;</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.api_stack(enable_rl_module_and_learner=...)&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">_tf_policy_handles_more_than_one_loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tf_policy_handles_more_than_one_loss</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">_tf_policy_handles_more_than_one_loss</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">_disable_preprocessor_api</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_preprocessor_api</span> <span class="o">=</span> <span class="n">_disable_preprocessor_api</span>
        <span class="k">if</span> <span class="n">_disable_action_flattening</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_action_flattening</span> <span class="o">=</span> <span class="n">_disable_action_flattening</span>
        <span class="k">if</span> <span class="n">_disable_initialize_loss_from_dummy_batch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_initialize_loss_from_dummy_batch</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">_disable_initialize_loss_from_dummy_batch</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">_torch_grad_scaler_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_torch_grad_scaler_class</span> <span class="o">=</span> <span class="n">_torch_grad_scaler_class</span>
        <span class="k">if</span> <span class="n">_torch_lr_scheduler_classes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotProvided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_torch_lr_scheduler_classes</span> <span class="o">=</span> <span class="n">_torch_lr_scheduler_classes</span>

        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rl_module_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">default_rl_module_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_rl_module_spec</span><span class="p">()</span>
        <span class="n">_check_rl_module_spec</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">)</span>

        <span class="c1"># `self._rl_module_spec` has been user defined (via call to `self.rl_module()`).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Merge provided RL Module spec class with defaults</span>
            <span class="n">_check_rl_module_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span><span class="p">)</span>
            <span class="c1"># Merge given spec with default one (in case items are missing, such as</span>
            <span class="c1"># spaces, module class, etc.)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                    <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">default_rl_module_spec</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">,</span> <span class="n">MultiRLModuleSpec</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot merge MultiRLModuleSpec with RLModuleSpec!&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">multi_rl_module_spec</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span><span class="p">)</span>
                <span class="n">multi_rl_module_spec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">multi_rl_module_spec</span>

        <span class="c1"># `self._rl_module_spec` has not been user defined -&gt; return default one.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_rl_module_spec</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">learner_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Learner&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the Learner sub-class to use by this Algorithm.</span>

<span class="sd">        Either</span>
<span class="sd">        a) User sets a specific learner class via calling `.training(learner_class=...)`</span>
<span class="sd">        b) User leaves learner class unset (None) and the AlgorithmConfig itself</span>
<span class="sd">        figures out the actual learner class by calling its own</span>
<span class="sd">        `.get_default_learner_class()` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_learner_class</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_learner_class</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_atari</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if if specified env is an Atari env.&quot;&quot;&quot;</span>

        <span class="c1"># Not yet determined, try to figure this out.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_atari</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Atari envs are usually specified via a string like &quot;PongNoFrameskip-v4&quot;</span>
            <span class="c1"># or &quot;ALE/Breakout-v5&quot;.</span>
            <span class="c1"># We do NOT attempt to auto-detect Atari env for other specified types like</span>
            <span class="c1"># a callable, to avoid running heavy logics in validate().</span>
            <span class="c1"># For these cases, users can explicitly set `environment(atari=True)`.</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="c1"># Any gymnasium error -&gt; Cannot be an Atari env.</span>
            <span class="k">except</span> <span class="n">gym</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_is_atari</span> <span class="o">=</span> <span class="n">is_atari</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
            <span class="c1"># Clean up env&#39;s resources, if any.</span>
            <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_atari</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_train_batch_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size_per_learner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size_per_learner</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span>

    <span class="c1"># TODO: Make rollout_fragment_length as read-only property and replace the current</span>
    <span class="c1">#  self.rollout_fragment_length a private variable.</span>
<div class="viewcode-block" id="AlgorithmConfig.get_rollout_fragment_length">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_rollout_fragment_length.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_rollout_fragment_length">[docs]</a>
    <span class="k">def</span> <span class="nf">get_rollout_fragment_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically infers a proper rollout_fragment_length setting if &quot;auto&quot;.</span>

<span class="sd">        Uses the simple formula:</span>
<span class="sd">        `rollout_fragment_length` = `total_train_batch_size` /</span>
<span class="sd">        (`num_envs_per_env_runner` * `num_env_runners`)</span>

<span class="sd">        If result is a fraction AND `worker_index` is provided, will make</span>
<span class="sd">        those workers add additional timesteps, such that the overall batch size (across</span>
<span class="sd">        the workers) will add up to exactly the `total_train_batch_size`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The user-provided `rollout_fragment_length` or a computed one (if user</span>
<span class="sd">            provided value is &quot;auto&quot;), making sure `total_train_batch_size` is reached</span>
<span class="sd">            exactly in each iteration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="c1"># Example:</span>
            <span class="c1"># 2 workers, 2 envs per worker, 2000 train batch size:</span>
            <span class="c1"># -&gt; 2000 / 4 -&gt; 500</span>
            <span class="c1"># 4 workers, 3 envs per worker, 2500 train batch size:</span>
            <span class="c1"># -&gt; 2500 / 12 -&gt; 208.333 -&gt; diff=4 (208 * 12 = 2496)</span>
            <span class="c1"># -&gt; worker 1, 2: 209, workers 3, 4: 208</span>
            <span class="c1"># 2 workers, 20 envs per worker, 512 train batch size:</span>
            <span class="c1"># -&gt; 512 / 40 -&gt; 12.8 -&gt; diff=32 (12 * 40 = 480)</span>
            <span class="c1"># -&gt; worker 1: 13, workers 2: 12</span>
            <span class="n">rollout_fragment_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span> <span class="o">/</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">rollout_fragment_length</span><span class="p">)</span> <span class="o">!=</span> <span class="n">rollout_fragment_length</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">rollout_fragment_length</span>
                <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">worker_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">diff</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rollout_fragment_length</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rollout_fragment_length</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rollout_fragment_length</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span></div>


    <span class="c1"># TODO: Make evaluation_config as read-only property and replace the current</span>
    <span class="c1">#  self.evaluation_config a private variable.</span>
<div class="viewcode-block" id="AlgorithmConfig.get_evaluation_config_object">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_evaluation_config_object.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_evaluation_config_object">[docs]</a>
    <span class="k">def</span> <span class="nf">get_evaluation_config_object</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;AlgorithmConfig&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a full AlgorithmConfig object from `self.evaluation_config`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A fully valid AlgorithmConfig object that can be used for the evaluation</span>
<span class="sd">            EnvRunnerGroup. If `self` is already an evaluation config object, return</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_evaluation</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">evaluation_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_config</span>
        <span class="c1"># Already an AlgorithmConfig -&gt; copy and use as-is.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">evaluation_config</span><span class="p">,</span> <span class="n">AlgorithmConfig</span><span class="p">):</span>
            <span class="n">eval_config_obj</span> <span class="o">=</span> <span class="n">evaluation_config</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Create unfrozen copy of self to be used as the to-be-returned eval</span>
        <span class="c1"># AlgorithmConfig.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eval_config_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Update with evaluation override settings:</span>
            <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">update_from_dict</span><span class="p">(</span><span class="n">evaluation_config</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="c1"># Switch on the `in_evaluation` flag and remove `evaluation_config`</span>
        <span class="c1"># (set to None).</span>
        <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">in_evaluation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">evaluation_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># NOTE: The following if-block is only relevant for the old API stack.</span>
        <span class="c1"># For the new API stack (EnvRunners), the evaluation methods of Algorithm</span>
        <span class="c1"># explicitly tell each EnvRunner on each sample call, how many timesteps</span>
        <span class="c1"># of episodes to collect.</span>
        <span class="c1"># Evaluation duration unit: episodes.</span>
        <span class="c1"># Switch on `complete_episode` rollouts. Also, make sure</span>
        <span class="c1"># rollout fragments are short so we never have more than one</span>
        <span class="c1"># episode in one rollout.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration_unit</span> <span class="o">==</span> <span class="s2">&quot;episodes&quot;</span><span class="p">:</span>
            <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">batch_mode</span> <span class="o">=</span> <span class="s2">&quot;complete_episodes&quot;</span>
            <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">rollout_fragment_length</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Evaluation duration unit: timesteps.</span>
        <span class="c1"># - Set `batch_mode=truncate_episodes` so we don&#39;t perform rollouts</span>
        <span class="c1">#   strictly along episode borders.</span>
        <span class="c1"># Set `rollout_fragment_length` such that desired steps are divided</span>
        <span class="c1"># equally amongst workers or - in &quot;auto&quot; duration mode - set it</span>
        <span class="c1"># to a reasonably small number (10), such that a single `sample()`</span>
        <span class="c1"># call doesn&#39;t take too much time and we can stop evaluation as soon</span>
        <span class="c1"># as possible after the train step is completed.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">batch_mode</span> <span class="o">=</span> <span class="s2">&quot;truncate_episodes&quot;</span>
            <span class="n">eval_config_obj</span><span class="o">.</span><span class="n">rollout_fragment_length</span> <span class="o">=</span> <span class="p">(</span>
                <span class="c1"># Set to a moderately small (but not too small) value in order</span>
                <span class="c1"># to a) not overshoot too much the parallelly running `training_step`</span>
                <span class="c1"># but also to b) avoid too many `sample()` remote calls.</span>
                <span class="c1"># 100 seems like a good middle ground.</span>
                <span class="mi">100</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
                <span class="k">else</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span>
                        <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">eval_config_obj</span></div>


    <span class="c1"># TODO: Move this to those algorithms that really need this, which is currently</span>
    <span class="c1">#  only A2C and PG.</span>
<div class="viewcode-block" id="AlgorithmConfig.validate_train_batch_size_vs_rollout_fragment_length">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate_train_batch_size_vs_rollout_fragment_length.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.validate_train_batch_size_vs_rollout_fragment_length">[docs]</a>
    <span class="k">def</span> <span class="nf">validate_train_batch_size_vs_rollout_fragment_length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detects mismatches for `train_batch_size` vs `rollout_fragment_length`.</span>

<span class="sd">        Only applicable for algorithms, whose train_batch_size should be directly</span>
<span class="sd">        dependent on rollout_fragment_length (synchronous sampling, on-policy PG algos).</span>

<span class="sd">        If rollout_fragment_length != &quot;auto&quot;, makes sure that the product of</span>
<span class="sd">        `rollout_fragment_length` x `num_env_runners` x `num_envs_per_env_runner`</span>
<span class="sd">        roughly (10%) matches the provided `train_batch_size`. Otherwise, errors with</span>
<span class="sd">        asking the user to set rollout_fragment_length to `auto` or to a matching</span>
<span class="sd">        value.</span>

<span class="sd">        Also, only checks this if `train_batch_size` &gt; 0 (DDPPO sets this</span>
<span class="sd">        to -1 to auto-calculate the actual batch size later).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If there is a mismatch between user provided</span>
<span class="sd">                `rollout_fragment_length` and `total_train_batch_size`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span> <span class="o">!=</span> <span class="s2">&quot;auto&quot;</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_evaluation</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">min_batch_size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span>
            <span class="p">)</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="n">min_batch_size</span>
            <span class="k">while</span> <span class="n">batch_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span><span class="p">:</span>
                <span class="n">batch_size</span> <span class="o">+=</span> <span class="n">min_batch_size</span>
            <span class="k">if</span> <span class="n">batch_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span> <span class="o">&gt;</span> <span class="p">(</span>
                <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="n">batch_size</span> <span class="o">-</span> <span class="n">min_batch_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span> <span class="o">&gt;</span> <span class="p">(</span>
                <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span>
            <span class="p">):</span>
                <span class="n">suggested_rollout_fragment_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span> <span class="o">//</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Your desired `total_train_batch_size` &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_train_batch_size</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;learners x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size_per_learner</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="s2">&quot;or a value 10</span><span class="si">% o</span><span class="s2">ff of that cannot be achieved with your other &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;settings (num_env_runners=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span><span class="si">}</span><span class="s2">; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;num_envs_per_env_runner=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span><span class="si">}</span><span class="s2">; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;rollout_fragment_length=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rollout_fragment_length</span><span class="si">}</span><span class="s2">)! &quot;</span>
                    <span class="s2">&quot;Try setting `rollout_fragment_length` to &#39;auto&#39; OR to a value of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">suggested_rollout_fragment_length</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_torch_compile_worker_config">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_torch_compile_worker_config.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_torch_compile_worker_config">[docs]</a>
    <span class="k">def</span> <span class="nf">get_torch_compile_worker_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the TorchCompileConfig to use on workers.&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">ray.rllib.core.rl_module.torch.torch_compile_config</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">TorchCompileConfig</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">TorchCompileConfig</span><span class="p">(</span>
            <span class="n">torch_dynamo_backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker_dynamo_backend</span><span class="p">,</span>
            <span class="n">torch_dynamo_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker_dynamo_mode</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_default_rl_module_spec">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_rl_module_spec.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_rl_module_spec">[docs]</a>
    <span class="k">def</span> <span class="nf">get_default_rl_module_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RLModuleSpecType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the RLModule spec to use for this algorithm.</span>

<span class="sd">        Override this method in the subclass to return the RLModule spec, given</span>
<span class="sd">        the input framework.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The RLModuleSpec (or MultiRLModuleSpec) to</span>
<span class="sd">            use for this algorithm&#39;s RLModule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_default_learner_class">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_learner_class.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_default_learner_class">[docs]</a>
    <span class="k">def</span> <span class="nf">get_default_learner_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Learner&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the Learner class to use for this algorithm.</span>

<span class="sd">        Override this method in the sub-class to return the Learner class type given</span>
<span class="sd">        the input framework.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Learner class to use for this algorithm either as a class type or as</span>
<span class="sd">            a string (e.g. ray.rllib.core.learner.testing.torch.BC).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_rl_module_spec">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_rl_module_spec.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_rl_module_spec">[docs]</a>
    <span class="k">def</span> <span class="nf">get_rl_module_spec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spaces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inference_only</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RLModuleSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the RLModuleSpec based on the given env/spaces.</span>

<span class="sd">        Args:</span>
<span class="sd">            env: An optional environment instance, from which to infer the observation-</span>
<span class="sd">                and action spaces for the RLModule. If not provided, will try to infer</span>
<span class="sd">                from `spaces`, otherwise from `self.observation_space` and</span>
<span class="sd">                `self.action_space`. If no information on spaces can be inferred, will</span>
<span class="sd">                raise an error.</span>
<span class="sd">            spaces: Optional dict mapping ModuleIDs to 2-tuples of observation- and</span>
<span class="sd">                action space that should be used for the respective RLModule.</span>
<span class="sd">                These spaces are usually provided by an already instantiated remote</span>
<span class="sd">                EnvRunner (call `EnvRunner.get_spaces()`). If not provided, will try</span>
<span class="sd">                to infer from `env`, otherwise from `self.observation_space` and</span>
<span class="sd">                `self.action_space`. If no information on spaces can be inferred,</span>
<span class="sd">                will raise an error.</span>
<span class="sd">            inference_only: If `True`, the returned module spec will be used in an</span>
<span class="sd">                inference-only setting (sampling) and the RLModule can thus be built in</span>
<span class="sd">                its light version (if available). For example, the `inference_only`</span>
<span class="sd">                version of an RLModule might only contain the networks required for</span>
<span class="sd">                computing actions, but misses additional target- or critic networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new RLModuleSpec instance that can be used to build an RLModule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rl_module_spec</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rl_module_spec</span><span class="p">)</span>

        <span class="c1"># If a MultiRLModuleSpec -&gt; Reduce to single-agent (and assert that</span>
        <span class="c1"># all non DEFAULT_MODULE_IDs are `learner_only` (so will not be built</span>
        <span class="c1"># here on EnvRunner).</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rl_module_spec</span><span class="p">,</span> <span class="n">MultiRLModuleSpec</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">DEFAULT_MODULE_ID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rl_module_spec</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">inference_only</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mid</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">mid</span> <span class="o">!=</span> <span class="n">DEFAULT_MODULE_ID</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">learner_only</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rl_module_spec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When calling `AlgorithmConfig.get_rl_module_spec()`, the &quot;</span>
                    <span class="s2">&quot;configuration must contain the `DEFAULT_MODULE_ID` key and all &quot;</span>
                    <span class="s2">&quot;other keys&#39; specs must have the setting `learner_only=True`! If &quot;</span>
                    <span class="s2">&quot;you are using a more complex setup, call &quot;</span>
                    <span class="s2">&quot;`AlgorithmConfig.get_multi_rl_module_spec(...)` instead.&quot;</span>
                <span class="p">)</span>
            <span class="n">rl_module_spec</span> <span class="o">=</span> <span class="n">rl_module_spec</span><span class="p">[</span><span class="n">DEFAULT_MODULE_ID</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">spaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="p">[</span><span class="n">DEFAULT_MODULE_ID</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="p">[</span><span class="n">DEFAULT_MODULE_ID</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">VectorEnv</span><span class="p">):</span>
                <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">single_observation_space</span>
            <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">single_action_space</span>

        <span class="c1"># If module_config_dict is not defined, set to our generic one.</span>
        <span class="k">if</span> <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">model_config_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">model_config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_config</span>

        <span class="k">if</span> <span class="n">inference_only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rl_module_spec</span><span class="o">.</span><span class="n">inference_only</span> <span class="o">=</span> <span class="n">inference_only</span>

        <span class="k">return</span> <span class="n">rl_module_spec</span></div>


<div class="viewcode-block" id="AlgorithmConfig.get_multi_rl_module_spec">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_rl_module_spec.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_rl_module_spec">[docs]</a>
    <span class="k">def</span> <span class="nf">get_multi_rl_module_spec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spaces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Space</span><span class="p">,</span> <span class="n">Space</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inference_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># @HybridAPIStack</span>
        <span class="n">policy_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PolicySpec</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">single_agent_rl_module_spec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RLModuleSpec</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiRLModuleSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the MultiRLModuleSpec based on the given env/spaces.</span>

<span class="sd">        Args:</span>
<span class="sd">            env: An optional environment instance, from which to infer the different</span>
<span class="sd">                spaces for the individual RLModules. If not provided, will try to infer</span>
<span class="sd">                from `spaces`, otherwise from `self.observation_space` and</span>
<span class="sd">                `self.action_space`. If no information on spaces can be inferred, will</span>
<span class="sd">                raise an error.</span>
<span class="sd">            spaces: Optional dict mapping ModuleIDs to 2-tuples of observation- and</span>
<span class="sd">                action space that should be used for the respective RLModule.</span>
<span class="sd">                These spaces are usually provided by an already instantiated remote</span>
<span class="sd">                EnvRunner (call `EnvRunner.get_spaces()`). If not provided, will try</span>
<span class="sd">                to infer from `env`, otherwise from `self.observation_space` and</span>
<span class="sd">                `self.action_space`. If no information on spaces can be inferred,</span>
<span class="sd">                will raise an error.</span>
<span class="sd">            inference_only: If `True`, the returned module spec will be used in an</span>
<span class="sd">                inference-only setting (sampling) and the RLModule can thus be built in</span>
<span class="sd">                its light version (if available). For example, the `inference_only`</span>
<span class="sd">                version of an RLModule might only contain the networks required for</span>
<span class="sd">                computing actions, but misses additional target- or critic networks.</span>
<span class="sd">                Also, if `True`, the returned spec will NOT contain those (sub)</span>
<span class="sd">                RLModuleSpecs that have their `learner_only` flag set to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new MultiRLModuleSpec instance that can be used to build a MultiRLModule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO (Kourosh,sven): When we replace policy entirely there will be no need for</span>
        <span class="c1">#  this function to map policy_dict to multi_rl_module_specs anymore. The module</span>
        <span class="c1">#  spec will be directly given by the user or inferred from env and spaces.</span>
        <span class="k">if</span> <span class="n">policy_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">policy_dict</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_multi_agent_setup</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">spaces</span><span class="o">=</span><span class="n">spaces</span><span class="p">)</span>

        <span class="c1"># TODO (Kourosh): Raise an error if the config is not frozen</span>
        <span class="c1"># If the module is single-agent convert it to multi-agent spec</span>

        <span class="c1"># The default RLModuleSpec (might be multi-agent or single-agent).</span>
        <span class="n">default_rl_module_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_rl_module_spec</span><span class="p">()</span>
        <span class="c1"># The currently configured RLModuleSpec (might be multi-agent or single-agent).</span>
        <span class="c1"># If None, use the default one.</span>
        <span class="n">current_rl_module_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span> <span class="ow">or</span> <span class="n">default_rl_module_spec</span>

        <span class="c1"># Algorithm is currently setup as a single-agent one.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_rl_module_spec</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
            <span class="c1"># Use either the provided `single_agent_rl_module_spec` (a</span>
            <span class="c1"># RLModuleSpec), the currently configured one of this</span>
            <span class="c1"># AlgorithmConfig object, or the default one.</span>
            <span class="n">single_agent_rl_module_spec</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">single_agent_rl_module_spec</span> <span class="ow">or</span> <span class="n">current_rl_module_spec</span>
            <span class="p">)</span>
            <span class="n">single_agent_rl_module_spec</span><span class="o">.</span><span class="n">inference_only</span> <span class="o">=</span> <span class="n">inference_only</span>
            <span class="c1"># Now construct the proper MultiRLModuleSpec.</span>
            <span class="n">multi_rl_module_spec</span> <span class="o">=</span> <span class="n">MultiRLModuleSpec</span><span class="p">(</span>
                <span class="n">module_specs</span><span class="o">=</span><span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">single_agent_rl_module_spec</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">policy_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Algorithm is currently setup as a multi-agent one.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The user currently has a MultiAgentSpec setup (either via</span>
            <span class="c1"># self._rl_module_spec or the default spec of this AlgorithmConfig).</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_rl_module_spec</span><span class="p">,</span> <span class="n">MultiRLModuleSpec</span><span class="p">)</span>

            <span class="c1"># Default is single-agent but the user has provided a multi-agent spec</span>
            <span class="c1"># so the use-case is multi-agent.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                <span class="c1"># The individual (single-agent) module specs are defined by the user</span>
                <span class="c1"># in the currently setup MultiRLModuleSpec -&gt; Use that</span>
                <span class="c1"># RLModuleSpec.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                    <span class="n">single_agent_spec</span> <span class="o">=</span> <span class="n">single_agent_rl_module_spec</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span>
                    <span class="p">)</span>
                    <span class="n">single_agent_spec</span><span class="o">.</span><span class="n">inference_only</span> <span class="o">=</span> <span class="n">inference_only</span>
                    <span class="n">module_specs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">single_agent_spec</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">policy_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="p">}</span>

                <span class="c1"># The individual (single-agent) module specs have not been configured</span>
                <span class="c1"># via this AlgorithmConfig object -&gt; Use provided single-agent spec or</span>
                <span class="c1"># the the default spec (which is also a RLModuleSpec in this</span>
                <span class="c1"># case).</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">single_agent_spec</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">single_agent_rl_module_spec</span> <span class="ow">or</span> <span class="n">default_rl_module_spec</span>
                    <span class="p">)</span>
                    <span class="n">single_agent_spec</span><span class="o">.</span><span class="n">inference_only</span> <span class="o">=</span> <span class="n">inference_only</span>
                    <span class="n">module_specs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                            <span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                <span class="n">k</span><span class="p">,</span> <span class="n">single_agent_spec</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="n">policy_dict</span> <span class="o">|</span> <span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="p">}</span>

                <span class="c1"># Now construct the proper MultiRLModuleSpec.</span>
                <span class="c1"># We need to infer the multi-agent class from `current_rl_module_spec`</span>
                <span class="c1"># and fill in the module_specs dict.</span>
                <span class="n">multi_rl_module_spec</span> <span class="o">=</span> <span class="n">current_rl_module_spec</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
                    <span class="n">multi_rl_module_class</span><span class="o">=</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">multi_rl_module_class</span><span class="p">,</span>
                    <span class="n">module_specs</span><span class="o">=</span><span class="n">module_specs</span><span class="p">,</span>
                    <span class="n">modules_to_load</span><span class="o">=</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">modules_to_load</span><span class="p">,</span>
                    <span class="n">load_state_path</span><span class="o">=</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">load_state_path</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Default is multi-agent and user wants to override it -&gt; Don&#39;t use the</span>
            <span class="c1"># default.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Use has given an override RLModuleSpec -&gt; Use this to</span>
                <span class="c1"># construct the individual RLModules within the MultiRLModuleSpec.</span>
                <span class="k">if</span> <span class="n">single_agent_rl_module_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="c1"># User has NOT provided an override RLModuleSpec.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># But the currently setup multi-agent spec has a SingleAgentRLModule</span>
                    <span class="c1"># spec defined -&gt; Use that to construct the individual RLModules</span>
                    <span class="c1"># within the MultiRLModuleSpec.</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                        <span class="c1"># The individual module specs are not given, it is given as one</span>
                        <span class="c1"># RLModuleSpec to be re-used for all</span>
                        <span class="n">single_agent_rl_module_spec</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span>
                        <span class="p">)</span>
                    <span class="c1"># The currently setup multi-agent spec has NO</span>
                    <span class="c1"># RLModuleSpec in it -&gt; Error (there is no way we can</span>
                    <span class="c1"># infer this information from anywhere at this point).</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;We have a MultiRLModuleSpec &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">current_rl_module_spec</span><span class="si">}</span><span class="s2">), but no &quot;</span>
                            <span class="s2">&quot;`RLModuleSpec`s to compile the individual &quot;</span>
                            <span class="s2">&quot;RLModules&#39; specs! Use &quot;</span>
                            <span class="s2">&quot;`AlgorithmConfig.get_multi_rl_module_spec(&quot;</span>
                            <span class="s2">&quot;policy_dict=.., single_agent_rl_module_spec=..)`.&quot;</span>
                        <span class="p">)</span>

                <span class="n">single_agent_rl_module_spec</span><span class="o">.</span><span class="n">inference_only</span> <span class="o">=</span> <span class="n">inference_only</span>

                <span class="c1"># Now construct the proper MultiRLModuleSpec.</span>
                <span class="n">multi_rl_module_spec</span> <span class="o">=</span> <span class="n">current_rl_module_spec</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
                    <span class="n">multi_rl_module_class</span><span class="o">=</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">multi_rl_module_class</span><span class="p">,</span>
                    <span class="n">module_specs</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">single_agent_rl_module_spec</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">policy_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="p">},</span>
                    <span class="n">modules_to_load</span><span class="o">=</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">modules_to_load</span><span class="p">,</span>
                    <span class="n">load_state_path</span><span class="o">=</span><span class="n">current_rl_module_spec</span><span class="o">.</span><span class="n">load_state_path</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Fill in the missing values from the specs that we already have. By combining</span>
        <span class="c1"># PolicySpecs and the default RLModuleSpec.</span>
        <span class="k">for</span> <span class="n">module_id</span> <span class="ow">in</span> <span class="n">policy_dict</span> <span class="o">|</span> <span class="n">multi_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">:</span>

            <span class="c1"># Remove/skip `learner_only=True` RLModules if `inference_only` is True.</span>
            <span class="n">module_spec</span> <span class="o">=</span> <span class="n">multi_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">[</span><span class="n">module_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">inference_only</span> <span class="ow">and</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">learner_only</span><span class="p">:</span>
                <span class="n">multi_rl_module_spec</span><span class="o">.</span><span class="n">remove_modules</span><span class="p">(</span><span class="n">module_id</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">policy_spec</span> <span class="o">=</span> <span class="n">policy_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">module_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">policy_spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">policy_spec</span> <span class="o">=</span> <span class="n">policy_dict</span><span class="p">[</span><span class="n">DEFAULT_MODULE_ID</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">module_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                    <span class="n">module_spec</span><span class="o">.</span><span class="n">module_class</span> <span class="o">=</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_class</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                    <span class="n">module_class</span> <span class="o">=</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="o">.</span><span class="n">module_class</span>
                    <span class="c1"># This should be already checked in validate() but we check it</span>
                    <span class="c1"># again here just in case</span>
                    <span class="k">if</span> <span class="n">module_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;The default rl_module spec cannot have an empty &quot;</span>
                            <span class="s2">&quot;module_class under its RLModuleSpec.&quot;</span>
                        <span class="p">)</span>
                    <span class="n">module_spec</span><span class="o">.</span><span class="n">module_class</span> <span class="o">=</span> <span class="n">module_class</span>
                <span class="k">elif</span> <span class="n">module_id</span> <span class="ow">in</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">:</span>
                    <span class="n">module_spec</span><span class="o">.</span><span class="n">module_class</span> <span class="o">=</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">[</span>
                        <span class="n">module_id</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">module_class</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Module class for module </span><span class="si">{</span><span class="n">module_id</span><span class="si">}</span><span class="s2"> cannot be inferred. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;It is neither provided in the rl_module_spec that &quot;</span>
                        <span class="s2">&quot;is passed in nor in the default module spec used in &quot;</span>
                        <span class="s2">&quot;the algorithm.&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">catalog_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                    <span class="n">module_spec</span><span class="o">.</span><span class="n">catalog_class</span> <span class="o">=</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">catalog_class</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">,</span> <span class="n">RLModuleSpec</span><span class="p">):</span>
                    <span class="n">catalog_class</span> <span class="o">=</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="o">.</span><span class="n">catalog_class</span>
                    <span class="n">module_spec</span><span class="o">.</span><span class="n">catalog_class</span> <span class="o">=</span> <span class="n">catalog_class</span>
                <span class="k">elif</span> <span class="n">module_id</span> <span class="ow">in</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">:</span>
                    <span class="n">module_spec</span><span class="o">.</span><span class="n">catalog_class</span> <span class="o">=</span> <span class="n">default_rl_module_spec</span><span class="o">.</span><span class="n">module_specs</span><span class="p">[</span>
                        <span class="n">module_id</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">catalog_class</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Catalog class for module </span><span class="si">{</span><span class="n">module_id</span><span class="si">}</span><span class="s2"> cannot be inferred. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;It is neither provided in the rl_module_spec that &quot;</span>
                        <span class="s2">&quot;is passed in nor in the default module spec used in &quot;</span>
                        <span class="s2">&quot;the algorithm.&quot;</span>
                    <span class="p">)</span>
            <span class="c1"># TODO (sven): Find a good way to pack module specific parameters from</span>
            <span class="c1"># the algorithms into the `model_config_dict`.</span>
            <span class="k">if</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">observation_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">module_spec</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">observation_space</span>
            <span class="k">if</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">action_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">module_spec</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">action_space</span>
            <span class="c1"># In case the `RLModuleSpec` does not have a model config dict, we use the</span>
            <span class="c1"># the one defined by the auto keys and the `model_config_dict` arguments in</span>
            <span class="c1"># `self.rl_module()`.</span>
            <span class="k">if</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">model_config_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">module_spec</span><span class="o">.</span><span class="n">model_config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_config</span>
            <span class="c1"># Otherwise we combine the two dictionaries where settings from the</span>
            <span class="c1"># `RLModuleSpec` have higher priority.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">module_spec</span><span class="o">.</span><span class="n">model_config_dict</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_config</span> <span class="o">|</span> <span class="n">module_spec</span><span class="o">.</span><span class="n">model_config_dict</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">multi_rl_module_spec</span></div>


    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gatekeeper in case we are in frozen state and need to error.&quot;&quot;&quot;</span>

        <span class="c1"># If we are frozen, do not allow to set any attributes anymore.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_is_frozen&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_frozen</span><span class="p">:</span>
            <span class="c1"># TODO: Remove `simple_optimizer` entirely.</span>
            <span class="c1">#  Remove need to set `worker_index` in RolloutWorker&#39;s c&#39;tor.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;simple_optimizer&quot;</span><span class="p">,</span> <span class="s2">&quot;worker_index&quot;</span><span class="p">,</span> <span class="s2">&quot;_is_frozen&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot set attribute (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">) of an already frozen &quot;</span>
                    <span class="s2">&quot;AlgorithmConfig!&quot;</span>
                <span class="p">)</span>
        <span class="c1"># Backward compatibility for checkpoints taken with wheels, in which</span>
        <span class="c1"># `self.rl_module_spec` was still settable (now it&#39;s a property).</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;rl_module_spec&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;_rl_module_spec&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to still support accessing properties by key lookup.</span>

<span class="sd">        This way, an AlgorithmConfig object can still be used as if a dict, e.g.</span>
<span class="sd">        by Ray Tune.</span>

<span class="sd">        Examples:</span>
<span class="sd">            .. testcode::</span>

<span class="sd">                from ray.rllib.algorithms.algorithm_config import AlgorithmConfig</span>
<span class="sd">                config = AlgorithmConfig()</span>
<span class="sd">                print(config[&quot;lr&quot;])</span>

<span class="sd">            .. testoutput::</span>

<span class="sd">                0.001</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Uncomment this once all algorithms use AlgorithmConfigs under the</span>
        <span class="c1">#  hood (as well as Ray Tune).</span>
        <span class="c1"># if log_once(&quot;algo_config_getitem&quot;):</span>
        <span class="c1">#    logger.warning(</span>
        <span class="c1">#        &quot;AlgorithmConfig objects should NOT be used as dict! &quot;</span>
        <span class="c1">#        f&quot;Try accessing `{item}` directly as a property.&quot;</span>
        <span class="c1">#    )</span>
        <span class="c1"># In case user accesses &quot;old&quot; keys, e.g. &quot;num_workers&quot;, which need to</span>
        <span class="c1"># be translated to their correct property names.</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_special_keys</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># TODO: Remove comments once all methods/functions only support</span>
        <span class="c1">#  AlgorithmConfigs and there is no more ambiguity anywhere in the code</span>
        <span class="c1">#  on whether an AlgorithmConfig is used or an old python config dict.</span>
        <span class="c1"># raise AttributeError(</span>
        <span class="c1">#    &quot;AlgorithmConfig objects should not have their values set like dicts&quot;</span>
        <span class="c1">#    f&quot;(`config[&#39;{key}&#39;] = {value}`), &quot;</span>
        <span class="c1">#    f&quot;but via setting their properties directly (config.{prop} = {value}).&quot;</span>
        <span class="c1"># )</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;multiagent&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot set `multiagent` key in an AlgorithmConfig!</span><span class="se">\n</span><span class="s2">Try setting &quot;</span>
                <span class="s2">&quot;the multi-agent components of your AlgorithmConfig object via the &quot;</span>
                <span class="s2">&quot;`multi_agent()` method and its arguments.</span><span class="se">\n</span><span class="s2">E.g. `config.multi_agent(&quot;</span>
                <span class="s2">&quot;policies=.., policy_mapping_fn.., policies_to_train=..)`.&quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to help pretend we are a dict.&quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_special_keys</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">warn_deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

<div class="viewcode-block" id="AlgorithmConfig.get">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to help pretend we are a dict.&quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_special_keys</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">warn_deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>


<div class="viewcode-block" id="AlgorithmConfig.pop">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.pop.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.pop">[docs]</a>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to help pretend we are a dict.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>


<div class="viewcode-block" id="AlgorithmConfig.keys">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.keys.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.keys">[docs]</a>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to help pretend we are a dict.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>


<div class="viewcode-block" id="AlgorithmConfig.values">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.values.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.values">[docs]</a>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to help pretend we are a dict.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="AlgorithmConfig.items">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.items.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.items">[docs]</a>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shim method to help pretend we are a dict.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines the model configuration used.</span>

<span class="sd">        This method combines the auto configuration `self _model_config_auto_includes`</span>
<span class="sd">        defined by an algorithm with the user-defined configuration in</span>
<span class="sd">        `self._model_config_dict`.This configuration dictionary will be used to</span>
<span class="sd">        configure the `RLModule` in the new stack and the `ModelV2` in the old</span>
<span class="sd">        stack.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with the model configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config_auto_includes</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_model_config_auto_includes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines which `AlgorithmConfig` settings/properties should be</span>
<span class="sd">        auto-included into `self.model_config`.</span>

<span class="sd">        The dictionary in this property contains the default configuration of an</span>
<span class="sd">        algorithm. Together with the `self._model`, this method will be used to</span>
<span class="sd">        define the configuration sent to the `RLModule`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with the automatically included properties/settings of this</span>
<span class="sd">            `AlgorithmConfig` object into `self.model_config`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MODEL_DEFAULTS</span>

    <span class="c1"># -----------------------------------------------------------</span>
    <span class="c1"># Various validation methods for different types of settings.</span>
    <span class="c1"># -----------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_validate_framework_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates framework settings and checks whether framework is installed.&quot;&quot;&quot;</span>
        <span class="n">_tf1</span><span class="p">,</span> <span class="n">_tf</span><span class="p">,</span> <span class="n">_tfv</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">_torch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;tf2&quot;</span><span class="p">}</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">!=</span> <span class="s2">&quot;torch&quot;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;tf2&quot;</span><span class="p">}:</span>
            <span class="n">_tf1</span><span class="p">,</span> <span class="n">_tf</span><span class="p">,</span> <span class="n">_tfv</span> <span class="o">=</span> <span class="n">try_import_tf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_torch</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">try_import_torch</span><span class="p">()</span>

        <span class="c1"># Can not use &quot;tf&quot; with learner API.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;tf&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot use `framework=tf` with the new API stack! Either switch to tf2&quot;</span>
                <span class="s2">&quot; via `config.framework(&#39;tf2&#39;)` OR disable the new API stack via &quot;</span>
                <span class="s2">&quot;`config.api_stack(enable_rl_module_and_learner=False)`.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check if torch framework supports torch.compile.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">_torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;torch&quot;</span>
            <span class="ow">and</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">_torch</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TORCH_COMPILE_REQUIRED_VERSION</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_worker</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;torch.compile is only supported from torch 2.0.0&quot;</span><span class="p">)</span>

        <span class="c1"># Make sure the Learner&#39;s torch-what-to-compile setting is supported.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ray.rllib.core.learner.torch.torch_learner</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">TorchCompileWhatToCompile</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_what_to_compile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">TorchCompileWhatToCompile</span><span class="o">.</span><span class="n">FORWARD_TRAIN</span><span class="p">,</span>
                <span class="n">TorchCompileWhatToCompile</span><span class="o">.</span><span class="n">COMPLETE_UPDATE</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;`config.torch_compile_learner_what_to_compile` must be one of [&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;TorchCompileWhatToCompile.forward_train, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;TorchCompileWhatToCompile.complete_update] but is&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">torch_compile_learner_what_to_compile</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_correct_nn_framework_installed</span><span class="p">(</span><span class="n">_tf1</span><span class="p">,</span> <span class="n">_tf</span><span class="p">,</span> <span class="n">_torch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_tf_settings</span><span class="p">(</span><span class="n">_tf1</span><span class="p">,</span> <span class="n">_tfv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_resources_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks, whether resources related settings make sense.&quot;&quot;&quot;</span>

        <span class="c1"># TODO @Avnishn: This is a short-term work around due to</span>
        <span class="c1">#  https://github.com/ray-project/ray/issues/35409</span>
        <span class="c1">#  Remove this once we are able to specify placement group bundle index in RLlib</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_learner</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_learner</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set both `num_cpus_per_learner` &gt; 1 and &quot;</span>
                <span class="s2">&quot; `num_gpus_per_learner` &gt; 0! Either set &quot;</span>
                <span class="s2">&quot;`num_cpus_per_learner` &gt; 1 (and `num_gpus_per_learner`&quot;</span>
                <span class="s2">&quot;=0) OR set `num_gpus_per_learner` &gt; 0 (and leave &quot;</span>
                <span class="s2">&quot;`num_cpus_per_learner` at its default value of 1). &quot;</span>
                <span class="s2">&quot;This is due to issues with placement group fragmentation. See &quot;</span>
                <span class="s2">&quot;https://github.com/ray-project/ray/issues/35409 for more details.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Make sure the resource requirements for learner_group is valid.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_env_runner</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;num_gpus_per_env_runner must be 0 (cpu) or 1 (gpu) when using local &quot;</span>
                <span class="s2">&quot;mode (i.e., `num_learners=0`)&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_multi_agent_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks, whether multi-agent related settings make sense.&quot;&quot;&quot;</span>

        <span class="c1"># Check `policies_to_train` for invalid entries.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`config.multi_agent(policies_to_train=..)` contains &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;policy ID (</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">) that was not defined in &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;`config.multi_agent(policies=..)`!&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># TODO (sven): For now, vectorization is not allowed on new EnvRunners with</span>
        <span class="c1">#  multi-agent.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">()</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_env_runner_and_connector_v2</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;For now, using env vectorization &quot;</span>
                <span class="s2">&quot;(`config.num_envs_per_env_runner &gt; 1`) in combination with &quot;</span>
                <span class="s2">&quot;multi-agent AND the new EnvRunners is not supported! Try setting &quot;</span>
                <span class="s2">&quot;`config.num_envs_per_env_runner = 1`.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_evaluation_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks, whether evaluation related settings make sense.&quot;&quot;&quot;</span>

        <span class="c1"># Async evaluation has been deprecated. Use &quot;simple&quot; parallel mode instead</span>
        <span class="c1"># (which is also async):</span>
        <span class="c1"># `config.evaluation(evaluation_parallel_to_training=True)`.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_async_evaluation</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`enable_async_evaluation` has been deprecated (you should set this to &quot;</span>
                <span class="s2">&quot;False)! Use `config.evaluation(evaluation_parallel_to_training=True)` &quot;</span>
                <span class="s2">&quot;instead.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If `evaluation_num_env_runners` &gt; 0, warn if `evaluation_interval` is 0 or</span>
        <span class="c1"># None.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_interval</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;You have specified </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;evaluation workers, but your `evaluation_interval` is 0 or None! &quot;</span>
                <span class="s2">&quot;Therefore, evaluation will not occur automatically with each&quot;</span>
                <span class="s2">&quot; call to `Algorithm.train()`. Instead, you will have to call &quot;</span>
                <span class="s2">&quot;`Algorithm.evaluate()` manually in order to trigger an &quot;</span>
                <span class="s2">&quot;evaluation run.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># If `evaluation_num_env_runners=0` and</span>
        <span class="c1"># `evaluation_parallel_to_training=True`, warn that you need</span>
        <span class="c1"># at least one remote eval worker for parallel training and</span>
        <span class="c1"># evaluation, and set `evaluation_parallel_to_training` to False.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_parallel_to_training</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`evaluation_parallel_to_training` can only be done if &quot;</span>
                <span class="s2">&quot;`evaluation_num_env_runners` &gt; 0! Try setting &quot;</span>
                <span class="s2">&quot;`config.evaluation_parallel_to_training` to False.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If `evaluation_duration=auto`, error if</span>
        <span class="c1"># `evaluation_parallel_to_training=False`.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_parallel_to_training</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`evaluation_duration=auto` not supported for &quot;</span>
                    <span class="s2">&quot;`evaluation_parallel_to_training=False`!&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration_unit</span> <span class="o">==</span> <span class="s2">&quot;episodes&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;When using `config.evaluation_duration=&#39;auto&#39;`, the sampling unit &quot;</span>
                    <span class="s2">&quot;used is always &#39;timesteps&#39;! You have set &quot;</span>
                    <span class="s2">&quot;`config.evaluation_duration_unit=&#39;episodes&#39;`, which will be &quot;</span>
                    <span class="s2">&quot;ignored.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Make sure, `evaluation_duration` is an int otherwise.</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span> <span class="o">&lt;=</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`evaluation_duration` (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_duration</span><span class="si">}</span><span class="s2">) must be an &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;int and &gt;0!&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_input_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks, whether input related settings make sense.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_</span> <span class="o">==</span> <span class="s2">&quot;sampler&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_policy_estimation_methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Off-policy estimation methods can only be used if the input is a &quot;</span>
                <span class="s2">&quot;dataset. We currently do not support applying off_policy_estimation_&quot;</span>
                <span class="s2">&quot;method on a sampler input.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_</span> <span class="o">==</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span>
            <span class="c1"># If you need to read a Ray dataset set the parallelism and</span>
            <span class="c1"># num_cpus_per_read_task from rollout worker settings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s2">&quot;num_cpus_per_read_task&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_env_runner</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_evaluation</span><span class="p">:</span>
                <span class="c1"># If using dataset for evaluation, the parallelism gets set to</span>
                <span class="c1"># evaluation_num_env_runners for backward compatibility and num_cpus</span>
                <span class="c1"># gets set to num_cpus_per_env_runner from rollout worker. User only</span>
                <span class="c1"># needs to set evaluation_num_env_runners.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s2">&quot;parallelism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="ow">or</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If using dataset for training, the parallelism and num_cpus gets set</span>
                <span class="c1"># based on rollout worker parameters. This is for backwards</span>
                <span class="c1"># compatibility for now. User only needs to set num_env_runners.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s2">&quot;parallelism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="ow">or</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_validate_new_api_stack_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks, whether settings related to the new API stack make sense.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span><span class="p">:</span>
            <span class="c1"># Throw a warning if the user has used `self.rl_module(rl_module_spec=...)`</span>
            <span class="c1"># but has not enabled the new API stack at the same time.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl_module_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;You have setup a RLModuleSpec (via calling &quot;</span>
                    <span class="s2">&quot;`config.rl_module(...)`), but have not enabled the new API stack. &quot;</span>
                    <span class="s2">&quot;To enable it, call `config.api_stack(enable_rl_module_and_learner=&quot;</span>
                    <span class="s2">&quot;True)`.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Throw a warning if the user has used `self.training(learner_class=...)`</span>
            <span class="c1"># but has not enabled the new API stack at the same time.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_learner_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;You specified a custom Learner class (via &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`AlgorithmConfig.training(learner_class=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_learner_class</span><span class="si">}</span><span class="s2">)`, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but have the new API stack disabled. You need to enable it via &quot;</span>
                    <span class="s2">&quot;`AlgorithmConfig.api_stack(enable_rl_module_and_learner=True)`.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># User is using the new EnvRunners, but forgot to switch on</span>
            <span class="c1"># `enable_rl_module_and_learner`.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_env_runner_and_connector_v2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;You are using the new API stack EnvRunners (SingleAgentEnvRunner &quot;</span>
                    <span class="s2">&quot;or MultiAgentEnvRunner), but have forgotten to switch on the new &quot;</span>
                    <span class="s2">&quot;API stack! Try setting &quot;</span>
                    <span class="s2">&quot;`config.api_stack(enable_rl_module_and_learner=True)`.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Early out. The rest of this method is only for</span>
            <span class="c1"># `enable_rl_module_and_learner=True`.</span>
            <span class="k">return</span>

        <span class="c1"># Disabled hybrid API stack. Now, both `enable_rl_module_and_learner` and</span>
        <span class="c1"># `enable_env_runner_and_connector_v2` must be True or both False.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_env_runner_and_connector_v2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Setting `enable_rl_module_and_learner` to True and &quot;</span>
                <span class="s2">&quot;`enable_env_runner_and_connector_v2` to False (&#39;hybrid API stack&#39;&quot;</span>
                <span class="s2">&quot;) is not longer supported! Set both to True (new API stack) or both &quot;</span>
                <span class="s2">&quot;to False (old API stack), instead.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># New API stack (RLModule, Learner APIs) only works with connectors.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_connectors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The new API stack (RLModule and Learner APIs) only works with &quot;</span>
                <span class="s2">&quot;connectors! Please enable connectors via &quot;</span>
                <span class="s2">&quot;`config.env_runners(enable_connectors=True)`.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># LR-schedule checking.</span>
        <span class="n">Scheduler</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span>
            <span class="n">fixed_value_or_schedule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">,</span>
            <span class="n">setting_name</span><span class="o">=</span><span class="s2">&quot;lr&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;learning rate&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Check and error if `on_episode_created` callback has been overridden on the</span>
        <span class="c1"># new API stack AND this is a single-agent setup (multi-agent does not use</span>
        <span class="c1"># gym.vector.Env yet and therefore the reset call is still made manually,</span>
        <span class="c1"># allowing for the callback to be fired).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">DefaultCallbacks</span><span class="p">:</span>
            <span class="n">default_src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">DefaultCallbacks</span><span class="o">.</span><span class="n">on_episode_created</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">user_src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks_class</span><span class="o">.</span><span class="n">on_episode_created</span><span class="p">)</span>
            <span class="c1"># In case user has setup a `partial` instead of an actual Callbacks class.</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">user_src</span> <span class="o">=</span> <span class="n">default_src</span>
            <span class="k">if</span> <span class="n">default_src</span> <span class="o">!=</span> <span class="n">user_src</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When using the new API stack in single-agent and with EnvRunners, &quot;</span>
                    <span class="s2">&quot;you cannot override the `DefaultCallbacks.on_episode_created()` &quot;</span>
                    <span class="s2">&quot;method anymore! This particular callback is no longer supported &quot;</span>
                    <span class="s2">&quot;b/c we are using `gym.vector.Env`, which automatically resets &quot;</span>
                    <span class="s2">&quot;individual sub-environments when they are terminated. Instead, &quot;</span>
                    <span class="s2">&quot;override the `on_episode_start` method, which gets fired right &quot;</span>
                    <span class="s2">&quot;after the `env.reset()` call.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># This is not compatible with RLModules, which all have a method</span>
        <span class="c1"># `forward_exploration` to specify custom exploration behavior.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploration_config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;When the RLModule API is enabled, exploration_config can not be &quot;</span>
                <span class="s2">&quot;set. If you want to implement custom exploration behaviour, &quot;</span>
                <span class="s2">&quot;please modify the `forward_exploration` method of the &quot;</span>
                <span class="s2">&quot;RLModule at hand. On configs that have a default exploration &quot;</span>
                <span class="s2">&quot;config, this must be done via &quot;</span>
                <span class="s2">&quot;`config.exploration_config=</span><span class="si">{}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>

        <span class="n">not_compatible_w_rlm_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Cannot use `</span><span class="si">{}</span><span class="s2">` option with the new API stack (RLModule and &quot;</span>
            <span class="s2">&quot;Learner APIs)! `</span><span class="si">{}</span><span class="s2">` is part of the ModelV2 API and Policy API,&quot;</span>
            <span class="s2">&quot; which are not compatible with the new API stack. You can either &quot;</span>
            <span class="s2">&quot;deactivate the new stack via `config.api_stack( &quot;</span>
            <span class="s2">&quot;enable_rl_module_and_learner=False)`,&quot;</span>
            <span class="s2">&quot;or use the new stack (incl. RLModule API) and implement your &quot;</span>
            <span class="s2">&quot;custom model as an RLModule.&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;custom_model&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">not_compatible_w_rlm_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;custom_model&quot;</span><span class="p">,</span> <span class="s2">&quot;custom_model&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;custom_model_config&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">not_compatible_w_rlm_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;custom_model_config&quot;</span><span class="p">,</span> <span class="s2">&quot;custom_model_config&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># TODO (sven): Once everything is on the new API stack, we won&#39;t need this method</span>
    <span class="c1">#  anymore.</span>
    <span class="k">def</span> <span class="nf">_validate_to_be_deprecated_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Env task fn will be deprecated.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_task_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_task_fn&quot;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The `env_task_fn` API is not supported on the new API stack! &quot;</span>
                <span class="s2">&quot;Curriculum learning should instead be implemented solely via &quot;</span>
                <span class="s2">&quot;custom callbacks. Check out our curriculum learning example &quot;</span>
                <span class="s2">&quot;script for more information: &quot;</span>
                <span class="s2">&quot;https://github.com/ray-project/ray/blob/master/rllib/examples/curriculum/curriculum_learning.py&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
        <span class="c1"># `render_env` is deprecated on new API stack.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_env_runner_and_connector_v2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.render_env&quot;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The `render_env` setting is not supported on the new API stack! &quot;</span>
                <span class="s2">&quot;In order to log videos to WandB (or other loggers), take a look at &quot;</span>
                <span class="s2">&quot;this example here: &quot;</span>
                <span class="s2">&quot;https://github.com/ray-project/ray/blob/master/rllib/examples/envs/env_rendering_and_recording.py&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor_pref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rllib&quot;</span><span class="p">,</span> <span class="s2">&quot;deepmind&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`config.preprocessor_pref` must be either &#39;rllib&#39;, &#39;deepmind&#39; or None!&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check model config.</span>
        <span class="c1"># If no preprocessing, propagate into model&#39;s config as well</span>
        <span class="c1"># (so model will know, whether inputs are preprocessed or not).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_preprocessor_api</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;_disable_preprocessor_api&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># If no action flattening, propagate into model&#39;s config as well</span>
        <span class="c1"># (so model will know, whether action inputs are already flattened or</span>
        <span class="c1"># not).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_action_flattening</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;_disable_action_flattening&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_preprocessor&quot;</span><span class="p">):</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.training(model={&#39;custom_preprocessor&#39;: ...})&quot;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Custom preprocessors are deprecated, &quot;</span>
                <span class="s2">&quot;since they sometimes conflict with the built-in &quot;</span>
                <span class="s2">&quot;preprocessors for handling complex observation spaces. &quot;</span>
                <span class="s2">&quot;Please use wrapper classes around your environment &quot;</span>
                <span class="s2">&quot;instead.&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Multi-GPU settings.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Multi-GPU setting: Must use MultiGPUTrainOneStep.</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># TODO: AlphaStar uses &gt;1 GPUs differently (1 per policy actor), so this is</span>
            <span class="c1">#  ok for tf2 here.</span>
            <span class="c1">#  Remove this hacky check, once we have fully moved to the Learner API.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;tf2&quot;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;AlphaStar&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`num_gpus` &gt; 1 not supported yet for &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;framework=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span><span class="si">}</span><span class="s2">!&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot use `simple_optimizer` if `num_gpus` &gt; 1! &quot;</span>
                    <span class="s2">&quot;Consider not setting `simple_optimizer` in your config.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Auto-setting: Use simple-optimizer for tf-eager or multiagent,</span>
        <span class="c1"># otherwise: MultiGPUTrainOneStep (if supported by the algo&#39;s execution</span>
        <span class="c1"># plan).</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">==</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
            <span class="c1"># tf-eager: Must use simple optimizer.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;torch&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Multi-agent case: Try using MultiGPU optimizer (only</span>
            <span class="c1"># if all policies used are DynamicTFPolicies or TorchPolicies).</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multi_agent</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">ray.rllib.policy.dynamic_tf_policy</span> <span class="kn">import</span> <span class="n">DynamicTFPolicy</span>
                <span class="kn">from</span> <span class="nn">ray.rllib.policy.torch_policy</span> <span class="kn">import</span> <span class="n">TorchPolicy</span>

                <span class="n">default_policy_cls</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo_class</span><span class="p">:</span>
                    <span class="n">default_policy_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo_class</span><span class="o">.</span><span class="n">get_default_policy_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="n">policies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span>
                <span class="n">policy_specs</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">PolicySpec</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="k">else</span> <span class="n">spec</span>
                        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">policies</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                    <span class="k">else</span> <span class="p">[</span><span class="n">PolicySpec</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">policies</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">policy_class</span> <span class="ow">or</span> <span class="n">default_policy_cls</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">or</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span>
                        <span class="n">spec</span><span class="o">.</span><span class="n">policy_class</span> <span class="ow">or</span> <span class="n">default_policy_cls</span><span class="p">,</span>
                        <span class="p">(</span><span class="n">DynamicTFPolicy</span><span class="p">,</span> <span class="n">TorchPolicy</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">policy_specs</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># User manually set simple-optimizer to False -&gt; Error if tf-eager.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_optimizer</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;tf2&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`simple_optimizer=False` not supported for &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;config.framework(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span><span class="si">}</span><span class="s2">)!&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_offline_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ray.rllib.offline.offline_prelearner</span> <span class="kn">import</span> <span class="n">OfflinePreLearner</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_class</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_class</span><span class="p">,</span> <span class="n">OfflinePreLearner</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unknown `prelearner_class`. Prelearner class needs to inherit &quot;</span>
                <span class="s2">&quot;from `OfflinePreLearner` class.&quot;</span>
            <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">ray.rllib.utils.replay_buffers.episode_replay_buffer</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">EpisodeReplayBuffer</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_buffer_class</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prelearner_buffer_class</span><span class="p">,</span> <span class="n">EpisodeReplayBuffer</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unknown `prelearner_buffer_class`. The buffer class for the &quot;</span>
                <span class="s2">&quot;prelearner needs to inherit from `EpisodeReplayBuffer`. &quot;</span>
                <span class="s2">&quot;Specifically it needs to store and sample lists of &quot;</span>
                <span class="s2">&quot;`Single-/MultiAgentEpisode`s.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_serialize_dict</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
        <span class="c1"># Serialize classes to classpaths:</span>
        <span class="k">if</span> <span class="s2">&quot;callbacks_class&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;callbacks_class&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;class&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">])</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">])</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;sample_collector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;sample_collector&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">],</span> <span class="nb">type</span><span class="p">):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;replay_buffer_config&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;replay_buffer_config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;replay_buffer_config&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;replay_buffer_config&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="p">):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;exploration_config&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_model&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="p">):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;custom_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_type</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;custom_model&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># List&#39;ify `policies`, iff a set or tuple (these types are not JSON&#39;able).</span>
        <span class="n">ma_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;multiagent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ma_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ma_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;policies&quot;</span><span class="p">),</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">ma_config</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ma_config</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">])</span>
            <span class="c1"># Do NOT serialize functions/lambdas.</span>
            <span class="k">if</span> <span class="n">ma_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;policy_mapping_fn&quot;</span><span class="p">):</span>
                <span class="n">ma_config</span><span class="p">[</span><span class="s2">&quot;policy_mapping_fn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOT_SERIALIZABLE</span>
            <span class="k">if</span> <span class="n">ma_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;policies_to_train&quot;</span><span class="p">):</span>
                <span class="n">ma_config</span><span class="p">[</span><span class="s2">&quot;policies_to_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOT_SERIALIZABLE</span>
        <span class="c1"># However, if these &quot;multiagent&quot; settings have been provided directly</span>
        <span class="c1"># on the top-level (as they should), we override the settings under</span>
        <span class="c1"># &quot;multiagent&quot;. Note that the &quot;multiagent&quot; key should no longer be used anyways.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;policies&quot;</span><span class="p">),</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;policies&quot;</span><span class="p">])</span>
        <span class="c1"># Do NOT serialize functions/lambdas.</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;policy_mapping_fn&quot;</span><span class="p">):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;policy_mapping_fn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOT_SERIALIZABLE</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;policies_to_train&quot;</span><span class="p">):</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;policies_to_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOT_SERIALIZABLE</span>

        <span class="k">return</span> <span class="n">config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_translate_special_keys</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">warn_deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Handle special key (str) -&gt; `AlgorithmConfig.[some_property]` cases.</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;callbacks&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;callbacks_class&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;create_env_on_driver&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;create_env_on_local_worker&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;custom_eval_function&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;custom_evaluation_function&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;framework&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;framework_str&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;input_&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;lambda&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;lambda_&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;num_cpus_for_driver&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;num_cpus_for_main_process&quot;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;num_workers&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;num_env_runners&quot;</span>

        <span class="c1"># Deprecated keys.</span>
        <span class="k">if</span> <span class="n">warn_deprecated</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;collect_metrics_timeout&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;collect_metrics_timeout&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;metrics_episode_collection_timeout_s&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;metrics_smoothing_episodes&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.metrics_smoothing_episodes&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.metrics_num_episodes_for_smoothing&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;min_iter_time_s&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.min_iter_time_s&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.min_time_s_per_iteration&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;min_time_s_per_reporting&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.min_time_s_per_reporting&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.min_time_s_per_iteration&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;min_sample_timesteps_per_reporting&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.min_sample_timesteps_per_reporting&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.min_sample_timesteps_per_iteration&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;min_train_timesteps_per_reporting&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.min_train_timesteps_per_reporting&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;config.min_train_timesteps_per_iteration&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;timesteps_per_iteration&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.timesteps_per_iteration&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;`config.min_sample_timesteps_per_iteration` OR &quot;</span>
                    <span class="s2">&quot;`config.min_train_timesteps_per_iteration`&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;evaluation_num_episodes&quot;</span><span class="p">:</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="n">old</span><span class="o">=</span><span class="s2">&quot;config.evaluation_num_episodes&quot;</span><span class="p">,</span>
                    <span class="n">new</span><span class="o">=</span><span class="s2">&quot;`config.evaluation_duration` and &quot;</span>
                    <span class="s2">&quot;`config.evaluation_duration_unit=episodes`&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">key</span>

    <span class="k">def</span> <span class="nf">_check_if_correct_nn_framework_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_tf1</span><span class="p">,</span> <span class="n">_tf</span><span class="p">,</span> <span class="n">_torch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if tf/torch experiment is running and tf/torch installed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;tf2&quot;</span><span class="p">}:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_tf1</span> <span class="ow">or</span> <span class="n">_tf</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;TensorFlow was specified as the framework to use (via `config.&quot;</span>
                        <span class="s2">&quot;framework([tf|tf2])`)! However, no installation was &quot;</span>
                        <span class="s2">&quot;found. You can install TensorFlow via `pip install tensorflow`&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;torch&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_torch</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;PyTorch was specified as the framework to use (via `config.&quot;</span>
                        <span class="s2">&quot;framework(&#39;torch&#39;)`)! However, no installation was found. You &quot;</span>
                        <span class="s2">&quot;can install PyTorch via `pip install torch`.&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_tf_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_tf1</span><span class="p">,</span> <span class="n">_tfv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check and resolve tf settings.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_tf1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;tf2&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;tf2&quot;</span> <span class="ow">and</span> <span class="n">_tfv</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;You configured `framework`=tf2, but your installed &quot;</span>
                    <span class="s2">&quot;pip tf-version is &lt; 2.0! Make sure your TensorFlow &quot;</span>
                    <span class="s2">&quot;version is &gt;= 2.x.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tf1</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
                <span class="n">_tf1</span><span class="o">.</span><span class="n">enable_eager_execution</span><span class="p">()</span>
            <span class="c1"># Recommend setting tracing to True for speedups.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Executing eagerly (framework=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span><span class="si">}</span><span class="s2">&#39;),&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; with eager_tracing=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eager_tracing</span><span class="si">}</span><span class="s2">. For &quot;</span>
                <span class="s2">&quot;production workloads, make sure to set eager_tracing=True&quot;</span>
                <span class="s2">&quot;  in order to match the speed of tf-static-graph &quot;</span>
                <span class="s2">&quot;(framework=&#39;tf&#39;). For debugging purposes, &quot;</span>
                <span class="s2">&quot;`eager_tracing=False` is the best choice.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Tf-static-graph (framework=tf): Recommend upgrading to tf2 and</span>
        <span class="c1"># enabling eager tracing for similar speed.</span>
        <span class="k">elif</span> <span class="n">_tf1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework_str</span> <span class="o">==</span> <span class="s2">&quot;tf&quot;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Your framework setting is &#39;tf&#39;, meaning you are using &quot;</span>
                <span class="s2">&quot;static-graph mode. Set framework=&#39;tf2&#39; to enable eager &quot;</span>
                <span class="s2">&quot;execution with tf2.x. You may also then want to set &quot;</span>
                <span class="s2">&quot;eager_tracing=True in order to reach similar execution &quot;</span>
                <span class="s2">&quot;speed as with static-graph mode.&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="AlgorithmConfig.get_multi_agent_setup">
<a class="viewcode-back" href="../../../../rllib/package_ref/doc/ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_agent_setup.html#ray.rllib.algorithms.algorithm_config.AlgorithmConfig.get_multi_agent_setup">[docs]</a>
    <span class="nd">@OldAPIStack</span>
    <span class="k">def</span> <span class="nf">get_multi_agent_setup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">policies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MultiAgentPolicyConfigDict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spaces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Space</span><span class="p">,</span> <span class="n">Space</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_policy_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Policy</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">MultiAgentPolicyConfigDict</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">SampleBatchType</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compiles complete multi-agent config (dict) from the information in `self`.</span>

<span class="sd">        Infers the observation- and action spaces, the policy classes, and the policy&#39;s</span>
<span class="sd">        configs. The returned `MultiAgentPolicyConfigDict` is fully unified and strictly</span>
<span class="sd">        maps PolicyIDs to complete PolicySpec objects (with all their fields not-None).</span>

<span class="sd">        Examples:</span>
<span class="sd">        .. testcode::</span>

<span class="sd">            import gymnasium as gym</span>
<span class="sd">            from ray.rllib.algorithms.ppo import PPOConfig</span>
<span class="sd">            config = (</span>
<span class="sd">              PPOConfig()</span>
<span class="sd">              .environment(&quot;CartPole-v1&quot;)</span>
<span class="sd">              .framework(&quot;torch&quot;)</span>
<span class="sd">              .multi_agent(policies={&quot;pol1&quot;, &quot;pol2&quot;}, policies_to_train=[&quot;pol1&quot;])</span>
<span class="sd">            )</span>
<span class="sd">            policy_dict, is_policy_to_train = config.get_multi_agent_setup(</span>
<span class="sd">                env=gym.make(&quot;CartPole-v1&quot;))</span>
<span class="sd">            is_policy_to_train(&quot;pol1&quot;)</span>
<span class="sd">            is_policy_to_train(&quot;pol2&quot;)</span>

<span class="sd">        Args:</span>
<span class="sd">            policies: An optional multi-agent `policies` dict, mapping policy IDs</span>
<span class="sd">                to PolicySpec objects. If not provided, will use `self.policies`</span>
<span class="sd">                instead. Note that the `policy_class`, `observation_space`, and</span>
<span class="sd">                `action_space` properties in these PolicySpecs may be None and must</span>
<span class="sd">                therefore be inferred here.</span>
<span class="sd">            env: An optional env instance, from which to infer the different spaces for</span>
<span class="sd">                the different policies. If not provided, will try to infer from</span>
<span class="sd">                `spaces`. Otherwise from `self.observation_space` and</span>
<span class="sd">                `self.action_space`. If no information on spaces can be infered, will</span>
<span class="sd">                raise an error.</span>
<span class="sd">            spaces: Optional dict mapping policy IDs to tuples of 1) observation space</span>
<span class="sd">                and 2) action space that should be used for the respective policy.</span>
<span class="sd">                These spaces were usually provided by an already instantiated remote</span>
<span class="sd">                EnvRunner. Note that if the `env` argument is provided, will try to</span>
<span class="sd">                infer spaces from `env` first.</span>
<span class="sd">            default_policy_class: The Policy class to use should a PolicySpec have its</span>
<span class="sd">                policy_class property set to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple consisting of 1) a MultiAgentPolicyConfigDict and 2) a</span>
<span class="sd">            `is_policy_to_train(PolicyID, SampleBatchType) -&gt; bool` callable.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: In case, no spaces can be infered for the policy/ies.</span>
<span class="sd">            ValueError: In case, two agents in the env map to the same PolicyID</span>
<span class="sd">                (according to `self.policy_mapping_fn`), but have different action- or</span>
<span class="sd">                observation spaces according to the infered space information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">policies</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">policies</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">)</span>

        <span class="c1"># Policies given as set/list/tuple (of PolicyIDs) -&gt; Setup each policy</span>
        <span class="c1"># automatically via empty PolicySpec (will make RLlib infer observation- and</span>
        <span class="c1"># action spaces as well as the Policy&#39;s class).</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">policies</span> <span class="o">=</span> <span class="p">{</span><span class="n">pid</span><span class="p">:</span> <span class="n">PolicySpec</span><span class="p">()</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">policies</span><span class="p">}</span>

        <span class="c1"># Try extracting spaces from env or from given spaces dict.</span>
        <span class="n">env_obs_space</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">env_act_space</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Env is a ray.remote: Get spaces via its (automatically added)</span>
        <span class="c1"># `_get_spaces()` method.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">ray</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">ActorHandle</span><span class="p">):</span>
            <span class="n">env_obs_space</span><span class="p">,</span> <span class="n">env_act_space</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">_get_spaces</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>
        <span class="c1"># Normal env (gym.Env or MultiAgentEnv): These should have the</span>
        <span class="c1"># `observation_space` and `action_space` properties.</span>
        <span class="k">elif</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># `env` is a gymnasium.vector.Env.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;single_observation_space&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">env</span><span class="o">.</span><span class="n">single_observation_space</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span>
            <span class="p">):</span>
                <span class="n">env_obs_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">single_observation_space</span>
            <span class="c1"># `env` is a gymnasium.Env.</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;observation_space&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span>
            <span class="p">):</span>
                <span class="n">env_obs_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span>

            <span class="c1"># `env` is a gymnasium.vector.Env.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;single_action_space&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">env</span><span class="o">.</span><span class="n">single_action_space</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span>
            <span class="p">):</span>
                <span class="n">env_act_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">single_action_space</span>
            <span class="c1"># `env` is a gymnasium.Env.</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;action_space&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span>
            <span class="p">):</span>
                <span class="n">env_act_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span>

        <span class="c1"># Last resort: Try getting the env&#39;s spaces from the spaces</span>
        <span class="c1"># dict&#39;s special __env__ key.</span>
        <span class="k">if</span> <span class="n">spaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">env_obs_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">env_obs_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">INPUT_ENV_SPACES</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">env_act_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">env_act_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">INPUT_ENV_SPACES</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Check each defined policy ID and unify its spec.</span>
        <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">policy_spec</span> <span class="ow">in</span> <span class="n">policies</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Convert to PolicySpec if plain list/tuple.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policy_spec</span><span class="p">,</span> <span class="n">PolicySpec</span><span class="p">):</span>
                <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">policy_spec</span> <span class="o">=</span> <span class="n">PolicySpec</span><span class="p">(</span><span class="o">*</span><span class="n">policy_spec</span><span class="p">)</span>

            <span class="c1"># Infer policy classes for policies dict, if not provided (None).</span>
            <span class="k">if</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">policy_class</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">default_policy_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">policy_class</span> <span class="o">=</span> <span class="n">default_policy_class</span>

            <span class="c1"># Infer observation space.</span>
            <span class="k">if</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">observation_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">env_unwrapped</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;unwrapped&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">env</span>
                <span class="c1"># Module&#39;s space is provided -&gt; Use it as-is.</span>
                <span class="k">if</span> <span class="n">spaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">spaces</span><span class="p">:</span>
                    <span class="n">obs_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="p">[</span><span class="n">pid</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># MultiAgentEnv -&gt; Check, whether agents have different spaces.</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env_unwrapped</span><span class="p">,</span> <span class="n">MultiAgentEnv</span><span class="p">):</span>
                    <span class="n">obs_space</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">mapping_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">policy_mapping_fn</span>
                    <span class="n">aids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env_unwrapped</span><span class="p">,</span> <span class="s2">&quot;possible_agents&quot;</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                        <span class="k">else</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_agent_ids</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">one_obs_space</span> <span class="o">=</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">observation_space</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">one_obs_space</span> <span class="o">=</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_observation_space</span><span class="p">(</span><span class="n">aids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># If all obs spaces are the same, just use the first space.</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_observation_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span> <span class="o">==</span> <span class="n">one_obs_space</span>
                        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aids</span>
                    <span class="p">):</span>
                        <span class="n">obs_space</span> <span class="o">=</span> <span class="n">one_obs_space</span>
                    <span class="c1"># Need to reverse-map spaces (for the different agents) to certain</span>
                    <span class="c1"># policy IDs. We have to compare the ModuleID with all possible</span>
                    <span class="c1"># AgentIDs and find the agent ID that matches.</span>
                    <span class="k">elif</span> <span class="n">mapping_fn</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">:</span>
                            <span class="c1"># Match: Assign spaces for this agentID to the PolicyID.</span>
                            <span class="k">if</span> <span class="n">mapping_fn</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">worker</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">pid</span><span class="p">:</span>
                                <span class="c1"># Make sure, different agents that map to the same</span>
                                <span class="c1"># policy don&#39;t have different spaces.</span>
                                <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">obs_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                    <span class="ow">and</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_observation_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                                    <span class="o">!=</span> <span class="n">obs_space</span>
                                <span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                        <span class="s2">&quot;Two agents in your environment map to the &quot;</span>
                                        <span class="s2">&quot;same policyID (as per your `policy_mapping&quot;</span>
                                        <span class="s2">&quot;_fn`), however, these agents also have &quot;</span>
                                        <span class="s2">&quot;different observation spaces!&quot;</span>
                                    <span class="p">)</span>
                                <span class="n">obs_space</span> <span class="o">=</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_observation_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="c1"># Just use env&#39;s obs space as-is.</span>
                <span class="k">elif</span> <span class="n">env_obs_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">obs_space</span> <span class="o">=</span> <span class="n">env_obs_space</span>
                <span class="c1"># Space given directly in config.</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span><span class="p">:</span>
                    <span class="n">obs_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`observation_space` not provided in PolicySpec for &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2"> and env does not have an observation space OR &quot;</span>
                        <span class="s2">&quot;no spaces received from other workers&#39; env(s) OR no &quot;</span>
                        <span class="s2">&quot;`observation_space` specified in config!&quot;</span>
                    <span class="p">)</span>

                <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">obs_space</span>

            <span class="c1"># Infer action space.</span>
            <span class="k">if</span> <span class="n">policy_spec</span><span class="o">.</span><span class="n">action_space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">env_unwrapped</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;unwrapped&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">env</span>
                <span class="c1"># Module&#39;s space is provided -&gt; Use it as-is.</span>
                <span class="k">if</span> <span class="n">spaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">spaces</span><span class="p">:</span>
                    <span class="n">act_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="p">[</span><span class="n">pid</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># MultiAgentEnv -&gt; Check, whether agents have different spaces.</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env_unwrapped</span><span class="p">,</span> <span class="n">MultiAgentEnv</span><span class="p">):</span>
                    <span class="n">act_space</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">mapping_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">policy_mapping_fn</span>
                    <span class="n">aids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env_unwrapped</span><span class="p">,</span> <span class="s2">&quot;possible_agents&quot;</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">possible_agents</span>
                        <span class="k">else</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_agent_ids</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">one_act_space</span> <span class="o">=</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">action_space</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">one_act_space</span> <span class="o">=</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_action_space</span><span class="p">(</span><span class="n">aids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># If all obs spaces are the same, just use the first space.</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_action_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span> <span class="o">==</span> <span class="n">one_act_space</span>
                        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aids</span>
                    <span class="p">):</span>
                        <span class="n">act_space</span> <span class="o">=</span> <span class="n">one_act_space</span>
                    <span class="c1"># Need to reverse-map spaces (for the different agents) to certain</span>
                    <span class="c1"># policy IDs. We have to compare the ModuleID with all possible</span>
                    <span class="c1"># AgentIDs and find the agent ID that matches.</span>
                    <span class="k">elif</span> <span class="n">mapping_fn</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">:</span>
                            <span class="c1"># Match: Assign spaces for this AgentID to the PolicyID.</span>
                            <span class="k">if</span> <span class="n">mapping_fn</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">worker</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">pid</span><span class="p">:</span>
                                <span class="c1"># Make sure, different agents that map to the same</span>
                                <span class="c1"># policy don&#39;t have different spaces.</span>
                                <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">act_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                    <span class="ow">and</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_action_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">act_space</span>
                                <span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                        <span class="s2">&quot;Two agents in your environment map to the &quot;</span>
                                        <span class="s2">&quot;same policyID (as per your `policy_mapping&quot;</span>
                                        <span class="s2">&quot;_fn`), however, these agents also have &quot;</span>
                                        <span class="s2">&quot;different action spaces!&quot;</span>
                                    <span class="p">)</span>
                                <span class="n">act_space</span> <span class="o">=</span> <span class="n">env_unwrapped</span><span class="o">.</span><span class="n">get_action_space</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="c1"># Just use env&#39;s action space as-is.</span>
                <span class="k">elif</span> <span class="n">env_act_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">act_space</span> <span class="o">=</span> <span class="n">env_act_space</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span><span class="p">:</span>
                    <span class="n">act_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`action_space` not provided in PolicySpec for &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2"> and env does not have an action space OR &quot;</span>
                        <span class="s2">&quot;no spaces received from other workers&#39; env(s) OR no &quot;</span>
                        <span class="s2">&quot;`action_space` specified in config!&quot;</span>
                    <span class="p">)</span>
                <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">act_space</span>

            <span class="c1"># Create entire AlgorithmConfig object from the provided override.</span>
            <span class="c1"># If None, use {} as override.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">AlgorithmConfig</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span>
                <span class="p">)</span>
                <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">update_from_dict</span><span class="p">(</span>
                    <span class="n">policies</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
                <span class="p">)</span>

        <span class="c1"># If collection given, construct a simple default callable returning True</span>
        <span class="c1"># if the PolicyID is found in the list/set of IDs.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span><span class="p">):</span>
            <span class="n">pols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">is_policy_to_train</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pols</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_policy_to_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies_to_train</span>

        <span class="k">return</span> <span class="n">policies</span><span class="p">,</span> <span class="n">is_policy_to_train</span></div>


    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.get_multi_rl_module_spec()&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_marl_module_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_multi_rl_module_spec</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(..)&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rollouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_runners</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runners(..)&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">exploration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_runners</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig._enable_new_api_stack&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_enable_new_api_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_rl_module_and_learner</span>

    <span class="nd">@_enable_new_api_stack</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_enable_new_api_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig._enable_new_api_stack&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.enable_rl_module_and_learner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.enable_env_runner_and_connector_v2&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">uses_new_env_runners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_env_runners&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_rollout_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span>

    <span class="nd">@num_rollout_workers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_rollout_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_rollout_workers&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_env_runners&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_env_runners</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.evaluation_num_workers&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">evaluation_num_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span>

    <span class="nd">@evaluation_num_workers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">evaluation_num_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.evaluation_num_workers&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.evaluation_num_env_runners&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_num_env_runners</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_envs_per_env_runner&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_envs_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span>

    <span class="nd">@num_envs_per_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_envs_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_envs_per_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_envs_per_env_runner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_envs_per_env_runner</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.ignore_env_runner_failures&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">ignore_worker_failures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_env_runner_failures</span>

    <span class="nd">@ignore_worker_failures</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ignore_worker_failures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.ignore_worker_failures&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.ignore_env_runner_failures&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_env_runner_failures</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.recreate_failed_env_runners&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">recreate_failed_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recreate_failed_env_runners</span>

    <span class="nd">@recreate_failed_workers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">recreate_failed_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.recreate_failed_workers&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.recreate_failed_env_runners&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recreate_failed_env_runners</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.max_num_env_runner_restarts&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">max_num_worker_restarts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_num_env_runner_restarts</span>

    <span class="nd">@max_num_worker_restarts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">max_num_worker_restarts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.max_num_worker_restarts&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.max_num_env_runner_restarts&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_env_runner_restarts</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.delay_between_env_runner_restarts_s&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delay_between_worker_restarts_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_between_env_runner_restarts_s</span>

    <span class="nd">@delay_between_worker_restarts_s</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">delay_between_worker_restarts_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.delay_between_worker_restarts_s&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.delay_between_env_runner_restarts_s&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_between_env_runner_restarts_s</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span>
        <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_consecutive_env_runner_failures_tolerance&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_consecutive_worker_failures_tolerance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_consecutive_env_runner_failures_tolerance</span>

    <span class="nd">@num_consecutive_worker_failures_tolerance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_consecutive_worker_failures_tolerance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_consecutive_worker_failures_tolerance&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_consecutive_env_runner_failures_tolerance&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_consecutive_env_runner_failures_tolerance</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runner_health_probe_timeout_s&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">worker_health_probe_timeout_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_health_probe_timeout_s</span>

    <span class="nd">@worker_health_probe_timeout_s</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">worker_health_probe_timeout_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.worker_health_probe_timeout_s&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runner_health_probe_timeout_s&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_health_probe_timeout_s</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runner_restore_timeout_s&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">worker_restore_timeout_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_restore_timeout_s</span>

    <span class="nd">@worker_restore_timeout_s</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">worker_restore_timeout_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.worker_restore_timeout_s&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.env_runner_restore_timeout_s&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_runner_restore_timeout_s</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span>
        <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.validate_env_runners_after_construction&quot;</span><span class="p">,</span>
        <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_workers_after_construction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_env_runners_after_construction</span>

    <span class="nd">@validate_workers_after_construction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">validate_workers_after_construction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.validate_workers_after_construction&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.validate_env_runners_after_construction&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_env_runners_after_construction</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Cleanups from `resources()`.</span>
    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_per_env_runner&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_cpus_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_env_runner</span>

    <span class="nd">@num_cpus_per_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_cpus_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_per_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_per_env_runner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_env_runner</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_gpus_per_env_runner&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_gpus_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_env_runner</span>

    <span class="nd">@num_gpus_per_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_gpus_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_gpus_per_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_gpus_per_env_runner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_env_runner</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.custom_resources_per_env_runner&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">custom_resources_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_resources_per_env_runner</span>

    <span class="nd">@custom_resources_per_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">custom_resources_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.custom_resources_per_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.custom_resources_per_env_runner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_resources_per_env_runner</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_learners&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_learner_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span>

    <span class="nd">@num_learner_workers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_learner_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_learner_workers&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_learners&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_learners</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_per_learner&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_cpus_per_learner_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_learner</span>

    <span class="nd">@num_cpus_per_learner_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_cpus_per_learner_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_per_learner_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_per_learner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_learner</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_gpus_per_learner&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_gpus_per_learner_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_learner</span>

    <span class="nd">@num_gpus_per_learner_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_gpus_per_learner_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_gpus_per_learner_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_gpus_per_learner&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_learner</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="nd">@Deprecated</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_for_local_worker&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">num_cpus_for_local_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_for_main_process</span>

    <span class="nd">@num_cpus_for_local_worker</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_cpus_for_local_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">deprecation_warning</span><span class="p">(</span>
            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_for_local_worker&quot;</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;AlgorithmConfig.num_cpus_for_main_process&quot;</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_for_main_process</span> <span class="o">=</span> <span class="n">value</span></div>



<span class="k">class</span> <span class="nc">TorchCompileWhatToCompile</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enumerates schemes of what parts of the TorchLearner can be compiled.</span>

<span class="sd">    This can be either the entire update step of the learner or only the forward</span>
<span class="sd">    methods (and therein the forward_train method) of the RLModule.</span>

<span class="sd">    .. note::</span>
<span class="sd">        - torch.compiled code can become slow on graph breaks or even raise</span>
<span class="sd">            errors on unsupported operations. Empirically, compiling</span>
<span class="sd">            `forward_train` should introduce little graph breaks, raise no</span>
<span class="sd">            errors but result in a speedup comparable to compiling the</span>
<span class="sd">            complete update.</span>
<span class="sd">        - Using `complete_update` is experimental and may result in errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compile the entire update step of the learner.</span>
    <span class="c1"># This includes the forward pass of the RLModule, the loss computation, and the</span>
    <span class="c1"># optimizer step.</span>
    <span class="n">COMPLETE_UPDATE</span> <span class="o">=</span> <span class="s2">&quot;complete_update&quot;</span>
    <span class="c1"># Only compile the forward methods (and therein the forward_train method) of the</span>
    <span class="c1"># RLModule.</span>
    <span class="n">FORWARD_TRAIN</span> <span class="o">=</span> <span class="s2">&quot;forward_train&quot;</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="footer-content-items footer-content__inner">
  
    <div class="footer-content-item"><div id="csat">
  <div id="csat-feedback-received" class="csat-hidden">
    <span>Thanks for the feedback!</span>
  </div>
  <div id="csat-inputs">
    <span>Was this helpful?</span>
    <div id="csat-yes" class="csat-button">
      <svg id="csat-yes-icon" class="csat-hidden csat-icon" width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 10.172L16.1922 0.979004L17.6072 2.393L7.00023 13L0.63623 6.636L2.05023 5.222L7.00023 10.172Z" />
      </svg>
      <span>Yes<span>
    </div>
    <div id="csat-no" class="csat-button">
      <svg id="csat-no-icon" class="csat-hidden csat-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 5.58599L11.9502 0.635986L13.3642 2.04999L8.41423 6.99999L13.3642 11.95L11.9502 13.364L7.00023 8.41399L2.05023 13.364L0.63623 11.95L5.58623 6.99999L0.63623 2.04999L2.05023 0.635986L7.00023 5.58599Z" />
      </svg>
      <span>No<span>
    </div>
  </div>
  <div id="csat-textarea-group" class="csat-hidden">
    <span id="csat-feedback-label">Feedback</span>
    <textarea id="csat-textarea"></textarea>
    <div id="csat-submit">Submit</div>
  </div>
</div></div>
  
</div>

          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="https://docs.ray.io/en/master/_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="https://docs.ray.io/en/master/_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      Â© Copyright 2024, The Ray Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>